(self.webpackChunkngx_your_message=self.webpackChunkngx_your_message||[]).push([[279],{6870:(e,t,n)=>{"use strict";var r=n(7454).flatMap,o=n(7454).guessBrowser,i=n(7454).guessBrowserVersion,a=n(3608).getSdpFormat,c=o(),s=i(),u="chrome"===c,l="firefox"===c,f="safari"===c,p=u?s.major:null;function d(e){var t=Array.from(e.values()).find(function(e){return"candidate-pair"===e.type&&e.nominated});if(!t)return null;var n=e.get(t.localCandidateId),r=e.get(t.remoteCandidateId),o=[{key:"candidateType",type:"string"},{key:"ip",type:"string"},{key:"port",type:"number"},{key:"priority",type:"number"},{key:"protocol",type:"string"},{key:"url",type:"string"}],i=o.concat([{key:"deleted",type:"boolean"},{key:"relayProtocol",type:"string"}]),a=n?i.reduce(function(e,t){return e[t.key]=typeof n[t.key]===t.type?n[t.key]:"deleted"!==t.key&&null,e},{}):null,c=r?o.reduce(function(e,t){return e[t.key]=typeof r[t.key]===t.type?r[t.key]:null,e},{}):null;return[{key:"availableIncomingBitrate",type:"number"},{key:"availableOutgoingBitrate",type:"number"},{key:"bytesReceived",type:"number"},{key:"bytesSent",type:"number"},{key:"consentRequestsSent",type:"number"},{key:"currentRoundTripTime",type:"number"},{key:"lastPacketReceivedTimestamp",type:"number"},{key:"lastPacketSentTimestamp",type:"number"},{key:"nominated",type:"boolean"},{key:"priority",type:"number"},{key:"readable",type:"boolean"},{key:"requestsReceived",type:"number"},{key:"requestsSent",type:"number"},{key:"responsesReceived",type:"number"},{key:"responsesSent",type:"number"},{key:"retransmissionsReceived",type:"number"},{key:"retransmissionsSent",type:"number"},{key:"state",type:"string",fixup:function(e){return"inprogress"===e?"in-progress":e}},{key:"totalRoundTripTime",type:"number"},{key:"transportId",type:"string"},{key:"writable",type:"boolean"}].reduce(function(e,n){return e[n.key]=typeof t[n.key]===n.type?n.fixup?n.fixup(t[n.key]):t[n.key]:null,e},{localCandidate:a,remoteCandidate:c})}function h(e){var t=Array.from(e.values()).find(function(e){return"candidate-pair"===e.type&&e.nominated});if(!t)return null;var n=e.get(t.localCandidateId),r=e.get(t.remoteCandidateId),o=[{key:"candidateType",type:"string"},{key:"ip",ffKeys:["address","ipAddress"],type:"string"},{key:"port",ffKeys:["portNumber"],type:"number"},{key:"priority",type:"number"},{key:"protocol",ffKeys:["transport"],type:"string"},{key:"url",type:"string"}],i=o.concat([{key:"deleted",type:"boolean"},{key:"relayProtocol",type:"string"}]),a={host:"host",peerreflexive:"prflx",relayed:"relay",serverreflexive:"srflx"},c=n?i.reduce(function(e,t){var r=t.ffKeys&&t.ffKeys.find(function(e){return e in n})||t.key;return e[t.key]=typeof n[r]===t.type?"candidateType"===r&&a[n[r]]||n[r]:"deleted"!==r&&null,e},{}):null,s=r?o.reduce(function(e,t){var n=t.ffKeys&&t.ffKeys.find(function(e){return e in r})||t.key;return e[t.key]=typeof r[n]===t.type?"candidateType"===n&&a[r[n]]||r[n]:null,e},{}):null;return[{key:"availableIncomingBitrate",type:"number"},{key:"availableOutgoingBitrate",type:"number"},{key:"bytesReceived",type:"number"},{key:"bytesSent",type:"number"},{key:"consentRequestsSent",type:"number"},{key:"currentRoundTripTime",type:"number"},{key:"lastPacketReceivedTimestamp",type:"number"},{key:"lastPacketSentTimestamp",type:"number"},{key:"nominated",type:"boolean"},{key:"priority",type:"number"},{key:"readable",type:"boolean"},{key:"requestsReceived",type:"number"},{key:"requestsSent",type:"number"},{key:"responsesReceived",type:"number"},{key:"responsesSent",type:"number"},{key:"retransmissionsReceived",type:"number"},{key:"retransmissionsSent",type:"number"},{key:"state",type:"string"},{key:"totalRoundTripTime",type:"number"},{key:"transportId",type:"string"},{key:"writable",type:"boolean"}].reduce(function(e,n){return e[n.key]=typeof t[n.key]===n.type?t[n.key]:null,e},{localCandidate:c,remoteCandidate:s})}function v(e,t,n){var o="local"===n?"getSenders":"getReceivers";return e[o]?e[o]().map(function(e){return e.track}).filter(function(e){return e&&e.kind===t}):r(e["local"===n?"getLocalStreams":"getRemoteStreams"](),function(e){return e["audio"===t?"getAudioTracks":"getVideoTracks"]()})}function y(e,t){return new Promise(function(n,r){p&&p<67?e.getStats(function(e){n([m(e,t)])},null,r):e.getStats(t).then(function(e){n(function(e){var t=null,n=[],r=null,o=null,i=null,a=null;e.forEach(function(e){switch(e.type){case"inbound-rtp":t=e;break;case"outbound-rtp":n.push(e);break;case"track":i=e;break;case"codec":a=e;break;case"remote-inbound-rtp":r=e;break;case"remote-outbound-rtp":o=e}});var c=i&&i.remoteSource,s=[],u=c?o:r;return(c?[t]:n).forEach(function(e){var t={},n=[e,i,a,u&&u.ssrc===e.ssrc?u:null];function r(e){var t=n.find(function(t){return t&&void 0!==t[e]})||null;return t?t[e]:null}var o=r("ssrc");"number"==typeof o&&(t.ssrc=String(o));var l=r("timestamp");t.timestamp=Math.round(l);var f=r("mimeType");"string"==typeof f&&(f=f.split("/"),t.codecName=f[f.length-1]);var p=r("roundTripTime");"number"==typeof p&&(t.roundTripTime=Math.round(1e3*p));var d=r("jitter");"number"==typeof d&&(t.jitter=Math.round(1e3*d));var h=r("frameWidth");"number"==typeof h&&(c?t.frameWidthReceived=h:t.frameWidthSent=h);var v=r("frameHeight");"number"==typeof v&&(c?t.frameHeightReceived=v:t.frameHeightSent=v);var y=r("framesPerSecond");"number"==typeof y&&(t.frameRateSent=y);var m=r("bytesReceived");"number"==typeof m&&(t.bytesReceived=m);var g=r("bytesSent");"number"==typeof g&&(t.bytesSent=g);var b=r("packetsLost");"number"==typeof b&&(t.packetsLost=b);var _=r("packetsReceived");"number"==typeof _&&(t.packetsReceived=_);var w=r("packetsSent");"number"==typeof w&&(t.packetsSent=w);var k=r("audioLevel");"number"==typeof k&&(k=Math.round(32767*k),c?t.audioOutputLevel=k:t.audioInputLevel=k);var O=r("totalPacketSendDelay");"number"==typeof O&&(t.totalPacketSendDelay=O);var S=r("totalEncodeTime");"number"==typeof S&&(t.totalEncodeTime=S);var P=r("framesEncoded");"number"==typeof P&&(t.framesEncoded=P);var T=r("estimatedPlayoutTimestamp");"number"==typeof T&&(t.estimatedPlayoutTimestamp=T);var C=r("totalDecodeTime");"number"==typeof C&&(t.totalDecodeTime=C);var E=r("framesDecoded");"number"==typeof E&&(t.framesDecoded=E);var j=r("jitterBufferDelay");"number"==typeof j&&(t.jitterBufferDelay=j);var R=r("jitterBufferEmittedCount");"number"==typeof R&&(t.jitterBufferEmittedCount=R),s.push(t)}),s}(e))},r)})}function m(e,t){var n=e.result().find(function(e){return"ssrc"===e.type&&e.stat("googTrackId")===t.id}),r={};return n&&(r.timestamp=Math.round(Number(n.timestamp)),r=n.names().reduce(function(e,t){switch(t){case"googCodecName":e.codecName=n.stat(t);break;case"googRtt":e.roundTripTime=Number(n.stat(t));break;case"googJitterReceived":e.jitter=Number(n.stat(t));break;case"googFrameWidthInput":e.frameWidthInput=Number(n.stat(t));break;case"googFrameHeightInput":e.frameHeightInput=Number(n.stat(t));break;case"googFrameWidthSent":e.frameWidthSent=Number(n.stat(t));break;case"googFrameHeightSent":e.frameHeightSent=Number(n.stat(t));break;case"googFrameWidthReceived":e.frameWidthReceived=Number(n.stat(t));break;case"googFrameHeightReceived":e.frameHeightReceived=Number(n.stat(t));break;case"googFrameRateInput":e.frameRateInput=Number(n.stat(t));break;case"googFrameRateSent":e.frameRateSent=Number(n.stat(t));break;case"googFrameRateReceived":e.frameRateReceived=Number(n.stat(t));break;case"ssrc":e[t]=n.stat(t);break;case"bytesReceived":case"bytesSent":case"packetsLost":case"packetsReceived":case"packetsSent":case"audioInputLevel":case"audioOutputLevel":e[t]=Number(n.stat(t))}return e},r)),r}function g(e,t){e=e||new Map;var n=null,r=null;e.forEach(function(t){if(!t.isRemote)switch(t.type){case"inbound-rtp":n=t,r=e.get(t.remoteId);break;case"outbound-rtp":r=t,n=e.get(t.remoteId)}});var o=t?n:r,i=t?r:n;function a(e){return o&&void 0!==o[e]?o[e]:i&&void 0!==i[e]?i[e]:null}var c={},s=a("timestamp");c.timestamp=Math.round(s);var u=a("ssrc");"number"==typeof u&&(c.ssrc=String(u));var l=a("bytesSent");"number"==typeof l&&(c.bytesSent=l);var f=a("packetsLost");"number"==typeof f&&(c.packetsLost=f);var p=a("packetsSent");"number"==typeof p&&(c.packetsSent=p);var d=a("roundTripTime");"number"==typeof d&&(c.roundTripTime=Math.round(1e3*d));var h=a("jitter");"number"==typeof h&&(c.jitter=Math.round(1e3*h));var v=a("framerateMean");"number"==typeof v&&(c.frameRateSent=Math.round(v));var y=a("bytesReceived");"number"==typeof y&&(c.bytesReceived=y);var m=a("packetsReceived");"number"==typeof m&&(c.packetsReceived=m);var g=a("framerateMean");"number"==typeof g&&(c.frameRateReceived=Math.round(g));var b=a("totalPacketSendDelay");"number"==typeof b&&(c.totalPacketSendDelay=b);var _=a("totalEncodeTime");"number"==typeof _&&(c.totalEncodeTime=_);var w=a("framesEncoded");"number"==typeof w&&(c.framesEncoded=w);var k=a("estimatedPlayoutTimestamp");"number"==typeof k&&(c.estimatedPlayoutTimestamp=k);var O=a("totalDecodeTime");"number"==typeof O&&(c.totalDecodeTime=O);var S=a("framesDecoded");"number"==typeof S&&(c.framesDecoded=S);var P=a("jitterBufferDelay");"number"==typeof P&&(c.jitterBufferDelay=P);var T=a("jitterBufferEmittedCount");return"number"==typeof T&&(c.jitterBufferEmittedCount=T),c}e.exports=function(e,t){return e&&"function"==typeof e.getStats?function(e,t){var n=v(e,"audio","local"),o=v(e,"video","local"),i=v(e,"audio"),c=v(e,"video"),s={activeIceCandidatePair:null,localAudioTrackStats:[],localVideoTrackStats:[],remoteAudioTrackStats:[],remoteVideoTrackStats:[]},p=r([[n,"localAudioTrackStats",!1],[o,"localVideoTrackStats",!1],[i,"remoteAudioTrackStats",!0],[c,"remoteVideoTrackStats",!0]],function(n){var r=n[1],o=n[2];return n[0].map(function(n){return function(e,t,n){return void 0!==(n=n||{}).testForChrome||u?y(e,t):void 0!==n.testForFirefox||l?function(e,t,n){return new Promise(function(r,o){e.getStats(t).then(function(e){r([g(e,n)])},o)})}(e,t,n.isRemote):void 0!==n.testForSafari||f?void 0!==n.testForSafari||"unified"===a()?y(e,t):Promise.reject(new Error(["getStats() is not supported on this version of Safari","due to this bug: https://bugs.webkit.org/show_bug.cgi?id=192601"].join(" "))):Promise.reject(new Error("RTCPeerConnection#getStats() not supported"))}(e,n,Object.assign({isRemote:o},t)).then(function(e){e.forEach(function(e){e.trackId=n.id,s[r].push(e)})})})});return Promise.all(p).then(function(){return function(e,t){return void 0!==(t=t||{}).testForChrome||u||void 0!==t.testForSafari||f?e.getStats().then(d):void 0!==t.testForFirefox||l?e.getStats().then(h):Promise.reject(new Error("RTCPeerConnection#getStats() not supported"))}(e,t)}).then(function(e){return s.activeIceCandidatePair=e,s})}(e,t):Promise.reject(new Error("Given PeerConnection does not support getStats"))}},399:e=>{"use strict";e.exports=function(e){return"object"==typeof navigator&&"object"==typeof navigator.mediaDevices&&"function"==typeof navigator.mediaDevices.getUserMedia?(e=e||{audio:!0,video:!0},navigator.mediaDevices.getUserMedia(e)):Promise.reject(new Error("getUserMedia is not supported"))}},3738:(e,t,n)=>{"use strict";var r={};Object.defineProperties(r,{getStats:{enumerable:!0,value:n(6870)},getUserMedia:{enumerable:!0,value:n(399)},MediaStream:{enumerable:!0,value:n(1403)},MediaStreamTrack:{enumerable:!0,value:n(6878)},RTCIceCandidate:{enumerable:!0,value:n(8813)},RTCPeerConnection:{enumerable:!0,value:n(4613)},RTCSessionDescription:{enumerable:!0,value:n(6507)},version:{enumerable:!0,value:n(1610).i8}}),e.exports=r},1403:e=>{"use strict";e.exports="function"==typeof MediaStream?MediaStream:function(){throw new Error("MediaStream is not supported")}},6878:e=>{"use strict";e.exports="function"==typeof MediaStreamTrack?MediaStreamTrack:function(){throw new Error("MediaStreamTrack is not supported")}},8813:e=>{"use strict";e.exports="function"==typeof RTCIceCandidate?RTCIceCandidate:function(){throw new Error("RTCIceCandidate is not supported")}},5294:(e,t,n)=>{"use strict";var r=n(9345),o=n(7389),i=n(1036).inherits,a=n(2234),c=n(1403),s=n(6216),u=n(3608),l=n(7454);function f(e,t){if(!(this instanceof f))return new f(e,t);o.call(this),e=e||{};var n=Object.assign(e.iceTransportPolicy?{iceTransports:e.iceTransportPolicy}:{},e);l.interceptEvent(this,"datachannel"),l.interceptEvent(this,"signalingstatechange");var r=u.getSdpFormat(n.sdpSemantics),i=new RTCPeerConnection(n,t);Object.defineProperties(this,{_appliedTracksToSSRCs:{value:new Map,writable:!0},_localStream:{value:new c},_peerConnection:{value:i},_pendingLocalOffer:{value:null,writable:!0},_pendingRemoteOffer:{value:null,writable:!0},_rolledBackTracksToSSRCs:{value:new Map,writable:!0},_sdpFormat:{value:r},_senders:{value:new Map},_signalingStateLatch:{value:new a},_tracksToSSRCs:{value:new Map,writable:!0},localDescription:{enumerable:!0,get:function(){return this._pendingLocalOffer?this._pendingLocalOffer:i.localDescription}},remoteDescription:{enumerable:!0,get:function(){return this._pendingRemoteOffer?this._pendingRemoteOffer:i.remoteDescription}},signalingState:{enumerable:!0,get:function(){return this._pendingLocalOffer?"have-local-offer":this._pendingRemoteOffer?"have-remote-offer":i.signalingState}}});var s=this;i.addEventListener("datachannel",function(e){v(e.channel),s.dispatchEvent(e)}),i.addEventListener("signalingstatechange",function(){"stable"===i.signalingState&&(s._appliedTracksToSSRCs=new Map(s._tracksToSSRCs)),s._pendingLocalOffer||s._pendingRemoteOffer||s.dispatchEvent.apply(s,arguments)}),i.ontrack=function(){},"function"!=typeof RTCPeerConnection.prototype.addTrack&&i.addStream(this._localStream),l.proxyProperties(RTCPeerConnection.prototype,this,i)}function p(e,t,n){var r,o,i=t?e._pendingLocalOffer:e._pendingRemoteOffer,a=t?"have-local-offer":"have-remote-offer",c=t?"setLocalDescription":"setRemoteDescription";if(!t&&(t?e._pendingRemoteOffer:e._pendingLocalOffer)&&"answer"===n.type)r=function(e,t){return e._peerConnection.setLocalDescription(e._pendingLocalOffer).then(function(){return e._pendingLocalOffer=null,e.setRemoteDescription(t)}).then(function(){e._signalingStateLatch.lower()})}(e,n);else if("offer"===n.type){if(e.signalingState!==a&&"stable"!==e.signalingState)return Promise.reject(new Error("Cannot set "+(t?"local":"remote")+" offer in state "+e.signalingState));i||"low"!==e._signalingStateLatch.state||e._signalingStateLatch.raise();var s=e.signalingState;o=d(n),t?e._pendingLocalOffer=o:e._pendingRemoteOffer=o,r=Promise.resolve(),e.signalingState!==s&&r.then(function(){e.dispatchEvent(new Event("signalingstatechange"))})}else"rollback"===n.type&&(e.signalingState!==a?r=Promise.reject(new Error("Cannot rollback "+(t?"local":"remote")+" description in "+e.signalingState)):(t?e._pendingLocalOffer=null:e._pendingRemoteOffer=null,e._rolledBackTracksToSSRCs=new Map(e._tracksToSSRCs),e._tracksToSSRCs=new Map(e._appliedTracksToSSRCs),(r=Promise.resolve()).then(function(){e.dispatchEvent(new Event("signalingstatechange"))})));return r||e._peerConnection[c](d(n))}function d(e){return e instanceof r&&e._description?e._description:new RTCSessionDescription(e)}function h(){return"maxRetransmitTime"in RTCDataChannel.prototype&&!("maxPacketLifeTime"in RTCDataChannel.prototype)}function v(e){return Object.defineProperty(e,"maxRetransmits",{value:65535===e.maxRetransmits?null:e.maxRetransmits}),h()&&Object.defineProperty(e,"maxPacketLifeTime",{value:65535===e.maxRetransmitTime?null:e.maxRetransmitTime}),e}function y(e,t,n){return"unified"===e?u.updateUnifiedPlanTrackIdsToSSRCs(t,n):u.updatePlanBTrackIdsToSSRCs(t,n)}i(f,o),"function"!=typeof RTCPeerConnection.prototype.addTrack?(f.prototype.addTrack=function(){var e=[].slice.call(arguments),t=e[0];if("closed"===this._peerConnection.signalingState)throw new Error("Cannot add MediaStreamTrack ["+t.id+", "+t.kind+"]: RTCPeerConnection is closed");var n=this._senders.get(t);if(n&&n.track)throw new Error("Cannot add MediaStreamTrack ["+t.id+", "+t.kind+"]: RTCPeerConnection already has it");return this._peerConnection.removeStream(this._localStream),this._localStream.addTrack(t),this._peerConnection.addStream(this._localStream),n=new s(t),this._senders.set(t,n),n},f.prototype.removeTrack=function(e){if("closed"===this._peerConnection.signalingState)throw new Error("Cannot remove MediaStreamTrack: RTCPeerConnection is closed");var t=e.track;t&&(e=this._senders.get(t))&&e.track&&(e.track=null,this._peerConnection.removeStream(this._localStream),this._localStream.removeTrack(t),this._peerConnection.addStream(this._localStream))},f.prototype.getSenders=function(){return Array.from(this._senders.values())}):f.prototype.removeTrack=function(e){if("closed"===this._peerConnection.signalingState)throw new Error("Cannot remove MediaStreamTrack: RTCPeerConnection is closed");try{this._peerConnection.removeTrack(e)}catch(t){}},f.prototype.addIceCandidate=function(e){var t,n=[].slice.call(arguments),r=this;return t="have-remote-offer"===this.signalingState?this._signalingStateLatch.when("low").then(function(){return r._peerConnection.addIceCandidate(e)}):this._peerConnection.addIceCandidate(e),n.length>1?l.legacyPromise(t,n[1],n[2]):t},f.prototype.close=function(){"closed"!==this.signalingState&&(this._pendingLocalOffer=null,this._pendingRemoteOffer=null,this._peerConnection.close())},f.prototype.createAnswer=function(){var e,t=[].slice.call(arguments),n=this;return e=this._pendingRemoteOffer?this._peerConnection.setRemoteDescription(this._pendingRemoteOffer).then(function(){return n._signalingStateLatch.lower(),n._peerConnection.createAnswer()}).then(function(e){return n._pendingRemoteOffer=null,n._rolledBackTracksToSSRCs.clear(),new r({type:"answer",sdp:y(n._sdpFormat,n._tracksToSSRCs,e.sdp)})},function(e){throw n._pendingRemoteOffer=null,e}):this._peerConnection.createAnswer().then(function(e){return n._rolledBackTracksToSSRCs.clear(),new r({type:"answer",sdp:y(n._sdpFormat,n._tracksToSSRCs,e.sdp)})}),t.length>1?l.legacyPromise(e,t[0],t[1]):e},f.prototype.createOffer=function(){var e=[].slice.call(arguments),t=(e.length>1?e[2]:e[0])||{},n=this,o=this._peerConnection.createOffer(t).then(function(e){return n._rolledBackTracksToSSRCs.clear(),new r({type:e.type,sdp:y(n._sdpFormat,n._tracksToSSRCs,e.sdp)})});return e.length>1?l.legacyPromise(o,e[0],e[1]):o},f.prototype.createDataChannel=function(e,t){t=function(e){return e=Object.assign({},e),h()&&"maxPacketLifeTime"in e&&(e.maxRetransmitTime=e.maxPacketLifeTime),e}(t);var n=this._peerConnection.createDataChannel(e,t);return v(n),n},f.prototype.setLocalDescription=function(){var e=[].slice.call(arguments),t=e[0];this._rolledBackTracksToSSRCs.size>0&&(this._tracksToSSRCs=new Map(this._rolledBackTracksToSSRCs),this._rolledBackTracksToSSRCs.clear());var n=p(this,!0,t);return e.length>1?l.legacyPromise(n,e[1],e[2]):n},f.prototype.setRemoteDescription=function(){var e=[].slice.call(arguments),t=e[0];this._rolledBackTracksToSSRCs.clear();var n=p(this,!1,t);return e.length>1?l.legacyPromise(n,e[1],e[2]):n},l.delegateMethods(RTCPeerConnection.prototype,f.prototype,"_peerConnection"),e.exports=f},8321:(e,t,n)=>{"use strict";var r=n(7389),o=n(8101),i=n(1036).inherits,a=n(3608).updateUnifiedPlanTrackIdsToSSRCs,c=n(7454),s="object"==typeof navigator&&navigator.userAgent&&(navigator.userAgent.match(/Firefox\/61/)||navigator.userAgent.match(/Firefox\/62/));function u(e){if(!(this instanceof u))return new u(e);r.call(this),c.interceptEvent(this,"signalingstatechange");var t=new RTCPeerConnection(e);Object.defineProperties(this,{_initiallyNegotiatedDtlsRole:{value:null,writable:!0},_isClosed:{value:!1,writable:!0},_peerConnection:{value:t},_rollingBack:{value:!1,writable:!0},_tracksToSSRCs:{value:new Map},iceGatheringState:{enumerable:!0,get:function(){return this._isClosed?"complete":this._peerConnection.iceGatheringState}},localDescription:{enumerable:!0,get:function(){return p(this._peerConnection.localDescription,this._initiallyNegotiatedDtlsRole)}},signalingState:{enumerable:!0,get:function(){return this._isClosed?"closed":this._peerConnection.signalingState}}});var n,o=this;t.addEventListener("signalingstatechange",function(){if(!o._rollingBack&&o.signalingState!==n){n=o.signalingState;var e=o.dispatchEvent.apply.bind(o.dispatchEvent,o,arguments);o._isClosed?setTimeout(e):e()}}),c.proxyProperties(RTCPeerConnection.prototype,this,t)}function l(e,t,n){var r=t?"setLocalDescription":"setRemoteDescription";return e._rollingBack=!0,e._peerConnection[r](new o({type:"rollback"})).then(n).then(function(t){return e._rollingBack=!1,t},function(t){throw e._rollingBack=!1,t})}function f(e,t,n){if(!e._initiallyNegotiatedDtlsRole&&"offer"!==t.type){var r=t.sdp.match(/a=setup:([a-z]+)/);if(r){var o=r[1];e._initiallyNegotiatedDtlsRole=n?{active:"passive",passive:"active"}[o]:o}}}function p(e,t){return e&&"answer"===e.type&&t?new o({type:e.type,sdp:e.sdp.replace(/a=setup:[a-z]+/g,"a=setup:"+t)}):e}i(u,r),Object.defineProperty(u.prototype,"peerIdentity",{enumerable:!0,value:Promise.resolve({idp:"",name:""})}),s&&(u.prototype.addTrack=function(){var e=arguments[0],t=this._peerConnection.addTrack.apply(this._peerConnection,arguments);return t.replaceTrack(e),t}),u.prototype.createAnswer=function(){var e,t=[].slice.call(arguments),n=this;return e=this._peerConnection.createAnswer().then(function(e){return f(n,e),p(e,n._initiallyNegotiatedDtlsRole)}),"function"==typeof t[0]?c.legacyPromise(e,t[0],t[1]):e},u.prototype.createOffer=function(){var e,t=[].slice.call(arguments),n=(t.length>1?t[2]:t[0])||{},r=this;if("have-local-offer"===this.signalingState||"have-remote-offer"===this.signalingState){var i="have-local-offer"===this.signalingState;e=l(this,i,function(){return r.createOffer(n)})}else e=r._peerConnection.createOffer(n);return e=e.then(function(e){return new o({type:e.type,sdp:a(r._tracksToSSRCs,e.sdp)})}),t.length>1?c.legacyPromise(e,t[0],t[1]):e},u.prototype.setLocalDescription=function(){var e,t=[].slice.call(arguments),n=t[0];return n&&"answer"===n.type&&"have-local-offer"===this.signalingState&&(e=Promise.reject(new Error("Cannot set local answer in state have-local-offer"))),e?t.length>1?c.legacyPromise(e,t[1],t[2]):e:this._peerConnection.setLocalDescription.apply(this._peerConnection,t)},u.prototype.setRemoteDescription=function(){var e,t=[].slice.call(arguments),n=t[0],r=this;return n&&"have-remote-offer"===this.signalingState&&("answer"===n.type?e=Promise.reject(new Error("Cannot set remote answer in state have-remote-offer")):"offer"===n.type&&(e=l(this,!1,function(){return r._peerConnection.setRemoteDescription(n)}))),e||(e=this._peerConnection.setRemoteDescription(n)),e=e.then(function(){f(r,n,!0)}),t.length>1?c.legacyPromise(e,t[1],t[2]):e},u.prototype.close=function(){"closed"!==this.signalingState&&(this._isClosed=!0,this._peerConnection.close())},c.delegateMethods(RTCPeerConnection.prototype,u.prototype,"_peerConnection"),e.exports=u},4613:(e,t,n)=>{"use strict";if("function"==typeof RTCPeerConnection)switch((0,n(7454).guessBrowser)()){case"chrome":e.exports=n(5294);break;case"firefox":e.exports=n(8321);break;case"safari":e.exports=n(7566);break;default:e.exports=RTCPeerConnection}else e.exports=function(){throw new Error("RTCPeerConnection is not supported")}},7566:(e,t,n)=>{"use strict";var r=n(7389),o=n(1036).inherits,i=n(2234),a=n(3608),c=n(7454),s="unified"===a.getSdpFormat(),u=s?a.updateUnifiedPlanTrackIdsToSSRCs:a.updatePlanBTrackIdsToSSRCs;function l(e){if(!(this instanceof l))return new l(e);r.call(this),c.interceptEvent(this,"datachannel"),c.interceptEvent(this,"iceconnectionstatechange"),c.interceptEvent(this,"signalingstatechange"),c.interceptEvent(this,"track");var t=new RTCPeerConnection(e);Object.defineProperties(this,{_appliedTracksToSSRCs:{value:new Map,writable:!0},_audioTransceiver:{value:null,writable:!0},_isClosed:{value:!1,writable:!0},_peerConnection:{value:t},_pendingLocalOffer:{value:null,writable:!0},_pendingRemoteOffer:{value:null,writable:!0},_rolledBackTracksToSSRCs:{value:new Map,writable:!0},_signalingStateLatch:{value:new i},_tracksToSSRCs:{value:new Map,writable:!0},_videoTransceiver:{value:null,writable:!0},localDescription:{enumerable:!0,get:function(){return this._pendingLocalOffer||this._peerConnection.localDescription}},iceConnectionState:{enumerable:!0,get:function(){return this._isClosed?"closed":this._peerConnection.iceConnectionState}},iceGatheringState:{enumerable:!0,get:function(){return this._isClosed?"complete":this._peerConnection.iceGatheringState}},remoteDescription:{enumerable:!0,get:function(){return this._pendingRemoteOffer||this._peerConnection.remoteDescription}},signalingState:{enumerable:!0,get:function(){return this._isClosed?"closed":this._pendingLocalOffer?"have-local-offer":this._pendingRemoteOffer?"have-remote-offer":this._peerConnection.signalingState}}});var n=this;t.addEventListener("datachannel",function(e){d(e.channel),n.dispatchEvent(e)}),t.addEventListener("iceconnectionstatechange",function(){n._isClosed||n.dispatchEvent.apply(n,arguments)}),t.addEventListener("signalingstatechange",function(){n._isClosed||("stable"===t.signalingState&&(n._appliedTracksToSSRCs=new Map(n._tracksToSSRCs)),n._pendingLocalOffer||n._pendingRemoteOffer||n.dispatchEvent.apply(n,arguments))}),t.addEventListener("track",function(e){n._pendingRemoteOffer=null,n.dispatchEvent(e)}),c.proxyProperties(RTCPeerConnection.prototype,this,t)}function f(e,t,n){var r,o=t?e._pendingLocalOffer:e._pendingRemoteOffer,i=t?"have-local-offer":"have-remote-offer",a=t?"setLocalDescription":"setRemoteDescription";if(!t&&(t?e._pendingRemoteOffer:e._pendingLocalOffer)&&"answer"===n.type)return function(e,t){return e._peerConnection.setLocalDescription(e._pendingLocalOffer).then(function(){return e._pendingLocalOffer=null,e.setRemoteDescription(t)}).then(function(){e._signalingStateLatch.lower()})}(e,n);if("offer"===n.type){if(e.signalingState!==i&&"stable"!==e.signalingState)return Promise.reject(new Error("Cannot set "+(t?"local":"remote")+" offer in state "+e.signalingState));o||"low"!==e._signalingStateLatch.state||e._signalingStateLatch.raise();var c=e.signalingState;return r=n,t?e._pendingLocalOffer=r:e._pendingRemoteOffer=r,e.signalingState!==c?Promise.resolve().then(function(){e.dispatchEvent(new Event("signalingstatechange"))}):Promise.resolve()}return"rollback"===n.type?e.signalingState!==i?Promise.reject(new Error("Cannot rollback "+(t?"local":"remote")+" description in "+e.signalingState)):(t?e._pendingLocalOffer=null:e._pendingRemoteOffer=null,e._rolledBackTracksToSSRCs=new Map(e._tracksToSSRCs),e._tracksToSSRCs=new Map(e._appliedTracksToSSRCs),Promise.resolve().then(function(){e.dispatchEvent(new Event("signalingstatechange"))})):e._peerConnection[a](n)}function p(e,t){return!!e.getTransceivers().find(function(e){return e.receiver&&e.receiver.track&&e.receiver.track.kind===t})}function d(e){return Object.defineProperties(e,{maxPacketLifeTime:{value:65535===e.maxPacketLifeTime?null:e.maxPacketLifeTime},maxRetransmits:{value:65535===e.maxRetransmits?null:e.maxRetransmits}})}o(l,r),l.prototype.addIceCandidate=function(e){var t=this;return"have-remote-offer"===this.signalingState?this._signalingStateLatch.when("low").then(function(){return t._peerConnection.addIceCandidate(e)}):this._peerConnection.addIceCandidate(e)},l.prototype.createOffer=function(e){e=Object.assign({},e);var t=this;if(e.offerToReceiveAudio&&!this._audioTransceiver&&(!s||!p(this,"audio"))){delete e.offerToReceiveAudio;try{this._audioTransceiver=s?this.addTransceiver("audio",{direction:"recvonly"}):this.addTransceiver("audio")}catch(n){return Promise.reject(n)}}if(e.offerToReceiveVideo&&!this._videoTransceiver&&(!s||!p(this,"video"))){delete e.offerToReceiveVideo;try{this._videoTransceiver=s?this.addTransceiver("video",{direction:"recvonly"}):this.addTransceiver("video")}catch(n){return Promise.reject(n)}}return this._peerConnection.createOffer(e).then(function(e){return t._rolledBackTracksToSSRCs.clear(),new RTCSessionDescription({type:e.type,sdp:u(t._tracksToSSRCs,e.sdp)})})},l.prototype.createAnswer=function(e){var t=this;return this._pendingRemoteOffer?this._peerConnection.setRemoteDescription(this._pendingRemoteOffer).then(function(){return t._signalingStateLatch.lower(),t._peerConnection.createAnswer()}).then(function(e){return t._pendingRemoteOffer=null,t._rolledBackTracksToSSRCs.clear(),s?new RTCSessionDescription({type:e.type,sdp:u(t._tracksToSSRCs,e.sdp)}):e},function(e){throw t._pendingRemoteOffer=null,e}):this._peerConnection.createAnswer(e).then(function(e){return t._rolledBackTracksToSSRCs.clear(),s?new RTCSessionDescription({type:e.type,sdp:u(t._tracksToSSRCs,e.sdp)}):e})},l.prototype.createDataChannel=function(e,t){var n=this._peerConnection.createDataChannel(e,t);return d(n),n},l.prototype.removeTrack=function(e){e.replaceTrack(null),this._peerConnection.removeTrack(e)},l.prototype.setLocalDescription=function(e){return this._rolledBackTracksToSSRCs.size>0&&(this._tracksToSSRCs=new Map(this._rolledBackTracksToSSRCs),this._rolledBackTracksToSSRCs.clear()),f(this,!0,e)},l.prototype.setRemoteDescription=function(e){return this._rolledBackTracksToSSRCs.clear(),f(this,!1,e)},l.prototype.close=function(){if(!this._isClosed){this._isClosed=!0,this._peerConnection.close();var e=this;setTimeout(function(){e.dispatchEvent(new Event("iceconnectionstatechange")),e.dispatchEvent(new Event("signalingstatechange"))})}},c.delegateMethods(RTCPeerConnection.prototype,l.prototype,"_peerConnection"),e.exports=l},6216:e=>{"use strict";e.exports=function(e){Object.defineProperties(this,{track:{enumerable:!0,value:e,writable:!0}})}},9345:e=>{"use strict";e.exports=function e(t){if(!(this instanceof e))return new e(t);var n=t&&"rollback"===t.type?null:new RTCSessionDescription(t);Object.defineProperties(this,{_description:{get:function(){return n}},sdp:{enumerable:!0,value:n?n.sdp:t.sdp},type:{enumerable:!0,value:n?n.type:t.type}})}},8101:e=>{"use strict";e.exports=RTCSessionDescription},6507:(e,t,n)=>{"use strict";if("function"==typeof RTCSessionDescription)switch((0,n(7454).guessBrowser)()){case"chrome":e.exports=n(9345);break;case"firefox":e.exports=n(8101);break;default:e.exports=RTCSessionDescription}else e.exports=function(){throw new Error("RTCSessionDescription is not supported")}},7389:(e,t,n)=>{"use strict";var r=n(5068).EventEmitter;function o(){Object.defineProperties(this,{_eventEmitter:{value:new r}})}o.prototype.dispatchEvent=function(e){return this._eventEmitter.emit(e.type,e)},o.prototype.addEventListener=function(){return this._eventEmitter.addListener.apply(this._eventEmitter,arguments)},o.prototype.removeEventListener=function(){return this._eventEmitter.removeListener.apply(this._eventEmitter,arguments)},e.exports=o},7454:(e,t)=>{"use strict";function n(e,t,n,r){if(!(r in t)&&!r.match(/^on[a-z]+$/)){var o=!1;try{var i=Object.getOwnPropertyDescriptor(e,r);o=i&&!!i.get}catch(c){}if(!o){var a;try{a=typeof e[r]}catch(c){}"function"===a&&(t[r]=function(){return this[n][r].apply(this[n],arguments)})}}}function r(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:null}function o(e){return void 0===e&&(e=r()),/Chrome|CriOS/.test(e)?"chrome":/Firefox|FxiOS/.test(e)?"firefox":/Safari/.test(e)?"safari":null}t.defer=function(){var e={};return e.promise=new Promise(function(t,n){e.resolve=t,e.reject=n}),e},t.delegateMethods=function(e,t,r){for(var o in e)n(e,t,r,o)},t.difference=function(e,t){e=Array.isArray(e)?new Set(e):new Set(e.values()),t=Array.isArray(t)?new Set(t):new Set(t.values());var n=new Set;return e.forEach(function(e){t.has(e)||n.add(e)}),n},t.flatMap=function(e,t){return(e instanceof Map||e instanceof Set?Array.from(e.values()):e).reduce(function(e,n){var r=t(n);return e.concat(r)},[])},t.guessBrowser=o,t.guessBrowserVersion=function(e){void 0===e&&(e=r());var t={chrome:"Chrome|CriOS",firefox:"Firefox|FxiOS",safari:"Version"}[o(e)];if(!t)return null;var n=new RegExp("("+t+")/([^\\s]+)"),i=(e.match(n)||[])[2];if(!i)return null;var a=i.split(".").map(Number);return{major:isNaN(a[0])?null:a[0],minor:isNaN(a[1])?null:a[1]}},t.interceptEvent=function(e,t){var n=null;Object.defineProperty(e,"on"+t,{get:function(){return n},set:function(e){n&&this.removeEventListener(t,n),"function"==typeof e?this.addEventListener(t,n=e):n=null}})},t.legacyPromise=function(e,t,n){return t?e.then(function(e){t(e)},function(e){n(e)}):e},t.makeUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},t.proxyProperties=function(e,t,n){Object.getOwnPropertyNames(e).forEach(function(e){!function(e,t,n,r){r in t||(r.match(/^on[a-z]+$/)?(Object.defineProperty(t,r,{value:null,writable:!0}),n.addEventListener(r.slice(2),function(){t.dispatchEvent.apply(t,arguments)})):Object.defineProperty(t,r,{enumerable:!0,get:function(){return n[r]}}))}(0,t,n,e)})},t.support=function(){return"object"==typeof navigator&&"object"==typeof navigator.mediaDevices&&"function"==typeof navigator.mediaDevices.getUserMedia&&"function"==typeof RTCPeerConnection}},2234:(e,t,n)=>{"use strict";var r=n(7454).defer,o={high:new Set(["low"]),low:new Set(["high"])};function i(e){if(!(this instanceof i))return new i(e);var t=e||"low";Object.defineProperties(this,{_state:{set:function(e){if(t!==e){var n=this._whenDeferreds.get(t=e);n.forEach(function(e){e.resolve(this)},this),n.clear()}},get:function(){return t}},_whenDeferreds:{value:new Map([["high",new Set],["low",new Set]])},state:{enumerable:!0,get:function(){return this._state}}})}function a(e,t){return new Error('Cannot transition from "'+e+'" to "'+t+'"')}i.prototype.lower=function(){return this.transition("low")},i.prototype.raise=function(){return this.transition("high")},i.prototype.transition=function(e){if(!o[this.state].has(e))throw a(this.state,e);return this._state=e,this},i.prototype.when=function(e){if(this.state===e)return Promise.resolve(this);if(!o[this.state].has(e))return Promise.reject(a(this.state,e));var t=r();return this._whenDeferreds.get(e).add(t),t.promise},e.exports=i},3608:(e,t,n)=>{"use strict";var r=n(7454).flatMap,o=n(7454).guessBrowser,i=null,a=null;function c(e){return e&&function(){if("boolean"==typeof i)return i;if("undefined"==typeof RTCPeerConnection)return i=!1;try{new RTCPeerConnection({sdpSemantics:"foo"}),i=!1}catch(e){i=!0}return i}()?{"plan-b":"planb","unified-plan":"unified"}[e]:function(){if(!a)if("undefined"!=typeof RTCPeerConnection&&"addTransceiver"in RTCPeerConnection.prototype)try{(new RTCPeerConnection).addTransceiver("audio"),a="unified"}catch(e){a="planb"}else a="planb";return a}()}function s(e,t){return(t.match(new RegExp(e,"gm"))||[]).reduce(function(t,n){var r=n.match(new RegExp(e));return r?t.add(r[1]):t},new Set)}function u(e,t){return s(e,t)}function l(e){return u("^a=ssrc:[0-9]+ +msid:.+ +(.+) *$",e)}function f(e){return u("^a=msid:.+ +(.+) *$",e)}function p(e,t){return s("^a=ssrc:([0-9]+) +msid:[^ ]+ +"+t+" *$",e)}function d(e,t,n){return t=t||".*",n=n||".*",e.split("\r\nm=").slice(1).map(function(e){return"m="+e}).filter(function(e){var r=new RegExp("m="+t,"gm"),o=new RegExp("a="+n,"gm");return r.test(e)&&o.test(e)})}function h(e){return Array.from(s("^a=ssrc:([0-9]+) +.*$",e))}function v(e,t){var n=d(e),o=new RegExp("^a=msid:[^ ]+ +"+t+" *$","gm"),i=n.filter(function(e){return e.match(o)});return new Set(r(i,h))}function y(e,t,n){return new Map(Array.from(e(n)).map(function(e){return[e,t(n,e)]}))}function m(e){return y(l,p,e)}function g(e){return y(f,v,e)}function b(e,t,n){var r=e(n),o=new Map;r.forEach(function(e,r){if(t.has(r)){var i=Array.from(t.get(r)),a=Array.from(e);i.forEach(function(e,t){var r=a[t];o.set(r,e);var i="a=ssrc:"+e+" $1";n=n.replace(new RegExp("^a=ssrc:"+r+" (.*)$","gm"),i)})}else t.set(r,e)});var i="^(a=ssrc-group:[^ ]+ +)(.*)$";return(n.match(new RegExp(i,"gm"))||[]).forEach(function(e){var t=e.match(new RegExp(i));if(t){var r=t[1],a=t[2].split(" ").map(function(e){return o.get(e)||e}).join(" ");n=n.replace(t[0],r+a)}}),n}t.getSdpFormat=function(e){return{chrome:c(e),firefox:"unified",safari:"undefined"!=typeof RTCRtpTransceiver&&"currentDirection"in RTCRtpTransceiver.prototype?"unified":"planb"}[o()]||null},t.getMediaSections=d,t.getPlanBTrackIds=l,t.getUnifiedPlanTrackIds=f,t.getPlanBSSRCs=p,t.getUnifiedPlanSSRCs=v,t.updatePlanBTrackIdsToSSRCs=function(e,t){return b(m,e,t)},t.updateUnifiedPlanTrackIdsToSSRCs=function(e,t){return b(g,e,t)}},2322:e=>{"use strict";var t=["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"];e.exports=function(){for(var e=[],n=0;n<t.length;n++)"function"==typeof global[t[n]]&&(e[e.length]=t[n]);return e}},4641:(e,t,n)=>{var r=n(3337),o=n(8962),i=n(5893),a=n(8026);e.exports.Backoff=r,e.exports.FunctionCall=a,e.exports.FibonacciStrategy=i,e.exports.ExponentialStrategy=o,e.exports.fibonacci=function(e){return new r(new i(e))},e.exports.exponential=function(e){return new r(new o(e))},e.exports.call=function(e,t,n){var r=Array.prototype.slice.call(arguments);return e=r[0],t=r.slice(1,r.length-1),new a(e,t,n=r[r.length-1])}},3337:(e,t,n)=>{var r=n(5068),o=n(5998);function i(e){r.EventEmitter.call(this),this.backoffStrategy_=e,this.maxNumberOfRetry_=-1,this.backoffNumber_=0,this.backoffDelay_=0,this.timeoutID_=-1,this.handlers={backoff:this.onBackoff_.bind(this)}}n(1036).inherits(i,r.EventEmitter),i.prototype.failAfter=function(e){o.checkArgument(e>0,"Expected a maximum number of retry greater than 0 but got %s.",e),this.maxNumberOfRetry_=e},i.prototype.backoff=function(e){o.checkState(-1===this.timeoutID_,"Backoff in progress."),this.backoffNumber_===this.maxNumberOfRetry_?(this.emit("fail",e),this.reset()):(this.backoffDelay_=this.backoffStrategy_.next(),this.timeoutID_=setTimeout(this.handlers.backoff,this.backoffDelay_),this.emit("backoff",this.backoffNumber_,this.backoffDelay_,e))},i.prototype.onBackoff_=function(){this.timeoutID_=-1,this.emit("ready",this.backoffNumber_,this.backoffDelay_),this.backoffNumber_++},i.prototype.reset=function(){this.backoffNumber_=0,this.backoffStrategy_.reset(),clearTimeout(this.timeoutID_),this.timeoutID_=-1},e.exports=i},8026:(e,t,n)=>{var r=n(5068),o=n(5998),i=n(1036),a=n(3337),c=n(5893);function s(e,t,n){r.EventEmitter.call(this),o.checkIsFunction(e,"Expected fn to be a function."),o.checkIsArray(t,"Expected args to be an array."),o.checkIsFunction(n,"Expected callback to be a function."),this.function_=e,this.arguments_=t,this.callback_=n,this.lastResult_=[],this.numRetries_=0,this.backoff_=null,this.strategy_=null,this.failAfter_=-1,this.retryPredicate_=s.DEFAULT_RETRY_PREDICATE_,this.state_=s.State_.PENDING}i.inherits(s,r.EventEmitter),s.State_={PENDING:0,RUNNING:1,COMPLETED:2,ABORTED:3},s.DEFAULT_RETRY_PREDICATE_=function(e){return!0},s.prototype.isPending=function(){return this.state_==s.State_.PENDING},s.prototype.isRunning=function(){return this.state_==s.State_.RUNNING},s.prototype.isCompleted=function(){return this.state_==s.State_.COMPLETED},s.prototype.isAborted=function(){return this.state_==s.State_.ABORTED},s.prototype.setStrategy=function(e){return o.checkState(this.isPending(),"FunctionCall in progress."),this.strategy_=e,this},s.prototype.retryIf=function(e){return o.checkState(this.isPending(),"FunctionCall in progress."),this.retryPredicate_=e,this},s.prototype.getLastResult=function(){return this.lastResult_.concat()},s.prototype.getNumRetries=function(){return this.numRetries_},s.prototype.failAfter=function(e){return o.checkState(this.isPending(),"FunctionCall in progress."),this.failAfter_=e,this},s.prototype.abort=function(){this.isCompleted()||this.isAborted()||(this.isRunning()&&this.backoff_.reset(),this.state_=s.State_.ABORTED,this.lastResult_=[new Error("Backoff aborted.")],this.emit("abort"),this.doCallback_())},s.prototype.start=function(e){o.checkState(!this.isAborted(),"FunctionCall is aborted."),o.checkState(this.isPending(),"FunctionCall already started.");var t=this.strategy_||new c;this.backoff_=e?e(t):new a(t),this.backoff_.on("ready",this.doCall_.bind(this,!0)),this.backoff_.on("fail",this.doCallback_.bind(this)),this.backoff_.on("backoff",this.handleBackoff_.bind(this)),this.failAfter_>0&&this.backoff_.failAfter(this.failAfter_),this.state_=s.State_.RUNNING,this.doCall_(!1)},s.prototype.doCall_=function(e){e&&this.numRetries_++;var t=["call"].concat(this.arguments_);r.EventEmitter.prototype.emit.apply(this,t);var n=this.handleFunctionCallback_.bind(this);this.function_.apply(null,this.arguments_.concat(n))},s.prototype.doCallback_=function(){this.callback_.apply(null,this.lastResult_)},s.prototype.handleFunctionCallback_=function(){if(!this.isAborted()){var e=Array.prototype.slice.call(arguments);this.lastResult_=e,r.EventEmitter.prototype.emit.apply(this,["callback"].concat(e));var t=e[0];t&&this.retryPredicate_(t)?this.backoff_.backoff(t):(this.state_=s.State_.COMPLETED,this.doCallback_())}},s.prototype.handleBackoff_=function(e,t,n){this.emit("backoff",e,t,n)},e.exports=s},8962:(e,t,n)=>{var r=n(1036),o=n(5998),i=n(5191);function a(e){i.call(this,e),this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay(),this.factor_=a.DEFAULT_FACTOR,e&&void 0!==e.factor&&(o.checkArgument(e.factor>1,"Exponential factor should be greater than 1 but got %s.",e.factor),this.factor_=e.factor)}r.inherits(a,i),a.DEFAULT_FACTOR=2,a.prototype.next_=function(){return this.backoffDelay_=Math.min(this.nextBackoffDelay_,this.getMaxDelay()),this.nextBackoffDelay_=this.backoffDelay_*this.factor_,this.backoffDelay_},a.prototype.reset_=function(){this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay()},e.exports=a},5893:(e,t,n)=>{var r=n(1036),o=n(5191);function i(e){o.call(this,e),this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay()}r.inherits(i,o),i.prototype.next_=function(){var e=Math.min(this.nextBackoffDelay_,this.getMaxDelay());return this.nextBackoffDelay_+=this.backoffDelay_,this.backoffDelay_=e,e},i.prototype.reset_=function(){this.nextBackoffDelay_=this.getInitialDelay(),this.backoffDelay_=0},e.exports=i},5191:(e,t,n)=>{function r(e){return null!=e}function o(e){if(r((e=e||{}).initialDelay)&&e.initialDelay<1)throw new Error("The initial timeout must be greater than 0.");if(r(e.maxDelay)&&e.maxDelay<1)throw new Error("The maximal timeout must be greater than 0.");if(this.initialDelay_=e.initialDelay||100,this.maxDelay_=e.maxDelay||1e4,this.maxDelay_<=this.initialDelay_)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");if(r(e.randomisationFactor)&&(e.randomisationFactor<0||e.randomisationFactor>1))throw new Error("The randomisation factor must be between 0 and 1.");this.randomisationFactor_=e.randomisationFactor||0}n(5068),n(1036),o.prototype.getMaxDelay=function(){return this.maxDelay_},o.prototype.getInitialDelay=function(){return this.initialDelay_},o.prototype.next=function(){var e=this.next_(),t=1+Math.random()*this.randomisationFactor_;return Math.round(e*t)},o.prototype.next_=function(){throw new Error("BackoffStrategy.next_() unimplemented.")},o.prototype.reset=function(){this.reset_()},o.prototype.reset_=function(){throw new Error("BackoffStrategy.reset_() unimplemented.")},e.exports=o},9808:(e,t,n)=>{"use strict";var r=n(3789),o=n(7383),i=o(r("String.prototype.indexOf"));e.exports=function(e,t){var n=r(e,!!t);return"function"==typeof n&&i(e,".prototype.")>-1?o(n):n}},7383:(e,t,n)=>{"use strict";var r=n(8381),o=n(3789),i=o("%Function.prototype.apply%"),a=o("%Function.prototype.call%"),c=o("%Reflect.apply%",!0)||r.call(a,i),s=o("%Object.getOwnPropertyDescriptor%",!0),u=o("%Object.defineProperty%",!0),l=o("%Math.max%");if(u)try{u({},"a",{value:1})}catch(p){u=null}e.exports=function(e){var t=c(r,a,arguments);if(s&&u){var n=s(t,"length");n.configurable&&u(t,"length",{value:1+l(0,e.length-(arguments.length-1))})}return t};var f=function(){return c(r,i,arguments)};u?u(e.exports,"apply",{value:f}):e.exports.apply=f},3278:(e,t,n)=>{"use strict";var r=n(3789)("%Object.getOwnPropertyDescriptor%");if(r)try{r([],"length")}catch(o){r=null}e.exports=r},5068:e=>{"use strict";var t,n="object"==typeof Reflect?Reflect:null,r=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function i(){i.init.call(this)}e.exports=i,e.exports.once=function(e,t){return new Promise(function(n,r){function o(n){e.removeListener(t,i),r(n)}function i(){"function"==typeof e.removeListener&&e.removeListener("error",o),n([].slice.call(arguments))}v(e,t,i,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&v(e,"error",t,{once:!0})}(e,o)})},i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var a=10;function c(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function s(e){return void 0===e._maxListeners?i.defaultMaxListeners:e._maxListeners}function u(e,t,n,r){var o,i,a;if(c(n),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events),a=i[t]),void 0===a)a=i[t]=n,++e._eventsCount;else if("function"==typeof a?a=i[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(o=s(e))>0&&a.length>o&&!a.warned){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,console&&console.warn&&console.warn(u)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},o=l.bind(r);return o.listener=n,r.wrapFn=o,o}function p(e,t,n){var r=e._events;if(void 0===r)return[];var o=r[t];return void 0===o?[]:"function"==typeof o?n?[o.listener||o]:[o]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(o):h(o,o.length)}function d(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function h(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function v(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,function o(i){r.once&&e.removeEventListener(t,o),n(i)})}}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),i.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},i.prototype.getMaxListeners=function(){return s(this)},i.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var o="error"===e,i=this._events;if(void 0!==i)o=o&&void 0===i.error;else if(!o)return!1;if(o){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var c=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw c.context=a,c}var s=i[e];if(void 0===s)return!1;if("function"==typeof s)r(s,this,t);else{var u=s.length,l=h(s,u);for(n=0;n<u;++n)r(l[n],this,t)}return!0},i.prototype.on=i.prototype.addListener=function(e,t){return u(this,e,t,!1)},i.prototype.prependListener=function(e,t){return u(this,e,t,!0)},i.prototype.once=function(e,t){return c(t),this.on(e,f(this,e,t)),this},i.prototype.prependOnceListener=function(e,t){return c(t),this.prependListener(e,f(this,e,t)),this},i.prototype.off=i.prototype.removeListener=function(e,t){var n,r,o,i,a;if(c(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(o=-1,i=n.length-1;i>=0;i--)if(n[i]===t||n[i].listener===t){a=n[i].listener,o=i;break}if(o<0)return this;0===o?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,o),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},i.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var o,i=Object.keys(n);for(r=0;r<i.length;++r)"removeListener"!==(o=i[r])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},i.prototype.listeners=function(e){return p(this,e,!0)},i.prototype.rawListeners=function(e){return p(this,e,!1)},i.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):d.call(e,t)},i.prototype.listenerCount=d,i.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},9474:e=>{var t=Object.prototype.hasOwnProperty,n=Object.prototype.toString;e.exports=function(e,r,o){if("[object Function]"!==n.call(r))throw new TypeError("iterator must be a function");var i=e.length;if(i===+i)for(var a=0;a<i;a++)r.call(o,e[a],a,e);else for(var c in e)t.call(e,c)&&r.call(o,e[c],c,e)}},8404:e=>{"use strict";var t="Function.prototype.bind called on incompatible ",n=Array.prototype.slice,r=Object.prototype.toString,o="[object Function]";e.exports=function(e){var i=this;if("function"!=typeof i||r.call(i)!==o)throw new TypeError(t+i);for(var a,c=n.call(arguments,1),s=function(){if(this instanceof a){var t=i.apply(this,c.concat(n.call(arguments)));return Object(t)===t?t:this}return i.apply(e,c.concat(n.call(arguments)))},u=Math.max(0,i.length-c.length),l=[],f=0;f<u;f++)l.push("$"+f);if(a=Function("binder","return function ("+l.join(",")+"){ return binder.apply(this,arguments); }")(s),i.prototype){var p=function(){};p.prototype=i.prototype,a.prototype=new p,p.prototype=null}return a}},8381:(e,t,n)=>{"use strict";var r=n(8404);e.exports=Function.prototype.bind||r},3789:(e,t,n)=>{"use strict";var r,o=SyntaxError,i=Function,a=TypeError,c=function(e){try{return i('"use strict"; return ('+e+").constructor;")()}catch(t){}},s=Object.getOwnPropertyDescriptor;if(s)try{s({},"")}catch(E){s=null}var u=function(){throw new a},l=s?function(){try{return u}catch(e){try{return s(arguments,"callee").get}catch(t){return u}}}():u,f=n(5618)(),p=Object.getPrototypeOf||function(e){return e.__proto__},d={},h="undefined"==typeof Uint8Array?r:p(Uint8Array),v={"%AggregateError%":"undefined"==typeof AggregateError?r:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?r:ArrayBuffer,"%ArrayIteratorPrototype%":f?p([][Symbol.iterator]()):r,"%AsyncFromSyncIteratorPrototype%":r,"%AsyncFunction%":d,"%AsyncGenerator%":d,"%AsyncGeneratorFunction%":d,"%AsyncIteratorPrototype%":d,"%Atomics%":"undefined"==typeof Atomics?r:Atomics,"%BigInt%":"undefined"==typeof BigInt?r:BigInt,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?r:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?r:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?r:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?r:FinalizationRegistry,"%Function%":i,"%GeneratorFunction%":d,"%Int8Array%":"undefined"==typeof Int8Array?r:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?r:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?r:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":f?p(p([][Symbol.iterator]())):r,"%JSON%":"object"==typeof JSON?JSON:r,"%Map%":"undefined"==typeof Map?r:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&f?p((new Map)[Symbol.iterator]()):r,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?r:Promise,"%Proxy%":"undefined"==typeof Proxy?r:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?r:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?r:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&f?p((new Set)[Symbol.iterator]()):r,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?r:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":f?p(""[Symbol.iterator]()):r,"%Symbol%":f?Symbol:r,"%SyntaxError%":o,"%ThrowTypeError%":l,"%TypedArray%":h,"%TypeError%":a,"%Uint8Array%":"undefined"==typeof Uint8Array?r:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?r:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?r:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?r:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?r:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?r:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?r:WeakSet},y=function e(t){var n;if("%AsyncFunction%"===t)n=c("async function () {}");else if("%GeneratorFunction%"===t)n=c("function* () {}");else if("%AsyncGeneratorFunction%"===t)n=c("async function* () {}");else if("%AsyncGenerator%"===t){var r=e("%AsyncGeneratorFunction%");r&&(n=r.prototype)}else if("%AsyncIteratorPrototype%"===t){var o=e("%AsyncGenerator%");o&&(n=p(o.prototype))}return v[t]=n,n},m={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},g=n(8381),b=n(2974),_=g.call(Function.call,Array.prototype.concat),w=g.call(Function.apply,Array.prototype.splice),k=g.call(Function.call,String.prototype.replace),O=g.call(Function.call,String.prototype.slice),S=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,P=/\\(\\)?/g,T=function(e){var t=O(e,0,1),n=O(e,-1);if("%"===t&&"%"!==n)throw new o("invalid intrinsic syntax, expected closing `%`");if("%"===n&&"%"!==t)throw new o("invalid intrinsic syntax, expected opening `%`");var r=[];return k(e,S,function(e,t,n,o){r[r.length]=n?k(o,P,"$1"):t||e}),r},C=function(e,t){var n,r=e;if(b(m,r)&&(r="%"+(n=m[r])[0]+"%"),b(v,r)){var i=v[r];if(i===d&&(i=y(r)),void 0===i&&!t)throw new a("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:r,value:i}}throw new o("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new a('"allowMissing" argument must be a boolean');var n=T(e),r=n.length>0?n[0]:"",i=C("%"+r+"%",t),c=i.name,u=i.value,l=!1,f=i.alias;f&&(r=f[0],w(n,_([0,1],f)));for(var p=1,d=!0;p<n.length;p+=1){var h=n[p],y=O(h,0,1),m=O(h,-1);if(('"'===y||"'"===y||"`"===y||'"'===m||"'"===m||"`"===m)&&y!==m)throw new o("property names with quotes must have matching quotes");if("constructor"!==h&&d||(l=!0),b(v,c="%"+(r+="."+h)+"%"))u=v[c];else if(null!=u){if(!(h in u)){if(!t)throw new a("base intrinsic for "+e+" exists, but the property is not available.");return}if(s&&p+1>=n.length){var g=s(u,h);u=(d=!!g)&&"get"in g&&!("originalValue"in g.get)?g.get:u[h]}else d=b(u,h),u=u[h];d&&!l&&(v[c]=u)}}return u}},5618:(e,t,n)=>{"use strict";var r="undefined"!=typeof Symbol&&Symbol,o=n(7994);e.exports=function(){return"function"==typeof r&&"function"==typeof Symbol&&"symbol"==typeof r("foo")&&"symbol"==typeof Symbol("bar")&&o()}},7994:e=>{"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),n=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var r=Object.getOwnPropertySymbols(e);if(1!==r.length||r[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var o=Object.getOwnPropertyDescriptor(e,t);if(42!==o.value||!0!==o.enumerable)return!1}return!0}},2974:(e,t,n)=>{"use strict";var r=n(8381);e.exports=r.call(Function.call,Object.prototype.hasOwnProperty)},5457:e=>{e.exports="function"==typeof Object.create?function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},4650:(e,t,n)=>{"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag,o=n(9808)("Object.prototype.toString"),i=function(e){return!(r&&e&&"object"==typeof e&&Symbol.toStringTag in e)&&"[object Arguments]"===o(e)},a=function(e){return!!i(e)||null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Array]"!==o(e)&&"[object Function]"===o(e.callee)},c=function(){return i(arguments)}();i.isLegacyArguments=a,e.exports=c?i:a},1951:e=>{"use strict";var t,n=Object.prototype.toString,r=Function.prototype.toString,o=/^\s*(?:function)?\*/,i="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag,a=Object.getPrototypeOf;e.exports=function(e){if("function"!=typeof e)return!1;if(o.test(r.call(e)))return!0;if(!i)return"[object GeneratorFunction]"===n.call(e);if(!a)return!1;if(void 0===t){var c=function(){if(!i)return!1;try{return Function("return function*() {}")()}catch(e){}}();t=!!c&&a(c)}return a(e)===t}},4103:(e,t,n)=>{"use strict";var r=n(9474),o=n(2322),i=n(9808),a=i("Object.prototype.toString"),c=n(5618)()&&"symbol"==typeof Symbol.toStringTag,s=o(),u=i("Array.prototype.indexOf",!0)||function(e,t){for(var n=0;n<e.length;n+=1)if(e[n]===t)return n;return-1},l=i("String.prototype.slice"),f={},p=n(3278),d=Object.getPrototypeOf;c&&p&&d&&r(s,function(e){var t=new global[e];if(!(Symbol.toStringTag in t))throw new EvalError("this engine has support for Symbol.toStringTag, but "+e+" does not have the property! Please report this.");var n=d(t),r=p(n,Symbol.toStringTag);if(!r){var o=d(n);r=p(o,Symbol.toStringTag)}f[e]=r.get}),e.exports=function(e){if(!e||"object"!=typeof e)return!1;if(!c){var t=l(a(e),8,-1);return u(s,t)>-1}return!!p&&function(e){var t=!1;return r(f,function(n,r){if(!t)try{t=n.call(e)===r}catch(o){}}),t}(e)}},5998:(e,t,n)=>{e.exports=n(6664)},6664:(e,t,n)=>{var r=n(1036),o=e.exports=n(477);function i(e,t,n,o){var i=new e(r.format.apply(this,[n=n||""].concat(o)));throw Error.captureStackTrace(i,t),i}function a(e,t,n){i(o.IllegalArgumentError,e,t,n)}function c(e,t,n){i(o.IllegalStateError,e,t,n)}function s(e){var t=typeof e;if("object"==t){if(!e)return"null";if(e instanceof Array)return"array"}return t}function u(e){return function(t,n){var r=s(t);if(r==e)return t;a(arguments.callee,n||'Expected "'+e+'" but got "'+r+'".',Array.prototype.slice.call(arguments,2))}}e.exports.checkArgument=function(e,t){e||a(arguments.callee,t,Array.prototype.slice.call(arguments,2))},e.exports.checkState=function(e,t){e||c(arguments.callee,t,Array.prototype.slice.call(arguments,2))},e.exports.checkIsDef=function(e,t){if(void 0!==e)return e;a(arguments.callee,t||"Expected value to be defined but was undefined.",Array.prototype.slice.call(arguments,2))},e.exports.checkIsDefAndNotNull=function(e,t){if(null!=e)return e;a(arguments.callee,t||'Expected value to be defined and not null but got "'+s(e)+'".',Array.prototype.slice.call(arguments,2))},e.exports.checkIsString=u("string"),e.exports.checkIsArray=u("array"),e.exports.checkIsNumber=u("number"),e.exports.checkIsBoolean=u("boolean"),e.exports.checkIsFunction=u("function"),e.exports.checkIsObject=u("object")},477:(e,t,n)=>{var r=n(1036);function o(e){Error.call(this,e),this.message=e}function i(e){Error.call(this,e),this.message=e}r.inherits(o,Error),o.prototype.name="IllegalArgumentError",r.inherits(i,Error),i.prototype.name="IllegalStateError",e.exports.IllegalStateError=i,e.exports.IllegalArgumentError=o},9831:(e,t,n)=>{"use strict";var r=n(6168);e.exports=function(e,t,n,o){var i=void 0,a=new Error("Canceled");return new r(function(c,s,u){var l=void 0;e(function(e){return u()?r.reject(a):(l=t(e),n(l).then(function(e){if(u())throw a;return i=e()}))}).then(function(e){if(u())throw e.disconnect(),a;c(o(l,e))}).catch(function(e){s(e)})},function(){i&&i.cancel()})}},9205:(e,t,n)=>{"use strict";var r=n(3738).MediaStreamTrack,o=n(7454),i=o.guessBrowser,a=o.guessBrowserVersion,c=n(9831),s=n(3995),u=n(6433),l=n(2016),f=n(982),p=f.LocalAudioTrack,d=f.LocalDataTrack,h=f.LocalVideoTrack,v=n(6791),y=n(1406),m=n(7041),g=n(4384),b=g.asLocalTrack,_=g.buildLogLevels,w=g.filterObject,k=g.isNonArrayObject,O=n(2779),S=O.DEFAULT_ENVIRONMENT,P=O.DEFAULT_LOG_LEVEL,T=O.DEFAULT_LOGGER_NAME,C=O.DEFAULT_REALM,E=O.DEFAULT_REGION,j=O.WS_SERVER,R=O.typeErrors,M=n(6168),x=n(2955),A=n(38),L=n(5330).validateBandwidthProfile,I="safari"===i()&&a(),D=0,N=!1,F=!1;if(I){var V=I.major;F=V<12||12===V&&I.minor<1}var U=new Set([{didWarn:!1,shouldDelete:!0,name:"abortOnIceServersTimeout"},{didWarn:!1,shouldDelete:!0,name:"dscpTagging",newName:"enableDscp"},{didWarn:!1,shouldDelete:!0,name:"iceServersTimeout"},{didWarn:!1,shouldDelete:!1,name:"eventListener",newName:"Video.Logger"},{didWarn:!1,shouldDelete:!1,name:"logLevel",newName:"Video.Logger"}]),B=new Set([{didWarn:!1,shouldDelete:!1,name:"maxTracks",newName:"bandwidthProfile.video.clientTrackSwitchOffControl"},{didWarn:!1,shouldDelete:!1,name:"renderDimensions",newName:"bandwidthProfile.video.contentPreferencesMode"}]);function q(e,t,n){n.forEach(function(n){var r=n.didWarn,o=n.name,i=n.newName,a=n.shouldDelete;o in e&&void 0!==e[o]&&(i&&a&&(e[i]=e[o]),a&&delete e[o],r||["error","off"].includes(t.level)||(t.warn('The ConnectOptions "'+o+'" is '+(i?'deprecated and scheduled for removal. Please use "'+i+'" instead.':"no longer applicable and will be ignored.")),n.didWarn=!0))})}function W(e,t,n,r,o,i){var a=e.createLocalParticipantSignaling(n,r);return t.debug("Creating a new LocalParticipant:",a),new o.LocalParticipant(a,i,o)}function H(e,t,n){var r=new y(t,n,e),o=e.log;return o.debug("Creating a new Room:",r),n.on("stateChanged",function e(t){"disconnected"===t&&(o.info("Disconnected from Room:",r.toString()),n.removeListener("stateChanged",e))}),r}function Q(e,t,n,r,o,i){return t.log.debug("Creating a new RoomSignaling"),n.connect(i._signaling,e,r,o,t)}function Z(e,t){var n=e.log;return e.shouldStopLocalTracks=!e.tracks,e.shouldStopLocalTracks?n.info("LocalTracks were not provided, so they will be acquired automatically before connecting to the Room. LocalTracks will be released if connecting to the Room fails or if the Room is disconnected"):(n.info("Getting LocalTracks"),n.debug("Options:",e)),e.createLocalTracks(e).then(function(r){var o=t(r);return o.catch(function(){e.shouldStopLocalTracks&&(n.info("The automatically acquired LocalTracks will now be stopped"),r.forEach(function(e){e.stop()}))}),o})}function G(e){var t="string"==typeof e?{codec:e}:e;switch(t.codec.toLowerCase()){case"opus":return Object.assign({dtx:!0},t);case"vp8":return Object.assign({simulcast:!1},t);default:return t}}e.exports=function(e,t){if(void 0===t&&(t={}),!k(t))return M.reject(R.INVALID_TYPE("options","object"));var n=t.Log||A,o=t.loggerName||T,i=t.logLevel||P,a=_(i),f="[connect #"+ ++D+"]",y=void 0;try{y=new n("default",f,a,o)}catch(V){return M.reject(V)}q(t,y,U),t=Object.assign({automaticSubscription:!0,createLocalTracks:s,dominantSpeaker:!1,enableDscp:!1,environment:S,eventListener:null,insights:!0,LocalAudioTrack:p,LocalDataTrack:d,LocalParticipant:l,LocalVideoTrack:h,Log:n,MediaStreamTrack:r,loggerName:o,logLevel:i,maxAudioBitrate:null,maxVideoBitrate:null,name:null,networkMonitor:!0,networkQuality:!1,preferredAudioCodecs:[],preferredVideoCodecs:[],realm:C,region:E,signaling:m},w(t));var g=j(t.environment,t.region),O=new x(Date.now(),y,t.eventListener);if((t=Object.assign({eventObserver:O,wsServer:g},t)).log=y,F&&!N&&"error"!==y.logLevel&&"off"!==y.logLevel&&(N=!0,y.warn(["Support for Safari 12.0 and below is limited because it does not support VP8.","This means you may experience codec issues in Group Rooms. You may also","experience codec issues in Peer-to-Peer (P2P) Rooms containing Android- or","iOS-based Participants who do not support H.264. However, P2P Rooms","with browser-based Participants should work. For more information, please","refer to this guide: https://www.twilio.com/docs/video/javascript-v2-developing-safari-11"].join(" "))),"string"!=typeof e)return M.reject(R.INVALID_TYPE("token","string"));var I=Object.assign({},t);if(delete I.name,"tracks"in t){if(!Array.isArray(t.tracks))return M.reject(R.INVALID_TYPE("options.tracks","Array of LocalAudioTrack, LocalVideoTrack or MediaStreamTrack"));try{t.tracks=t.tracks.map(function(e){return b(e,I)})}catch(V){return M.reject(V)}}var V=L(t.bandwidthProfile);if(V)return M.reject(V);t.clientTrackSwitchOffControl="disabled",t.contentPreferencesMode="disabled",t.bandwidthProfile&&(t.clientTrackSwitchOffControl="auto",t.contentPreferencesMode="auto",t.bandwidthProfile.video&&(q(t.bandwidthProfile.video,y,B),t.clientTrackSwitchOffControl="maxTracks"in t.bandwidthProfile.video?"disabled":"manual"===t.bandwidthProfile.video.clientTrackSwitchOffControl?"manual":"auto",t.contentPreferencesMode="renderDimensions"in t.bandwidthProfile.video?"disabled":"manual"===t.bandwidthProfile.video.contentPreferencesMode?"manual":"auto"));var z=new(0,t.signaling)(t.wsServer,t);y.info("Connecting to a Room"),y.debug("Options:",t);var J=new u({maxAudioBitrate:t.maxAudioBitrate,maxVideoBitrate:t.maxVideoBitrate}),Y={audio:t.preferredAudioCodecs.map(G),video:t.preferredVideoCodecs.map(G)},K=new v(k(t.networkQuality)?t.networkQuality:{}),$=c(Z.bind(null,t),W.bind(null,z,y,J,K,t),Q.bind(null,e,t,z,J,Y),H.bind(null,t));return $.then(function(e){return y.info("Connected to Room:",e.toString()),y.info("Room name:",e.name),y.debug("Room:",e),e},function(e){$._isCanceled?y.info("Attempt to connect to a Room was canceled"):y.info("Error while connecting to a Room:",e)}),$}},7771:(e,t,n)=>{"use strict";var r=n(3995),o=n(2779),i=o.DEFAULT_LOG_LEVEL,a=o.DEFAULT_LOGGER_NAME;function c(e,t){t=Object.assign({createLocalTracks:r,loggerName:a,logLevel:i},t);var n={};n.loggerName=t.loggerName,n.logLevel=t.logLevel,delete t.loggerName,delete t.logLevel;var o=t.createLocalTracks;return delete t.createLocalTracks,n[e]=!(Object.keys(t).length>0)||t,o(n).then(function(e){return e[0]})}e.exports={audio:function(e){return c("audio",e)},video:function(e){return c("video",e)}}},3995:(e,t,n)=>{"use strict";var r=n(4384).asLocalTrack,o=n(4384).buildLogLevels,i=n(3738).getUserMedia,a=n(982),c=a.LocalAudioTrack,s=a.LocalDataTrack,u=a.LocalVideoTrack,l=n(3738).MediaStreamTrack,f=n(38),p=n(2779),d=p.DEFAULT_LOG_LEVEL,h=p.DEFAULT_LOGGER_NAME,v=n(817),y=0;e.exports=function(e){var t=!(e&&("audio"in e||"video"in e));e=Object.assign({audio:t,getUserMedia:i,loggerName:h,logLevel:d,LocalAudioTrack:c,LocalDataTrack:s,LocalVideoTrack:u,MediaStreamTrack:l,Log:f,video:t},e);var n="[createLocalTracks #"+ ++y+"]",a=o(e.logLevel),p=new e.Log("default",n,a,e.loggerName),m=Object.assign({log:p},e);if(delete m.name,!1===e.audio&&!1===e.video)return p.info("Neither audio nor video requested, so returning empty LocalTracks"),Promise.resolve([]);if(e.tracks)return p.info("Adding user-provided LocalTracks"),p.debug("LocalTracks:",e.tracks),Promise.resolve(e.tracks);var g={audio:e.audio&&e.audio.name?{name:e.audio.name}:{},video:e.video&&e.video.name?{name:e.video.name}:{}};g.audio.isCreatedByCreateLocalTracks=!0,g.video.isCreatedByCreateLocalTracks=!0,e.audio&&"boolean"==typeof e.audio.workaroundWebKitBug1208516&&(g.audio.workaroundWebKitBug1208516=e.audio.workaroundWebKitBug1208516),e.video&&"boolean"==typeof e.video.workaroundWebKitBug1208516&&(g.video.workaroundWebKitBug1208516=e.video.workaroundWebKitBug1208516),e.audio&&delete e.audio.name,e.video&&delete e.video.name;var b={audio:e.audio,video:e.video};return(e.audio&&e.audio.workaroundWebKitBug180748?v(p,e.getUserMedia,b):e.getUserMedia(b)).then(function(e){var t=e.getAudioTracks().concat(e.getVideoTracks());return p.info("Call to getUserMedia successful; got MediaStreamTracks:",t),t.map(function(e){return r(e,Object.assign(g[e.kind],m))})},function(e){throw p.warn("Call to getUserMedia failed:",e),e})}},9026:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0},i=n(7416),a=n(3321),c=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.label,e.maxPacketLifeTime,e.maxRetransmits,e.ordered));return Object.defineProperties(n,{_dataChannel:{value:e}}),e.binaryType="arraybuffer",e.addEventListener("message",function(e){n.emit("message",e.data)}),e.addEventListener("close",function(){n.emit("close")}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"stop",value:function(){this._dataChannel.close(),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"stop",this).call(this)}},{key:"toDataTransport",value:function(){return new a(this._dataChannel)}}]),t}(i);e.exports=c},6506:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0},i=n(7416),a=n(4384).makeUUID,c=function(e){function t(e,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,a(),e,n,r));return Object.defineProperties(o,{_clones:{value:new Set},_dataChannels:{value:new Set}}),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"_addClone",value:function(e){this._clones.add(e)}},{key:"removeClone",value:function(e){this._clones.delete(e)}},{key:"addDataChannel",value:function(e){return this._dataChannels.add(e),this}},{key:"clone",value:function(){var e=this,n=new t(this.maxPacketLifeTime,this.maxRetransmits,this.ordered);return this._addClone(n),n.once("stopped",function(){return e.removeClone(n)}),n}},{key:"removeDataChannel",value:function(e){return this._dataChannels.delete(e),this}},{key:"send",value:function(e){return this._dataChannels.forEach(function(t){try{t.send(e)}catch(n){}}),this._clones.forEach(function(t){try{t.send(e)}catch(n){}}),this}},{key:"stop",value:function(){this._dataChannels.forEach(function(e){return e.close()}),this._clones.forEach(function(e){return e.stop()}),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"stop",this).call(this)}}]),t}(i);e.exports=c},7416:(e,t,n)=>{"use strict";var r=function(e){function t(e,n,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"data"));return Object.defineProperties(i,{maxPacketLifeTime:{enumerable:!0,value:n},maxRetransmits:{enumerable:!0,value:r},ordered:{enumerable:!0,value:o}}),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(n(5757));e.exports=r},3321:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Object.defineProperties(n,{_dataChannel:{value:e},_messageQueue:{value:[]}}),e.addEventListener("open",function(){n._messageQueue.splice(0).forEach(function(e){return n._publish(e)})}),e.addEventListener("message",function(e){var t=e.data;try{var r=JSON.parse(t);n.emit("message",r)}catch(o){}}),n.publish({type:"ready"}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"_publish",value:function(e){var t=JSON.stringify(e);try{this._dataChannel.send(t)}catch(n){}}},{key:"publish",value:function(e){var t=this._dataChannel;return"closing"!==t.readyState&&"closed"!==t.readyState&&("connecting"===t.readyState?(this._messageQueue.push(e),!0):(this._publish(e),!0))}}]),t}(n(5068).EventEmitter);e.exports=o},6433:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e=Object.assign({maxAudioBitrate:null,maxVideoBitrate:null},e),Object.defineProperties(n,{maxAudioBitrate:{value:e.maxAudioBitrate,writable:!0},maxVideoBitrate:{value:e.maxVideoBitrate,writable:!0}}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"toJSON",value:function(){return{maxAudioBitrate:this.maxAudioBitrate,maxVideoBitrate:this.maxVideoBitrate}}},{key:"update",value:function(e){var t=this;e=Object.assign({maxAudioBitrate:this.maxAudioBitrate,maxVideoBitrate:this.maxVideoBitrate},e),["maxAudioBitrate","maxVideoBitrate"].reduce(function(n,r){return t[r]!==e[r]&&(t[r]=e[r],n=!0),n},!1)&&this.emit("changed")}}]),t}(n(5068).EventEmitter);e.exports=o},7671:(e,t,n)=>{"use strict";var r=n(5068).EventEmitter,o=n(4384);e.exports=(0,o.hidePrivateAndCertainPublicPropertiesInClass)(r,["domain"])},4045:(e,t,n)=>{"use strict";var r=n(982),o=r.LocalAudioTrack,i=r.LocalDataTrack,a=r.LocalVideoTrack,c=n(5406).version,s={};Object.defineProperties(s,{connect:{enumerable:!0,value:n(9205)},createLocalAudioTrack:{enumerable:!0,value:n(7771).audio},createLocalTracks:{enumerable:!0,value:n(3995)},createLocalVideoTrack:{enumerable:!0,value:n(7771).video},isSupported:{enumerable:!0,value:n(7925)()},LocalAudioTrack:{enumerable:!0,value:o},LocalDataTrack:{enumerable:!0,value:i},LocalVideoTrack:{enumerable:!0,value:a},Logger:{enumerable:!0,value:n(3649)},version:{enumerable:!0,value:c}}),e.exports=s},2016:(e,t,n)=>{"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0},a=n(3738).MediaStreamTrack,c=n(4384),s=c.asLocalTrack,u=c.asLocalTrackPublication,l=c.trackClass,f=n(2779),p=f.typeErrors,d=f.trackPriority,h=n(5330).validateLocalTrack,v=n(982),y=v.LocalAudioTrack,m=v.LocalDataTrack,g=v.LocalVideoTrack,b=n(1885),_=n(9095),w=n(8625),k=function(e){function t(e,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=(r=Object.assign({LocalAudioTrack:y,LocalVideoTrack:g,LocalDataTrack:m,MediaStreamTrack:a,LocalAudioTrackPublication:b,LocalVideoTrackPublication:w,LocalDataTrackPublication:_,shouldStopLocalTracks:!1,tracks:n},r)).shouldStopLocalTracks?new Set(n.filter(function(e){return"data"!==e.kind})):new Set,i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));return Object.defineProperties(i,{_eventObserver:{value:r.eventObserver},_LocalAudioTrack:{value:r.LocalAudioTrack},_LocalDataTrack:{value:r.LocalDataTrack},_LocalVideoTrack:{value:r.LocalVideoTrack},_MediaStreamTrack:{value:r.MediaStreamTrack},_LocalAudioTrackPublication:{value:r.LocalAudioTrackPublication},_LocalDataTrackPublication:{value:r.LocalDataTrackPublication},_LocalVideoTrackPublication:{value:r.LocalVideoTrackPublication},_tracksToStop:{value:o},signalingRegion:{enumerable:!0,get:function(){return e.signalingRegion}}}),i._handleTrackSignalingEvents(),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),o(t,[{key:"_addTrack",value:function(e,n,r){var o=i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_addTrack",this).call(this,e,n);return o&&"disconnected"!==this.state&&this._addLocalTrack(e,r),o}},{key:"_addLocalTrack",value:function(e,t){this._signaling.addTrack(e._trackSender,e.name,t),this._log.info("Added a new "+l(e,!0)+":",e.id),this._log.debug(l(e,!0)+":",e)}},{key:"_removeTrack",value:function(e,n){var r=i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_removeTrack",this).call(this,e,n);return r&&"disconnected"!==this.state&&(this._signaling.removeTrack(e._trackSender),this._log.info("Removed a "+l(e,!0)+":",e.id),this._log.debug(l(e,!0)+":",e)),r}},{key:"_getTrackEvents",value:function(){return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_getTrackEvents",this).call(this).concat([["disabled","trackDisabled"],["enabled","trackEnabled"],["stopped","trackStopped"]])}},{key:"toString",value:function(){return"[LocalParticipant #"+this._instanceId+(this.sid?": "+this.sid:"")+"]"}},{key:"_handleTrackSignalingEvents",value:function(){var e=this,t=this._log;if("disconnected"!==this.state){var n=this._signaling;this.on("trackDisabled",o),this.on("trackEnabled",i),this.on("trackStopped",a),this._tracks.forEach(function(n){e._addLocalTrack(n,d.PRIORITY_STANDARD),e._getOrCreateLocalTrackPublication(n).catch(function(e){t.warn("Failed to get or create LocalTrackPublication for "+n+":",e)})});var r=this;n.on("stateChanged",function e(c){t.debug("Transitioned to state:",c),"disconnected"===c?(t.debug("Removing LocalTrack event listeners"),n.removeListener("stateChanged",e),r.removeListener("trackDisabled",o),r.removeListener("trackEnabled",i),r.removeListener("trackStopped",a),r._tracks.forEach(function(e){var t=a(e);t&&e._trackSender.removeClone(t._trackTransceiver)}),t.info("LocalParticipant disconnected. Stopping "+r._tracksToStop.size+" automatically-acquired LocalTracks"),r._tracksToStop.forEach(function(e){e.stop()})):"connected"===c&&(t.info("reconnected"),setTimeout(function(){return r.emit("reconnected")},0))})}function o(e){var r=n.getPublication(e._trackSender);r&&(r.disable(),t.debug("Disabled the "+l(e,!0)+":",e.id))}function i(e){var r=n.getPublication(e._trackSender);r&&(r.enable(),t.debug("Enabled the "+l(e,!0)+":",e.id))}function a(e){var t=n.getPublication(e._trackSender);return t&&t.stop(),t}}},{key:"_getOrCreateLocalTrackPublication",value:function(e){var t=O(this.tracks,e);if(t)return Promise.resolve(t);var n=this._log,r=this,o=this._signaling.getPublication(e._trackSender);if(!o)return Promise.reject(new Error("Unexpected error: The "+e+" cannot be published"));function i(e){r.unpublishTrack(e.track)}return new Promise(function(a,c){o.on("updated",function s(){var f=o.error;if(f)return o.removeListener("updated",s),n.warn("Failed to publish the "+l(e,!0)+": "+f.message),r._removeTrack(e,e.id),setTimeout(function(){r.emit("trackPublicationFailed",f,e)}),void c(f);if(!r._tracks.has(e.id))return o.removeListener("updated",s),void c(new Error("The "+e+" was unpublished"));if(o.sid){o.removeListener("updated",s);var p={log:n,LocalAudioTrackPublication:r._LocalAudioTrackPublication,LocalDataTrackPublication:r._LocalDataTrackPublication,LocalVideoTrackPublication:r._LocalVideoTrackPublication};(t=O(r.tracks,e))||(t=u(e,o,i,p),r._addTrackPublication(t));var d=r._signaling.state;"connected"!==d&&"connecting"!==d||(e._processorEventObserver&&e._processorEventObserver.on("event",function(e){r._eventObserver.emit("event",{name:e.name,payload:e.data,group:"video-processor",level:"info"})}),e.processedTrack&&(e._captureFrames(),e._setSenderMediaStreamTrack(!0))),"connected"===d&&setTimeout(function(){r.emit("trackPublished",t)}),a(t)}})})}},{key:"publishTrack",value:function(e,t){var n=O(this.tracks,e);if(n)return Promise.resolve(n);t=Object.assign({log:this._log,priority:d.PRIORITY_STANDARD,LocalAudioTrack:this._LocalAudioTrack,LocalDataTrack:this._LocalDataTrack,LocalVideoTrack:this._LocalVideoTrack,MediaStreamTrack:this._MediaStreamTrack},t);var r=void 0;try{r=s(e,t)}catch(a){return Promise.reject(a)}var o=Object.values(d);if(!o.includes(t.priority))return Promise.reject(p.INVALID_VALUE("LocalTrackPublishOptions.priority",o));var i=this._addTrack(r,r.id,t.priority)||this._tracks.get(r.id);return this._getOrCreateLocalTrackPublication(i)}},{key:"publishTracks",value:function(e){if(!Array.isArray(e))throw p.INVALID_TYPE("tracks","Array of LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack");return Promise.all(e.map(this.publishTrack,this))}},{key:"setBandwidthProfile",value:function(){this._log.warn("setBandwidthProfile is not implemented yet and may be available in future versions of twilio-video.js")}},{key:"setNetworkQualityConfiguration",value:function(e){if("object"!==(void 0===e?"undefined":r(e))||null===e)throw p.INVALID_TYPE("networkQualityConfiguration","NetworkQualityConfiguration");return["local","remote"].forEach(function(t){if(t in e&&("number"!=typeof e[t]||isNaN(e[t])))throw p.INVALID_TYPE("networkQualityConfiguration."+t,"number")}),this._signaling.setNetworkQualityConfiguration(e),this}},{key:"setParameters",value:function(e){if(void 0!==e&&"object"!==(void 0===e?"undefined":r(e)))throw p.INVALID_TYPE("encodingParameters","EncodingParameters, null or undefined");return e?["maxAudioBitrate","maxVideoBitrate"].forEach(function(t){if(void 0!==e[t]&&"number"!=typeof e[t]&&null!==e[t])throw p.INVALID_TYPE("encodingParameters."+t,"number, null or undefined")}):null===e&&(e={maxAudioBitrate:null,maxVideoBitrate:null}),this._signaling.setParameters(e),this}},{key:"unpublishTrack",value:function(e){h(e,{LocalAudioTrack:this._LocalAudioTrack,LocalDataTrack:this._LocalDataTrack,LocalVideoTrack:this._LocalVideoTrack,MediaStreamTrack:this._MediaStreamTrack});var t=this._tracks.get(e.id);if(!t)return null;if(this._signaling.getPublication(t._trackSender).publishFailed(new Error("The "+t+" was unpublished")),!(t=this._removeTrack(t,t.id)))return null;var n=O(this.tracks,t);return n&&this._removeTrackPublication(n),n}},{key:"unpublishTracks",value:function(e){var t=this;if(!Array.isArray(e))throw p.INVALID_TYPE("tracks","Array of LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack");return e.reduce(function(e,n){var r=t.unpublishTrack(n);return r?e.concat(r):e},[])}}]),t}(n(9461));function O(e,t){return Array.from(e.values()).find(function(e){return e.track===t||e.track.mediaStreamTrack===t})||null}e.exports=k},2059:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0},i=function(e){function t(e,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"_start",value:function(){o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_start",this).call(this),this._dummyEl&&this._detachElement(this._dummyEl)}},{key:"attach",value:function(){return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"attach",this).apply(this,arguments)}},{key:"detach",value:function(){return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"detach",this).apply(this,arguments)}}]),t}(n(3923));e.exports=i},982:(e,t,n)=>{"use strict";e.exports={LocalAudioTrack:n(6928),LocalVideoTrack:n(5948),LocalDataTrack:n(7193)}},6928:(e,t,n)=>{"use strict";var r=n(1036).inherits,o=n(600);function i(e,t){var n=new o(e,t);return Object.setPrototypeOf(n,i.prototype),n}r(i,o),e.exports=i},7193:(e,t,n)=>{"use strict";var r=n(1036).inherits,o=n(1935);function i(e){var t=new o(e);return Object.setPrototypeOf(t,i.prototype),t}r(i,o),e.exports=i},5948:(e,t,n)=>{"use strict";var r=n(1036).inherits,o=n(5015);function i(e,t){var n=new o(e,t);return Object.setPrototypeOf(n,i.prototype),n}r(i,o),e.exports=i},6204:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(7671),i=n(4384),a=i.buildLogLevels,c=i.valueToJSON,s=n(2779).DEFAULT_LOG_LEVEL,u=n(38),l=0,f=function(e){function t(e,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=Object.assign({name:e,log:null,logLevel:s},r);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),i=String(r.name),c=a(r.logLevel),f=r.log?r.log.createLog("media",o):new u("media",o,c,r.loggerName);return Object.defineProperties(o,{_instanceId:{value:++l},_log:{value:f},kind:{enumerable:!0,value:n},name:{enumerable:!0,value:i}}),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"toJSON",value:function(){return c(this)}}]),t}(o);e.exports=f},600:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0},i=n(2059),a=function(e){function t(e,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"toString",value:function(){return"[LocalAudioTrack #"+this._instanceId+": "+this.id+"]"}},{key:"attach",value:function(e){return(e=o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"attach",this).call(this,e)).muted=!0,e}},{key:"_end",value:function(){return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_end",this).apply(this,arguments)}},{key:"disable",value:function(){return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"disable",this).apply(this,arguments)}},{key:"enable",value:function(){return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"enable",this).apply(this,arguments)}},{key:"restart",value:function(){return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"restart",this).apply(this,arguments)}},{key:"stop",value:function(){return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"stop",this).apply(this,arguments)}}]),t}(n(9575)(i));e.exports=a},1885:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){function t(e,n,r,o){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r,o))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"toString",value:function(){return"[LocalAudioTrackPublication #"+this._instanceId+": "+this.trackSid+"]"}}]),t}(n(8691));e.exports=o},1935:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(6204),i=n(6506),a=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=new(0,(e=Object.assign({DataTrackSender:i,maxPacketLifeTime:null,maxRetransmits:null,ordered:!0},e)).DataTrackSender)(e.maxPacketLifeTime,e.maxRetransmits,e.ordered),r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n.id,"data",e));return Object.defineProperties(r,{_trackSender:{value:n},id:{enumerable:!0,value:n.id},maxPacketLifeTime:{enumerable:!0,value:e.maxPacketLifeTime},maxRetransmits:{enumerable:!0,value:e.maxRetransmits},ordered:{enumerable:!0,value:e.ordered},reliable:{enumerable:!0,value:null===e.maxPacketLifeTime&&null===e.maxRetransmits}}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"send",value:function(e){this._trackSender.send(e)}}]),t}(o);e.exports=a},9095:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){function t(e,n,r,o){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r,o))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"toString",value:function(){return"[LocalDataTrackPublication #"+this._instanceId+": "+this.trackSid+"]"}}]),t}(n(8691));e.exports=o},9575:(e,t,n)=>{"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0},a=n(3738).getUserMedia,c=n(7454).guessBrowser,s=n(4384),u=s.capitalize,l=s.defer,f=s.waitForSometime,p=s.waitForEvent,d=n(2779).typeErrors.ILLEGAL_INVOKE,h=n(6296),v=n(5046),y=n(418),m=n(9076),g=n(817),b=n(3479);function _(e){var t=e._log,n=e.kind,r={audio:h,video:v}[n],o=e._dummyEl,i=e.mediaStreamTrack,a=null;function c(){return Promise.race([p(i,"unmute"),f(50)]).then(function(){return n=e.mediaStreamTrack.muted,i=e.isStopped&&!!e._workaroundWebKitBug1208516Cleanup,Promise.resolve().then(function(){return"visible"===document.visibilityState&&!a&&(n||i||o.play().then(function(){return r(o)}).then(function(e){return e?t.warn("Silence detected"):t.info("Non-silence detected"),e}).catch(function(e){t.warn("Failed to detect silence:",e)}).finally(function(){o.pause()}))});var n,i}).then(function(t){return t&&!a&&(a=l(),e._restart().finally(function(){o=e._dummyEl,d(),i=e.mediaStreamTrack,u(),a.resolve(),a=null})),(a&&a.promise||Promise.resolve()).finally(function(){return m.resolveDeferred(n)})})}function s(){var t=e._log,n=e.kind;t.info("Muted"),t.debug("LocalMediaTrack:",e),m.startDeferred(n)}function u(){i.addEventListener("ended",c),i.addEventListener("mute",s),i.addEventListener("unmute",c)}function d(){i.removeEventListener("ended",c),i.removeEventListener("mute",s),i.removeEventListener("unmute",c)}var g=function(e){return!!e&&c()};return y.onVisibilityChange(1,g),u(),function(){y.offVisibilityChange(1,g),d()}}e.exports=function(e){return function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o="safari"===c()&&"object"===("undefined"==typeof document?"undefined":r(document))&&"function"==typeof document.addEventListener&&"string"==typeof document.visibilityState;n=Object.assign({getUserMedia:a,isCreatedByCreateLocalTracks:!1,workaroundWebKitBug1208516:o,gUMSilentTrackWorkaround:g},n);var i=new b(e),s=i.kind,u=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i,n));return Object.defineProperties(u,{_constraints:{value:"object"===r(n[s])?n[s]:{},writable:!0},_getUserMedia:{value:n.getUserMedia},_gUMSilentTrackWorkaround:{value:n.gUMSilentTrackWorkaround},_workaroundWebKitBug1208516:{value:n.workaroundWebKitBug1208516},_workaroundWebKitBug1208516Cleanup:{value:null,writable:!0},_didCallEnd:{value:!1,writable:!0},_isCreatedByCreateLocalTracks:{value:n.isCreatedByCreateLocalTracks},_trackSender:{value:i},id:{enumerable:!0,value:i.id},isEnabled:{enumerable:!0,get:function(){return i.enabled}},isStopped:{enumerable:!0,get:function(){return"ended"===i.readyState}}}),u._workaroundWebKitBug1208516&&(u._workaroundWebKitBug1208516Cleanup=_(u)),u}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),o(t,[{key:"_end",value:function(){this._didCallEnd||(i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_end",this).call(this),this._didCallEnd=!0,this.emit("stopped",this))}},{key:"_initialize",value:function(){this._didCallEnd&&(this._didCallEnd=!1),i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initialize",this).call(this)}},{key:"_reacquireTrack",value:function(e){var t=this._getUserMedia,n=this._gUMSilentTrackWorkaround,r=this._log,o=this.mediaStreamTrack.kind;r.info("Re-acquiring the MediaStreamTrack"),r.debug("Constraints:",e);var i,a,c,s=Object.assign({audio:!1,video:!1},(c=e,(a=o)in(i={})?Object.defineProperty(i,a,{value:c,enumerable:!0,configurable:!0,writable:!0}):i[a]=c,i));return(this._workaroundWebKitBug1208516Cleanup?n(r,t,s):t(s)).then(function(e){return e.getTracks()[0]})}},{key:"_restart",value:function(e){var t=this,n=this._log;return e=e||this._constraints,this._stop(),this._reacquireTrack(e).catch(function(t){throw n.error("Failed to re-acquire the MediaStreamTrack:",{error:t,constraints:e}),t}).then(function(r){return n.info("Re-acquired the MediaStreamTrack"),n.debug("MediaStreamTrack:",r),t._constraints=Object.assign({},e),t._setMediaStreamTrack(r)})}},{key:"_setMediaStreamTrack",value:function(e){var t=this;return e.enabled=this.mediaStreamTrack.enabled,this._stop(),(this._unprocessedTrack?Promise.resolve().then(function(){t._unprocessedTrack=e}):this._trackSender.setMediaStreamTrack(e).catch(function(n){t._log.warn("setMediaStreamTrack failed:",{error:n,mediaStreamTrack:e})})).then(function(){t._initialize(),t._getAllAttachedElements().forEach(function(e){return t._attach(e)})})}},{key:"_stop",value:function(){return this.mediaStreamTrack.stop(),this._end(),this}},{key:"enable",value:function(e){return(e="boolean"!=typeof e||e)!==this.mediaStreamTrack.enabled&&(this._log.info((e?"En":"Dis")+"abling"),this.mediaStreamTrack.enabled=e,this.emit(e?"enabled":"disabled",this)),this}},{key:"disable",value:function(){return this.enable(!1)}},{key:"restart",value:function(e){var t=this,n=this.kind;if(!this._isCreatedByCreateLocalTracks)return Promise.reject(d("restart","can only be called on a Local"+u(n)+"Track that is created using createLocalTracks or createLocal"+u(n)+"Track."));this._workaroundWebKitBug1208516Cleanup&&(this._workaroundWebKitBug1208516Cleanup(),this._workaroundWebKitBug1208516Cleanup=null);var r=this._restart(e);return this._workaroundWebKitBug1208516&&(r=r.finally(function(){t._workaroundWebKitBug1208516Cleanup=_(t)})),r}},{key:"stop",value:function(){return this._log.info("Stopping"),this._workaroundWebKitBug1208516Cleanup&&(this._workaroundWebKitBug1208516Cleanup(),this._workaroundWebKitBug1208516Cleanup=null),this._stop()}}]),t}(e)}},8691:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(9930),i=n(2779),a=i.typeErrors,c=i.trackPriority,s=function(e){function t(e,n,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n.name,e.sid,o));return Object.defineProperties(i,{_reemitTrackEvent:{value:function(){return i.emit(i.isTrackEnabled?"trackEnabled":"trackDisabled")}},_signaling:{value:e},_unpublish:{value:r},isTrackEnabled:{enumerable:!0,get:function(){return"data"===this.track.kind||this.track.isEnabled}},kind:{enumerable:!0,value:n.kind},priority:{enumerable:!0,get:function(){return e.updatedPriority}},track:{enumerable:!0,value:n}}),n.on("disabled",i._reemitTrackEvent),n.on("enabled",i._reemitTrackEvent),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"toString",value:function(){return"[LocalTrackPublication #"+this._instanceId+": "+this.trackSid+"]"}},{key:"setPriority",value:function(e){var t=Object.values(c);if(!t.includes(e))throw a.INVALID_VALUE("priority",t);return this._signaling.setPriority(e),this}},{key:"unpublish",value:function(){return this.track.removeListener("disabled",this._reemitTrackEvent),this.track.removeListener("enabled",this._reemitTrackEvent),this._unpublish(this),this}}]),t}(o);e.exports=s},5015:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0},i=n(7454).guessBrowser,a=n(5046),c=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=Object.assign({workaroundSilentLocalVideo:"safari"===i()&&"undefined"!=typeof document&&"function"==typeof document.createElement},n);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return Object.defineProperties(r,{_workaroundSilentLocalVideo:{value:n.workaroundSilentLocalVideo?s:null},_workaroundSilentLocalVideoCleanup:{value:null,writable:!0}}),r._workaroundSilentLocalVideo&&(r._workaroundSilentLocalVideoCleanup=r._workaroundSilentLocalVideo(r,document)),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"toString",value:function(){return"[LocalVideoTrack #"+this._instanceId+": "+this.id+"]"}},{key:"_checkIfCanCaptureFrames",value:function(){return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_checkIfCanCaptureFrames",this).call(this,this._trackSender.isPublishing)}},{key:"_end",value:function(){return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_end",this).apply(this,arguments)}},{key:"_setSenderMediaStreamTrack",value:function(e){var t=this,n=this.mediaStreamTrack,r=e?this.processedTrack:n;return this._trackSender.setMediaStreamTrack(r).catch(function(e){return t._log.warn("setMediaStreamTrack failed on LocalVideoTrack RTCRtpSender",{error:e,mediaStreamTrack:r})}).then(function(){t._unprocessedTrack=e?n:null})}},{key:"addProcessor",value:function(){this._log.debug("Adding VideoProcessor to the LocalVideoTrack");var e=o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addProcessor",this).apply(this,arguments);return this.processedTrack?(this._log.debug("Updating LocalVideoTrack's MediaStreamTrack with the processed MediaStreamTrack",this.processedTrack),this._setSenderMediaStreamTrack(!0),e):this._log.warn("Unable to add a VideoProcessor to the LocalVideoTrack")}},{key:"removeProcessor",value:function(){var e=this;this._log.debug("Removing VideoProcessor from the LocalVideoTrack");var n=o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"removeProcessor",this).apply(this,arguments);return this._log.debug("Updating LocalVideoTrack's MediaStreamTrack with the original MediaStreamTrack"),this._setSenderMediaStreamTrack().then(function(){return e._updateElementsMediaStreamTrack()}),n}},{key:"disable",value:function(){var e=o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"disable",this).apply(this,arguments);return this.processedTrack&&(this.processedTrack.enabled=!1),e}},{key:"enable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"enable",this).apply(this,arguments);return this.processedTrack&&(this.processedTrack.enabled=e,e&&(this._captureFrames(),this._log.debug("Updating LocalVideoTrack's MediaStreamTrack with the processed MediaStreamTrack",this.processedTrack),this._setSenderMediaStreamTrack(!0))),n}},{key:"restart",value:function(){var e=this;this._workaroundSilentLocalVideoCleanup&&(this._workaroundSilentLocalVideoCleanup(),this._workaroundSilentLocalVideoCleanup=null);var n=o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"restart",this).apply(this,arguments);return this.processor&&n.then(function(){e._restartProcessor()}),this._workaroundSilentLocalVideo&&n.finally(function(){e._workaroundSilentLocalVideoCleanup=e._workaroundSilentLocalVideo(e,document)}),n}},{key:"stop",value:function(){return this._workaroundSilentLocalVideoCleanup&&(this._workaroundSilentLocalVideoCleanup(),this._workaroundSilentLocalVideoCleanup=null),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"stop",this).apply(this,arguments)}}]),t}(n(9575)(n(8242)));function s(e,t){var n=e._log,r=e._dummyEl,o=e.mediaStreamTrack;function i(){e.isEnabled&&(n.info("Unmuted, checking silence"),r.play().then(function(){return a(r,t)}).then(function(t){if(t)return n.warn("Silence detected, restarting"),e._stop(),e._restart();n.info("Non-silent frames detected, so no need to restart")}).catch(function(e){n.warn("Failed to detect silence and restart:",e)}).finally(function(){(r=e._dummyEl).paused||r.pause(),o.removeEventListener("unmute",i),(o=e.mediaStreamTrack).addEventListener("unmute",i)}))}return o.addEventListener("unmute",i),function(){o.removeEventListener("unmute",i)}}e.exports=c},8625:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){function t(e,n,r,o){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r,o))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"toString",value:function(){return"[LocalVideoTrackPublication #"+this._instanceId+": "+this.trackSid+"]"}}]),t}(n(8691));e.exports=o},3923:(e,t,n)=>{"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(7454).guessBrowser,a=n(3738).MediaStream,c=n(4384),s=c.waitForEvent,u=c.waitForSometime,l=n(9076),f=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=Object.assign({playPausedElementsIfNotBackgrounded:"safari"===i()&&"object"===("undefined"==typeof document?"undefined":r(document))&&"function"==typeof document.addEventListener&&"string"==typeof document.visibilityState},n);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.id,e.kind,n)),c=!1;return n=Object.assign({MediaStream:a},n),Object.defineProperties(o,{_attachments:{value:new Set},_dummyEl:{value:null,writable:!0},_elShims:{value:new WeakMap},_isStarted:{get:function(){return c},set:function(e){c=e}},_playPausedElementsIfNotBackgrounded:{value:n.playPausedElementsIfNotBackgrounded},_shouldShimAttachedElements:{value:n.workaroundWebKitBug212780||n.playPausedElementsIfNotBackgrounded},_unprocessedTrack:{value:null,writable:!0},_MediaStream:{value:n.MediaStream},isStarted:{enumerable:!0,get:function(){return c}},mediaStreamTrack:{enumerable:!0,get:function(){return this._unprocessedTrack||e.track}},processedTrack:{enumerable:!0,value:null,writable:!0}}),o._initialize(),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),o(t,[{key:"_start",value:function(){this._log.debug("Started"),this._isStarted=!0,this._dummyEl&&(this._dummyEl.oncanplay=null),this.emit("started",this)}},{key:"_initialize",value:function(){var e=this;this._log.debug("Initializing"),this._dummyEl=this._createElement(),this.mediaStreamTrack.addEventListener("ended",function t(){e._end(),e.mediaStreamTrack.removeEventListener("ended",t)}),this._dummyEl&&(this._dummyEl.muted=!0,this._dummyEl.oncanplay=this._start.bind(this,this._dummyEl),this._attach(this._dummyEl,this.mediaStreamTrack),this._attachments.delete(this._dummyEl))}},{key:"_end",value:function(){this._log.debug("Ended"),this._dummyEl&&(this._detachElement(this._dummyEl),this._dummyEl.oncanplay=null)}},{key:"attach",value:function(e){var t=this;if("string"==typeof e?e=this._selectElement(e):e||(e=this._createElement()),this._log.debug("Attempting to attach to element:",e),e=this._attach(e),this._shouldShimAttachedElements&&!this._elShims.has(e)){var n=this._playPausedElementsIfNotBackgrounded?function(){return function(e,t){var n=e.tagName.toLowerCase();t.warn("Unintentionally paused:",e),Promise.race([s(document,"visibilitychange"),u(1e3)]).then(function(){"visible"===document.visibilityState&&l.whenResolved("audio").then(function(){return t.info("Playing unintentionally paused <"+n+"> element"),t.debug("Element:",e),e.play()}).then(function(){t.info("Successfully played unintentionally paused <"+n+"> element"),t.debug("Element:",e)}).catch(function(r){t.warn("Error while playing unintentionally paused <"+n+"> element:",{error:r,el:e})})})}(e,t._log)}:null;this._elShims.set(e,function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=e.pause,r=e.play,o=!1;e.pause=function(){return o=!0,n.call(e)},e.play=function(){return o=!1,r.call(e)};var i=t?function(){o||t()}:null;return i&&e.addEventListener("pause",i),{pausedIntentionally:function(){return o},unShim:function(){e.pause=n,e.play=r,i&&e.removeEventListener("pause",i)}}}(e,n))}return e}},{key:"_attach",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.processedTrack||this.mediaStreamTrack,n=e.srcObject;n instanceof this._MediaStream||(n=new this._MediaStream);var r="audio"===t.kind?"getAudioTracks":"getVideoTracks";return n[r]().forEach(function(e){n.removeTrack(e)}),n.addTrack(t),e.srcObject=n,e.autoplay=!0,e.playsInline=!0,this._attachments.has(e)||this._attachments.add(e),e}},{key:"_selectElement",value:function(e){var t=document.querySelector(e);if(!t)throw new Error("Selector matched no element: "+e);return t}},{key:"_updateElementsMediaStreamTrack",value:function(){var e=this;this._log.debug("Reattaching all elements to update mediaStreamTrack"),this._getAllAttachedElements().forEach(function(t){return e._attach(t)})}},{key:"_createElement",value:function(){return"undefined"!=typeof document?document.createElement(this.kind):null}},{key:"detach",value:function(e){var t;return t="string"==typeof e?[this._selectElement(e)]:e?[e]:this._getAllAttachedElements(),this._log.debug("Attempting to detach from elements:",t),this._detachElements(t),e?t[0]:t}},{key:"_detachElements",value:function(e){return e.map(this._detachElement.bind(this))}},{key:"_detachElement",value:function(e){if(!this._attachments.has(e))return e;var t=e.srcObject;return t instanceof this._MediaStream&&t.removeTrack(this.processedTrack||this.mediaStreamTrack),this._attachments.delete(e),this._shouldShimAttachedElements&&this._elShims.has(e)&&(this._elShims.get(e).unShim(),this._elShims.delete(e)),e}},{key:"_getAllAttachedElements",value:function(){var e=[];return this._attachments.forEach(function(t){e.push(t)}),e}}]),t}(n(6204));e.exports=f},7427:(e,t,n)=>{"use strict";var r=function(e){function t(e,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(n(598));e.exports=r},127:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0},i=n(2059),a=function(e){function t(e,n,r,o,i,a,c){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r,o,i,a,c))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"toString",value:function(){return"[RemoteAudioTrack #"+this._instanceId+": "+this.sid+"]"}},{key:"setPriority",value:function(e){return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setPriority",this).call(this,e)}}]),t}(n(5659)(i));e.exports=a},8789:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){function t(e,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"toString",value:function(){return"[RemoteAudioTrackPublication #"+this._instanceId+": "+this.trackSid+"]"}}]),t}(n(1426));e.exports=o},2427:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(6204),i=n(2779),a=i.typeErrors,c=i.trackPriority,s=function(e){function t(e,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n.id,"data",r));return Object.defineProperties(o,{_isSwitchedOff:{value:!1,writable:!0},_priority:{value:null,writable:!0},isEnabled:{enumerable:!0,value:!0},isSwitchedOff:{enumerable:!0,get:function(){return this._isSwitchedOff}},maxPacketLifeTime:{enumerable:!0,value:n.maxPacketLifeTime},maxRetransmits:{enumerable:!0,value:n.maxRetransmits},ordered:{enumerable:!0,value:n.ordered},priority:{enumerable:!0,get:function(){return this._priority}},reliable:{enumerable:!0,value:null===n.maxPacketLifeTime&&null===n.maxRetransmits},sid:{enumerable:!0,value:e}}),n.on("message",function(e){o.emit("message",e,o)}),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"setPriority",value:function(e){var t=[null].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(Object.values(c)));if(!t.includes(e))throw a.INVALID_VALUE("priority",t);return this._priority=e,this}},{key:"_setEnabled",value:function(){}},{key:"_setSwitchedOff",value:function(e){this._isSwitchedOff!==e&&(this._isSwitchedOff=e,this.emit(e?"switchedOff":"switchedOn",this))}}]),t}(o);e.exports=s},2243:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){function t(e,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"toString",value:function(){return"[RemoteDataTrackPublication #"+this._instanceId+": "+this.trackSid+"]"}}]),t}(n(1426));e.exports=o},5659:(e,t,n)=>{"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0},a=n(2779),c=a.typeErrors,s=a.trackPriority,u=n(7454).guessBrowser,l=n(418);e.exports=function(e){return function(e){function t(e,n,o,i,a,c,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),s=Object.assign({workaroundWebKitBug212780:"safari"===u()&&"object"===("undefined"==typeof document?"undefined":r(document))&&"function"==typeof document.addEventListener&&"string"==typeof document.visibilityState},s);var l=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n,s));return Object.defineProperties(l,{_isEnabled:{value:o,writable:!0},_isSwitchedOff:{value:i,writable:!0},_priority:{value:null,writable:!0},_setPriority:{value:a},_setRenderHint:{value:c},isEnabled:{enumerable:!0,get:function(){return this._isEnabled}},isSwitchedOff:{enumerable:!0,get:function(){return this._isSwitchedOff}},priority:{enumerable:!0,get:function(){return this._priority}},sid:{enumerable:!0,value:e},_workaroundWebKitBug212780:{value:s.workaroundWebKitBug212780},_workaroundWebKitBug212780Cleanup:{value:null,writable:!0}}),l}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),o(t,[{key:"setPriority",value:function(e){var t=[null].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(Object.values(s)));if(!t.includes(e))throw c.INVALID_VALUE("priority",t);return this._priority!==e&&(this._priority=e,this._setPriority(e)),this}},{key:"_setEnabled",value:function(e){this._isEnabled!==e&&(this._isEnabled=e,this.emit(this._isEnabled?"enabled":"disabled",this))}},{key:"_setSwitchedOff",value:function(e){this._isSwitchedOff!==e&&(this._isSwitchedOff=e,this.emit(e?"switchedOff":"switchedOn",this))}},{key:"attach",value:function(e){var n=i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"attach",this).call(this,e);return!0!==this.mediaStreamTrack.enabled&&(this.mediaStreamTrack.enabled=!0,this.processedTrack&&(this.processedTrack.enabled=!0),this.processor&&this._captureFrames()),this._workaroundWebKitBug212780&&(this._workaroundWebKitBug212780Cleanup=this._workaroundWebKitBug212780Cleanup||function(e){var t=e._log,n=e.kind;function r(r){r&&e._attachments.forEach(function(r){var o=e._elShims.get(r);r.paused&&o&&!o.pausedIntentionally()&&(t.info("Playing inadvertently paused <"+n+"> element"),t.debug("Element:",r),t.debug("RemoteMediaTrack:",e),r.play().then(function(){t.info("Successfully played inadvertently paused <"+n+"> element"),t.debug("Element:",r),t.debug("RemoteMediaTrack:",e)}).catch(function(o){t.warn("Error while playing inadvertently paused <"+n+"> element:",{err:o,el:r,remoteMediaTrack:e})}))})}return l.onVisibilityChange(2,r),function(){l.offVisibilityChange(2,r)}}(this)),n}},{key:"detach",value:function(e){var n=i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"detach",this).call(this,e);return 0===this._attachments.size&&(this.mediaStreamTrack.enabled=!1,this.processedTrack&&(this.processedTrack.enabled=!1),this._workaroundWebKitBug212780Cleanup&&(this._workaroundWebKitBug212780Cleanup(),this._workaroundWebKitBug212780Cleanup=null)),n}}]),t}(e)}},1426:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.name,e.sid,n));Object.defineProperties(r,{_signaling:{value:e},_track:{value:null,writable:!0},isSubscribed:{enumerable:!0,get:function(){return!!this._track}},isTrackEnabled:{enumerable:!0,get:function(){return e.isEnabled}},kind:{enumerable:!0,value:e.kind},publishPriority:{enumerable:!0,get:function(){return e.priority}},track:{enumerable:!0,get:function(){return this._track}}});var o=e.error,i=e.isEnabled,a=e.isSwitchedOff,c=e.priority;return e.on("updated",function(){if(o!==e.error)return o=e.error,void r.emit("subscriptionFailed",e.error);i!==e.isEnabled&&(i=e.isEnabled,r.track&&r.track._setEnabled(e.isEnabled),r.emit(e.isEnabled?"trackEnabled":"trackDisabled")),a!==e.isSwitchedOff&&(r._log.warn(r.trackSid+": "+(a?"OFF":"ON")+" => "+(e.isSwitchedOff?"OFF":"ON")),a=e.isSwitchedOff,r.track?(r.track._setSwitchedOff(e.isSwitchedOff),r.emit(a?"trackSwitchedOff":"trackSwitchedOn",r.track)):a&&r._log.warn("Track was not subscribed when switched Off.")),c!==e.priority&&r.emit("publishPriorityChanged",c=e.priority)}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"toString",value:function(){return"[RemoteTrackPublication #"+this._instanceId+": "+this.trackSid+"]"}},{key:"_subscribed",value:function(e){!this._track&&e&&(this._track=e,this.emit("subscribed",e))}},{key:"_unsubscribe",value:function(){if(this._track){var e=this._track;this._track=null,this.emit("unsubscribed",e)}}}]),t}(n(9930));e.exports=o},186:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0},i=n(5659),a=n(8242),c=n(418),s=n(1118).NullObserver,u=function(e){function t(e,n,r,o,i,a,c){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),c=Object.assign({clientTrackSwitchOffControl:"auto",contentPreferencesMode:"auto",enableDocumentVisibilityTurnOff:!0},c),c=Object.assign({IntersectionObserver:"undefined"==typeof IntersectionObserver||"auto"!==c.clientTrackSwitchOffControl?s:IntersectionObserver,ResizeObserver:"undefined"==typeof ResizeObserver||"auto"!==c.contentPreferencesMode?s:ResizeObserver},c);var u=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r,o,i,a,c));return Object.defineProperties(u,{_enableDocumentVisibilityTurnOff:{value:!0===c.enableDocumentVisibilityTurnOff&&"auto"===c.clientTrackSwitchOffControl},_documentVisibilityTurnOffCleanup:{value:null,writable:!0},_clientTrackSwitchOffControl:{value:c.clientTrackSwitchOffControl},_contentPreferencesMode:{value:c.contentPreferencesMode},_invisibleElements:{value:new WeakSet},_resizeObserver:{value:new c.ResizeObserver(function(e){e.find(function(e){return!u._invisibleElements.has(e.target)})&&l(u)})},_intersectionObserver:{value:new c.IntersectionObserver(function(e){var t=!1;e.forEach(function(e){!u._invisibleElements.has(e.target)!==e.isIntersecting&&(e.isIntersecting?(u._log.debug("intersectionObserver detected: Off => On"),u._invisibleElements.delete(e.target)):(u._log.debug("intersectionObserver detected: On => Off"),u._invisibleElements.add(e.target)),t=!0)}),t&&l(u)},{threshold:.25})}}),u}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"_start",value:function(e){var n=o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_start",this).call(this,e);return"auto"===this._clientTrackSwitchOffControl&&l(this),n}},{key:"switchOn",value:function(){if("manual"!==this._clientTrackSwitchOffControl)throw new Error('Invalid state. You can call switchOn only when bandwidthProfile.video.clientTrackSwitchOffControl is set to "manual"');return this._setRenderHint({enabled:!0}),this}},{key:"switchOff",value:function(){if("manual"!==this._clientTrackSwitchOffControl)throw new Error('Invalid state. You can call switchOff only when bandwidthProfile.video.clientTrackSwitchOffControl is set to "manual"');return this._setRenderHint({enabled:!1}),this}},{key:"setContentPreferences",value:function(e){if("manual"!==this._contentPreferencesMode)throw new Error('Invalid state. You can call switchOn only when bandwidthProfile.video.contentPreferencesMode is set to "manual"');return e.renderDimensions&&this._setRenderHint({renderDimensions:e.renderDimensions}),this}},{key:"attach",value:function(e){var n=o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"attach",this).call(this,e);return"auto"===this._clientTrackSwitchOffControl&&this._invisibleElements.add(n),this._intersectionObserver.observe(n),this._resizeObserver.observe(n),this._enableDocumentVisibilityTurnOff&&(this._documentVisibilityTurnOffCleanup=this._documentVisibilityTurnOffCleanup||function(e){function t(){l(e)}return c.onVisibilityChange(1,t),function(){c.offVisibilityChange(1,t)}}(this)),n}},{key:"detach",value:function(e){var n=this,r=o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"detach",this).call(this,e);return(Array.isArray(r)?r:[r]).forEach(function(e){n._intersectionObserver.unobserve(e),n._resizeObserver.unobserve(e),n._invisibleElements.delete(e)}),0===this._attachments.size&&this._documentVisibilityTurnOffCleanup&&(this._documentVisibilityTurnOffCleanup(),this._documentVisibilityTurnOffCleanup=null),l(this),r}},{key:"addProcessor",value:function(){return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addProcessor",this).apply(this,arguments)}},{key:"removeProcessor",value:function(){return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"removeProcessor",this).apply(this,arguments)}},{key:"toString",value:function(){return"[RemoteVideoTrack #"+this._instanceId+": "+this.sid+"]"}},{key:"setPriority",value:function(e){return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setPriority",this).call(this,e)}}]),t}(i(a));function l(e){if("auto"===e._clientTrackSwitchOffControl||"auto"===e._contentPreferencesMode){var t=e._getAllAttachedElements(),n={};if("auto"===e._clientTrackSwitchOffControl&&(t=t.filter(function(t){return!e._invisibleElements.has(t)}),n.enabled="visible"===document.visibilityState&&t.length>0),"auto"===e._contentPreferencesMode&&t.length>0){var r=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),1!==n.length);r=!0);}catch(s){o=!0,i=s}finally{try{!r&&c.return&&c.return()}finally{if(o)throw i}}return n}(e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}(t.sort(function(e,t){return t.clientHeight+t.clientWidth-e.clientHeight-e.clientWidth-1}))[0];n.renderDimensions={height:r.clientHeight,width:r.clientWidth}}e._log.debug("updating render hint:",n),e._setRenderHint(n)}}e.exports=u},1257:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){function t(e,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"toString",value:function(){return"[RemoteVideoTrackPublication #"+this._instanceId+": "+this.trackSid+"]"}}]),t}(n(1426));e.exports=o},3479:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.id,e));return Object.defineProperties(n,{_clones:{value:new Set},_senders:{value:new Set},isPublishing:{get:function(){return!!this._clones.size}}}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"clone",value:function(){var e=new t(this.track.clone());return this._clones.add(e),e}},{key:"removeClone",value:function(e){this._clones.delete(e)}},{key:"setMediaStreamTrack",value:function(e){var t=this,n=Array.from(this._clones),r=Array.from(this._senders);return Promise.all(n.map(function(t){return t.setMediaStreamTrack(e.clone())}).concat(r.map(function(t){return t.replaceTrack(e)}))).finally(function(){t._track=e})}},{key:"addSender",value:function(e){return this._senders.add(e),this}},{key:"removeSender",value:function(e){return this._senders.delete(e),this}}]),t}(n(598));e.exports=o},9930:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(7671),i=n(4384),a=i.buildLogLevels,c=i.valueToJSON,s=n(2779).DEFAULT_LOG_LEVEL,u=n(38),l=0,f=function(e){function t(e,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));r=Object.assign({logLevel:s},r);var i=a(r.logLevel);return Object.defineProperties(o,{_instanceId:{value:l++},_log:{value:r.log?r.log.createLog("default",o):new u("default",o,i,r.loggerName)},trackName:{enumerable:!0,value:e},trackSid:{enumerable:!0,value:n}}),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"toJSON",value:function(){return c(this)}},{key:"toString",value:function(){return"[TrackPublication #"+this._instanceId+": "+this.trackSid+"]"}}]),t}(o);e.exports=f},598:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0},i=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n.kind));return Object.defineProperties(r,{_track:{value:n,writable:!0},enabled:{enumerable:!0,get:function(){return this._track.enabled}},readyState:{enumerable:!0,get:function(){return this._track.readyState}},track:{enumerable:!0,get:function(){return this._track}}}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"stop",value:function(){this.track.stop(),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"stop",this).call(this)}}]),t}(n(5757));e.exports=i},6838:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(5068).EventEmitter,i=n(2779).DEFAULT_VIDEO_PROCESSOR_STATS_INTERVAL_MS,a=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Object.defineProperties(n,{_lastStatsSaveTime:{value:null,writable:!0},_lastStatsPublishTime:{value:null,writable:!0},_log:{value:e},_processorInfo:{value:null,writable:!0},_stats:{value:null,writable:!0}}),n.on("add",function(e){n._lastStatsSaveTime=Date.now(),n._lastStatsPublishTime=Date.now(),n._processorInfo=e,n._stats=[],n._reemitEvent("add",n._getEventData())}),n.on("remove",function(){var e=n._getEventData();n._lastStatsSaveTime=null,n._lastStatsPublishTime=null,n._processorInfo=null,n._stats=null,n._reemitEvent("remove",e)}),n.on("start",function(){n._reemitEvent("start",n._getEventData())}),n.on("stop",function(e){n._reemitEvent("stop",Object.assign({message:e},n._getEventData()))}),n.on("stats",function(){return n._maybeEmitStats()}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"_getEventData",value:function(){if(!this._processorInfo)return{};var e=this._processorInfo,t=e.processor,n={captureHeight:e.captureHeight,captureWidth:e.captureWidth,inputFrameRate:e.inputFrameRate,isRemoteVideoTrack:e.isRemoteVideoTrack};return n.name=t._name||"VideoProcessor",["assetsPath","blurFilterRadius","fitType","isSimdEnabled","maskBlurRadius","version"].forEach(function(e){var r=t["_"+e];void 0!==r&&(n[e]=r)}),Object.keys(n).forEach(function(e){var t=n[e];"boolean"==typeof t&&(n[e]=t?"true":"false")}),n}},{key:"_maybeEmitStats",value:function(){if(this._stats&&this._processorInfo){var e=this._processorInfo.processor._benchmark;if(e){var t=Date.now();if(!(t-this._lastStatsSaveTime<1e3)){var n={outputFrameRate:e.getRate("totalProcessingDelay")};if(["captureFrameDelay","imageCompositionDelay","inputImageResizeDelay","processFrameDelay","segmentationDelay"].forEach(function(t){n[t]=e.getAverageDelay(t)}),this._lastStatsSaveTime=t,this._stats.push(n),!(t-this._lastStatsPublishTime<i)){this._lastStatsPublishTime=t;var r=this._stats.splice(0).reduce(function(e,t,r){return Object.keys(n).forEach(function(n){e[n]||(e[n]=0),e[n]=(e[n]*r+t[n])/(r+1)}),e},{});Object.keys(r).forEach(function(e){r[e]=parseFloat(r[e].toFixed(2))}),this._reemitEvent("stats",Object.assign({},r,this._getEventData()))}}}}}},{key:"_reemitEvent",value:function(e,t){this._log.debug("VideoProcessor:"+e,t),this.emit("event",{name:e,data:t})}}]),t}(o);e.exports=a},8242:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0};function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var a=n(3923),c=n(6838),s=n(2779).DEFAULT_FRAME_RATE,u=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return Object.defineProperties(r,{_captureTimeoutId:{value:null,writable:!0},_isCapturing:{value:!1,writable:!0},_inputFrame:{value:null,writable:!0},_outputFrame:{value:null,writable:!0},_processorEventObserver:{value:null,writable:!0},_unmuteHandler:{value:null,writable:!0},dimensions:{enumerable:!0,value:{width:null,height:null}},processor:{enumerable:!0,value:null,writable:!0}}),r._processorEventObserver=new(n.VideoProcessorEventObserver||c)(r._log),i(r,r)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"_checkIfCanCaptureFrames",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!0,n="",r=this.mediaStreamTrack,o=r.enabled,i=r.readyState;return o||(t=!1,n="MediaStreamTrack is disabled"),"ended"===i&&(t=!1,n="MediaStreamTrack is ended"),this.processor||(t=!1,n="VideoProcessor not detected."),this._attachments.size||e||(t=!1,n="VideoTrack is not publishing and there is no attached element."),n&&this._log.debug(n),{canCaptureFrames:t,message:n}}},{key:"_captureFrames",value:function(){var e=this;if(this._isCapturing)this._log.debug("Ignoring captureFrames call. Capture is already in progress");else{if(!this._checkIfCanCaptureFrames().canCaptureFrames)return this._isCapturing=!1,void this._log.debug("Cannot capture frames. Ignoring captureFrames call.");this._isCapturing=!0,this._processorEventObserver.emit("start"),this._log.debug("Start capturing frames");var t=Date.now(),n=void 0;this._dummyEl.play().then(function(){var r=function(t){clearTimeout(e._captureTimeoutId);var r=e.mediaStreamTrack.getSettings().frameRate,o=Math.floor(1e3/(void 0===r?s:r))-n;(o<0||"number"!=typeof n)&&(o=0),e._captureTimeoutId=setTimeout(t,o)};r(function o(){var i=e._checkIfCanCaptureFrames();if(!i.canCaptureFrames)return e._isCapturing=!1,e._processorEventObserver.emit("stop",i.message),void e._log.debug("Cannot capture frames. Stopping capturing frames.");t=Date.now();var a=e.mediaStreamTrack.getSettings(),c=a.width,s=void 0===c?0:c,u=a.height,l=void 0===u?0:u;e._inputFrame.width!==s&&(e._inputFrame.width=s,e._inputFrame.height=l,e._outputFrame&&(e._outputFrame.width=s,e._outputFrame.height=l)),e._inputFrame.getContext("2d").drawImage(e._dummyEl,0,0,s,l);var f=null;try{f=e.processor.processFrame(e._inputFrame,e._outputFrame)}catch(p){e._log.debug("Exception detected after calling processFrame.",p)}(f instanceof Promise?f:Promise.resolve(f)).then(function(){e._outputFrame&&(e.processedTrack.requestFrame(),e._processorEventObserver.emit("stats"))}).finally(function(){n=Date.now()-t,r(o)})})}).catch(function(t){return e._log.error("Video element cannot be played",{error:t,track:e})})}}},{key:"_initialize",value:function(){var e=this;o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_initialize",this).call(this),this._dummyEl&&(this._dummyEl.onloadedmetadata=function(){l(e,e._dummyEl)&&(e.dimensions.width=e._dummyEl.videoWidth,e.dimensions.height=e._dummyEl.videoHeight)},this._dummyEl.onresize=function(){l(e,e._dummyEl)&&(e.dimensions.width=e._dummyEl.videoWidth,e.dimensions.height=e._dummyEl.videoHeight,e.isStarted&&(e._log.debug("Dimensions changed:",e.dimensions),e.emit(t.DIMENSIONS_CHANGED,e)))})}},{key:"_restartProcessor",value:function(){var e=this.processor;e&&(this.removeProcessor(e),this.addProcessor(e))}},{key:"_start",value:function(e){return this.dimensions.width=e.videoWidth,this.dimensions.height=e.videoHeight,this._log.debug("Dimensions:",this.dimensions),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_start",this).call(this,e)}},{key:"addProcessor",value:function(e){var t=this;if("function"!=typeof OffscreenCanvas)return this._log.warn("Adding a VideoProcessor is not supported in this browser.");if(!e||"function"!=typeof e.processFrame)throw new Error("Received an invalid VideoProcessor from addProcessor.");if(this.processor)throw new Error("A VideoProcessor has already been added.");if(!this._dummyEl)throw new Error("VideoTrack has not been initialized.");this._log.debug("Adding VideoProcessor to the VideoTrack",e),this._unmuteHandler||(this._unmuteHandler=function(){t._log.debug("mediaStreamTrack unmuted"),t.processedTrack.muted&&(t._log.debug("mediaStreamTrack is unmuted but processedTrack is muted. Restarting processor."),t._restartProcessor())},this.mediaStreamTrack.addEventListener("unmute",this._unmuteHandler));var n=this.mediaStreamTrack.getSettings(),r=n.width,o=void 0===r?0:r,i=n.height,a=void 0===i?0:i,c=n.frameRate,u=void 0===c?s:c;return this._inputFrame=new OffscreenCanvas(o,a),this._outputFrame=document.createElement("canvas"),this._outputFrame.width=o,this._outputFrame.height=a,this.processedTrack=this._outputFrame.captureStream(0).getTracks()[0],this.processedTrack.enabled=this.mediaStreamTrack.enabled,this.processor=e,this._processorEventObserver.emit("add",{processor:e,captureHeight:a,captureWidth:o,inputFrameRate:u,isRemoteVideoTrack:this.toString().includes("RemoteVideoTrack")}),this._updateElementsMediaStreamTrack(),this._captureFrames(),this}},{key:"attach",value:function(){var e=o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"attach",this).apply(this,arguments);return this.processor&&this._captureFrames(),e}},{key:"detach",value:function(){return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"detach",this).apply(this,arguments)}},{key:"removeProcessor",value:function(e){if(!e)throw new Error("Received an invalid VideoProcessor from removeProcessor.");if(!this.processor)throw new Error("No existing VideoProcessor detected.");if(e!==this.processor)throw new Error("The provided VideoProcessor is different than the existing one.");return this._processorEventObserver.emit("remove"),this._log.debug("Removing VideoProcessor from the VideoTrack",e),clearTimeout(this._captureTimeoutId),this.mediaStreamTrack.removeEventListener("unmute",this._unmuteHandler),this._unmuteHandler=null,this._isCapturing=!1,this.processor=null,this.processedTrack=null,this._inputFrame.getContext("2d").clearRect(0,0,this._inputFrame.width,this._inputFrame.height),this._outputFrame.getContext("2d").clearRect(0,0,this._outputFrame.width,this._outputFrame.height),this._inputFrame=null,this._outputFrame=null,this._updateElementsMediaStreamTrack(),this}}]),t}(a);function l(e,t){return e.dimensions.width!==t.videoWidth||e.dimensions.height!==t.videoHeight}u.DIMENSIONS_CHANGED="dimensionsChanged",e.exports=u},6791:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(5068).EventEmitter,i=n(2779),a=i.DEFAULT_NQ_LEVEL_LOCAL,c=i.DEFAULT_NQ_LEVEL_REMOTE,s=i.MAX_NQ_LEVEL,u=n(4384).inRange,l=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e=Object.assign({local:a,remote:c},e),Object.defineProperties(n,{local:{value:u(e.local,a,s)?e.local:a,writable:!0},remote:{value:u(e.remote,c,s)?e.remote:c,writable:!0}}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"update",value:function(e){var t=this;e=Object.assign({local:this.local,remote:this.remote},e),[["local",a,3],["remote",c,3]].forEach(function(n){var r=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),3!==n.length);r=!0);}catch(s){o=!0,i=s}finally{try{!r&&c.return&&c.return()}finally{if(o)throw i}}return n}(e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}(n),o=r[0],i=r[1];t[o]="number"==typeof e[o]&&u(e[o],i,r[2])?e[o]:i})}}]),t}(o);e.exports=l},9461:(e,t,n)=>{"use strict";var r=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(s){o=!0,i=s}finally{try{!r&&c.return&&c.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var a=n(7671),c=n(127),s=n(8789),u=n(2427),l=n(2243),f=n(186),p=n(1257),d=n(4384),h=0,v=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),o=function(e){var t=e.map(function(e){return[e.id,e]}),n=t.filter(function(e){return"audio"===e[1].kind}),r=t.filter(function(e){return"video"===e[1].kind});return{audioTracks:n,dataTracks:t.filter(function(e){return"data"===e[1].kind}),tracks:t,videoTracks:r}}((n=Object.assign({RemoteAudioTrack:c,RemoteAudioTrackPublication:s,RemoteDataTrack:u,RemoteDataTrackPublication:l,RemoteVideoTrack:f,RemoteVideoTrackPublication:p,tracks:[]},n)).tracks),i=n.log.createLog("default",r),a=new Map(o.audioTracks),d=new Map(o.dataTracks),v=new Map(o.tracks),m=new Map(o.videoTracks);return Object.defineProperties(r,{_RemoteAudioTrack:{value:n.RemoteAudioTrack},_RemoteAudioTrackPublication:{value:n.RemoteAudioTrackPublication},_RemoteDataTrack:{value:n.RemoteDataTrack},_RemoteDataTrackPublication:{value:n.RemoteDataTrackPublication},_RemoteVideoTrack:{value:n.RemoteVideoTrack},_RemoteVideoTrackPublication:{value:n.RemoteVideoTrackPublication},_audioTracks:{value:a},_dataTracks:{value:d},_instanceId:{value:++h},_clientTrackSwitchOffControl:{value:n.clientTrackSwitchOffControl},_contentPreferencesMode:{value:n.contentPreferencesMode},_log:{value:i},_signaling:{value:e},_tracks:{value:v},_trackEventReemitters:{value:new Map},_trackPublicationEventReemitters:{value:new Map},_trackSignalingUpdatedEventCallbacks:{value:new Map},_videoTracks:{value:m},audioTracks:{enumerable:!0,value:new Map},dataTracks:{enumerable:!0,value:new Map},identity:{enumerable:!0,get:function(){return e.identity}},networkQualityLevel:{enumerable:!0,get:function(){return e.networkQualityLevel}},networkQualityStats:{enumerable:!0,get:function(){return e.networkQualityStats}},sid:{enumerable:!0,get:function(){return e.sid}},state:{enumerable:!0,get:function(){return e.state}},tracks:{enumerable:!0,value:new Map},videoTracks:{enumerable:!0,value:new Map}}),r._tracks.forEach(y.bind(null,r)),e.on("networkQualityLevelChanged",function(){return r.emit("networkQualityLevelChanged",r.networkQualityLevel,r.networkQualityStats&&(r.networkQualityStats.audio||r.networkQualityStats.video)?r.networkQualityStats:null)}),function(e,t){var n=e._log;"disconnected"!==e.state&&t.on("stateChanged",function r(o){n.debug("Transitioned to state:",o),e.emit(o,e),"disconnected"===o&&(n.debug("Removing Track event reemitters"),t.removeListener("stateChanged",r),e._tracks.forEach(function(t){var n=e._trackEventReemitters.get(t.id);t&&n&&n.forEach(function(e,n){t.removeListener(n,e)})}),t.tracks.forEach(function(t){var n=e._tracks.get(t.id),r=e._trackEventReemitters.get(t.id);n&&r&&r.forEach(function(e,t){n.removeListener(t,e)})}),e._trackEventReemitters.clear(),e.tracks.forEach(function(t){e._trackPublicationEventReemitters.get(t.trackSid).forEach(function(e,n){t.removeListener(n,e)})}),e._trackPublicationEventReemitters.clear())})}(r,e),i.info("Created a new Participant"+(r.identity?": "+r.identity:"")),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),o(t,[{key:"_getTrackEvents",value:function(){return[["dimensionsChanged","trackDimensionsChanged"],["message","trackMessage"],["started","trackStarted"]]}},{key:"_getTrackPublicationEvents",value:function(){return[]}},{key:"toString",value:function(){return"[Participant #"+this._instanceId+": "+this.sid+"]"}},{key:"_addTrack",value:function(e,t){var n=this._log;return this._tracks.has(t)?null:(this._tracks.set(t,e),{audio:this._audioTracks,video:this._videoTracks,data:this._dataTracks}[e.kind].set(t,e),y(this,e,t),n.info("Added a new "+d.trackClass(e)+":",t),n.debug(d.trackClass(e)+":",e),e)}},{key:"_addTrackPublication",value:function(e){var t=this._log;return this.tracks.has(e.trackSid)?null:(this.tracks.set(e.trackSid,e),{audio:this.audioTracks,data:this.dataTracks,video:this.videoTracks}[e.kind].set(e.trackSid,e),function(e,t){var n=new Map;"disconnected"!==e.state&&(e._getTrackPublicationEvents().forEach(function(o){var i=r(o,2),a=i[0],c=i[1];n.set(a,function(){for(var n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];e.emit.apply(e,[c].concat(r,[t]))}),t.on(a,n.get(a))}),e._trackPublicationEventReemitters.set(t.trackSid,n))}(this,e),t.info("Added a new "+d.trackPublicationClass(e)+":",e.trackSid),t.debug(d.trackPublicationClass(e)+":",e),e)}},{key:"_handleTrackSignalingEvents",value:function(){var e=this._log,t=this._clientTrackSwitchOffControl,n=this._contentPreferencesMode,o=this;if("disconnected"!==this.state){var i=this._RemoteAudioTrack,a=this._RemoteAudioTrackPublication,c=this._RemoteVideoTrack,s=this._RemoteVideoTrackPublication,u=this._RemoteDataTrack,l=this._RemoteDataTrackPublication,f=this._signaling;f.on("trackAdded",p),f.on("trackRemoved",d),f.tracks.forEach(p),f.on("stateChanged",function t(n){"disconnected"===n?(e.debug("Removing event listeners"),f.removeListener("stateChanged",t),f.removeListener("trackAdded",p),f.removeListener("trackRemoved",d)):"connected"===n&&(e.info("reconnected"),setTimeout(function(){return o.emit("reconnected")},0))})}function p(t){var n=new(0,{audio:a,data:l,video:s}[t.kind])(t,{log:e});o._addTrackPublication(n);var i=t.isSubscribed;i&&h(t),o._trackSignalingUpdatedEventCallbacks.set(t.sid,function(){if(i!==t.isSubscribed){if(i=t.isSubscribed)return void h(t);!function(e){var t=Array.from(o._tracks.entries()).find(function(t){return r(t,2)[1].sid===e.sid}),n=r(t,2),i=n[0],a=n[1],c=o.tracks.get(e.sid);a&&o._removeTrack(a,c,i)}(t)}}),t.on("updated",o._trackSignalingUpdatedEventCallbacks.get(t.sid))}function d(e){e.isSubscribed&&e.setTrackTransceiver(null);var t=o._trackSignalingUpdatedEventCallbacks.get(e.sid);t&&(e.removeListener("updated",t),o._trackSignalingUpdatedEventCallbacks.delete(e.sid));var n=o.tracks.get(e.sid);n&&o._removeTrackPublication(n)}function h(r){var a=r.isEnabled,s=r.name,l=r.kind,p=r.sid,d=r.trackTransceiver,h=r.isSwitchedOff,v={audio:i,video:c,data:u}[l],y=o.tracks.get(p);if(v&&l===d.kind){var m={log:e,name:s,clientTrackSwitchOffControl:t,contentPreferencesMode:n},g="data"===l?new v(p,d,m):new v(p,d,a,h,function(e){return f.updateSubscriberTrackPriority(p,e)},function(e){r.isSubscribed&&f.updateTrackRenderHint(p,e)},m);o._addTrack(g,y,d.id)}}}},{key:"_removeTrack",value:function(e,t){if(!this._tracks.has(t))return null;this._tracks.delete(t),{audio:this._audioTracks,video:this._videoTracks,data:this._dataTracks}[e.kind].delete(t),(this._trackEventReemitters.get(t)||new Map).forEach(function(t,n){e.removeListener(n,t)});var n=this._log;return n.info("Removed a "+d.trackClass(e)+":",t),n.debug(d.trackClass(e)+":",e),e}},{key:"_removeTrackPublication",value:function(e){if(!(e=this.tracks.get(e.trackSid)))return null;this.tracks.delete(e.trackSid),{audio:this.audioTracks,data:this.dataTracks,video:this.videoTracks}[e.kind].delete(e.trackSid),(this._trackPublicationEventReemitters.get(e.trackSid)||new Map).forEach(function(t,n){e.removeListener(n,t)});var t=this._log;return t.info("Removed a "+d.trackPublicationClass(e)+":",e.trackSid),t.debug(d.trackPublicationClass(e)+":",e),e}},{key:"toJSON",value:function(){return d.valueToJSON(this)}}]),t}(a);function y(e,t,n){var r=new Map;"disconnected"!==e.state&&(e._getTrackEvents().forEach(function(n){var o=n[0],a=n[1];r.set(o,function(){var t=[a].concat([].slice.call(arguments));return e.emit.apply(e,i(t))}),t.on(o,r.get(o))}),e._trackEventReemitters.set(n,r))}e.exports=v},4673:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var i=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Object.defineProperties(e,{_queuedEvents:{value:new Map}}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"dequeue",value:function(e){var t=this,n=!0;if(!e)return this._queuedEvents.forEach(function(e,t){n=this.dequeue(t)&&n},this),n;var r=this._queuedEvents.get(e)||[];return this._queuedEvents.delete(e),r.reduce(function(n,r){return t.emit.apply(t,o([e].concat(r)))&&n},n)}},{key:"queue",value:function(){var e=[].slice.call(arguments);if(this.emit.apply(this,o(e)))return!0;var t=e[0];return this._queuedEvents.has(t)||this._queuedEvents.set(t,[]),this._queuedEvents.get(t).push(e.slice(1)),!1}}]),t}(n(5068).EventEmitter);e.exports=i},6899:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0},i=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return r._handleTrackSignalingEvents(),r.once("disconnected",r._unsubscribeTracks.bind(r)),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"toString",value:function(){return"[RemoteParticipant #"+this._instanceId+(this.sid?": "+this.sid:"")+"]"}},{key:"_addTrack",value:function(e,n,r){return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_addTrack",this).call(this,e,r)?(n._subscribed(e),this.emit("trackSubscribed",e,n),e):null}},{key:"_addTrackPublication",value:function(e){var n=o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_addTrackPublication",this).call(this,e);return n?(this.emit("trackPublished",n),n):null}},{key:"_getTrackPublicationEvents",value:function(){return[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_getTrackPublicationEvents",this).call(this)),[["subscriptionFailed","trackSubscriptionFailed"],["trackDisabled","trackDisabled"],["trackEnabled","trackEnabled"],["publishPriorityChanged","trackPublishPriorityChanged"],["trackSwitchedOff","trackSwitchedOff"],["trackSwitchedOn","trackSwitchedOn"]])}},{key:"_unsubscribeTracks",value:function(){var e=this;this.tracks.forEach(function(t){if(t.isSubscribed){var n=t.track;t._unsubscribe(),e.emit("trackUnsubscribed",n,t)}})}},{key:"_removeTrack",value:function(e,n,r){var i=this._tracks.get(r);return i?(o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_removeTrack",this).call(this,i,r),n._unsubscribe(),this.emit("trackUnsubscribed",i,n),i):null}},{key:"_removeTrackPublication",value:function(e){this._signaling.clearTrackHint(e.trackSid);var n=o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_removeTrackPublication",this).call(this,e);return n?(this.emit("trackUnpublished",n),n):null}}]),t}(n(9461));e.exports=i},1406:(e,t,n)=>{"use strict";var r=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(s){o=!0,i=s}finally{try{!r&&c.return&&c.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var a=n(7671),c=n(6899),s=n(2376),u=n(4384).valueToJSON,l=0,f=function(e){function t(e,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o,i,a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),c=r.log.createLog("default",a),s=new Map;return Object.defineProperties(a,{_log:{value:c},_clientTrackSwitchOffControl:{value:r.clientTrackSwitchOffControl||"disabled"},_contentPreferencesMode:{value:r.contentPreferencesMode||"disabled"},_instanceId:{value:++l},_options:{value:r},_participants:{value:s},_signaling:{value:n},dominantSpeaker:{enumerable:!0,get:function(){return this.participants.get(n.dominantSpeakerSid)||null}},isRecording:{enumerable:!0,get:function(){return n.recording.isEnabled||!1}},localParticipant:{enumerable:!0,value:e},name:{enumerable:!0,value:n.name},participants:{enumerable:!0,value:s},sid:{enumerable:!0,value:n.sid},state:{enumerable:!0,get:function(){return n.state}},mediaRegion:{enumerable:!0,value:n.mediaRegion}}),o=a,(i=n.recording).on("updated",function(){var e=i.isEnabled;o._log.info("Recording "+(e?"started":"stopped")),o.emit("recording"+(e?"Started":"Stopped"))}),function(e,t){var n=e._log;n.debug("Creating a new RemoteParticipant for each ParticipantSignaling in the RoomSignaling"),t.participants.forEach(d.bind(null,e)),n.debug("Setting up RemoteParticipant creation for all subsequent ParticipantSignalings that connect to the RoomSignaling"),t.on("participantConnected",d.bind(null,e)),t.on("dominantSpeakerChanged",function(){return e.emit("dominantSpeakerChanged",e.dominantSpeaker)}),t.on("stateChanged",function r(o,i){switch(n.info("Transitioned to state:",o),o){case"disconnected":e.participants.forEach(function(e){e._unsubscribeTracks()}),e.emit(o,e,i),e.localParticipant.tracks.forEach(function(e){e.unpublish()}),t.removeListener("stateChanged",r);break;case"reconnecting":setTimeout(function(){return e.emit("reconnecting",i)},0);break;default:setTimeout(function(){return e.emit("reconnected")},0)}})}(a,n),c.info("Created a new Room:",a.name),c.debug("Initial RemoteParticipants:",Array.from(a._participants.values())),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),o(t,[{key:"toString",value:function(){return"[Room #"+this._instanceId+": "+this.sid+"]"}},{key:"disconnect",value:function(){return this._log.info("Disconnecting"),this._signaling.disconnect(),this}},{key:"getStats",value:function(){var e=this;return this._signaling.getStats().then(function(t){return Array.from(t).map(function(t){var n=r(t,2),o=n[1];return new s(n[0],Object.assign({},o,{localAudioTrackStats:p(e,o.localAudioTrackStats),localVideoTrackStats:p(e,o.localVideoTrackStats)}))})})}},{key:"toJSON",value:function(){return u(this)}}]),t}(a);function p(e,t){var n=e.localParticipant._signaling;return t.reduce(function(e,t){var r=n.tracks.get(t.trackId),o=n.getSender(r);return o?[Object.assign({},t,{trackId:o.id})].concat(e):e},[])}function d(e,t){var n=e._log,o=new c(t,{log:n,clientTrackSwitchOffControl:e._clientTrackSwitchOffControl,contentPreferencesMode:e._contentPreferencesMode});n.info("A new RemoteParticipant connected:",o),e._participants.set(o.sid,o),e.emit("participantConnected",o);var a=[["reconnected","participantReconnected"],["reconnecting","participantReconnecting"],"trackDimensionsChanged","trackDisabled","trackEnabled","trackMessage","trackPublished","trackPublishPriorityChanged","trackStarted","trackSubscribed","trackSubscriptionFailed","trackSwitchedOff","trackSwitchedOn","trackUnpublished","trackUnsubscribed"].map(function(t){var n=Array.isArray(t)?t:[t,t],a=r(n,2),c=a[0],s=a[1];function u(){var t=[].slice.call(arguments);t.unshift(s),t.push(o),e.emit.apply(e,i(t))}return o.on(c,u),[c,u]});o.once("disconnected",function(){var t=e.dominantSpeaker;n.info("RemoteParticipant disconnected:",o),e._participants.delete(o.sid),a.forEach(function(e){o.removeListener(e[0],e[1])}),e.emit("participantDisconnected",o),o===t&&e.emit("dominantSpeakerChanged",e.dominantSpeaker)})}e.exports=f},7879:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(5252),i=n(3527),a=n(963),c={closed:["opening"],opening:["closed","open"],open:["closed","closing"],closing:["closed","open"]},s=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"closed",c))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"_close",value:function(e){return this.transition("closing",e),this.transition("closed",e),Promise.resolve(this)}},{key:"_connect",value:function(e,t,n,r,o){e.connect("PA00000000000000000000000000000000","test");var a=Promise.resolve(new i(e,"RM00000000000000000000000000000000",o));return a.cancel=function(){},a}},{key:"_open",value:function(e){return this.transition("opening",e),this.transition("open",e),Promise.resolve(this)}},{key:"close",value:function(){var e=this;return this.bracket("close",function(t){switch(e.state){case"closed":return e;case"open":return e._close(t);default:throw new Error('Unexpected Signaling state "'+e.state+'"')}})}},{key:"connect",value:function(e,t,n,r,o){var i=this;return this.bracket("connect",function a(c){switch(i.state){case"closed":return i._open(c).then(a.bind(null,c));case"open":return i.releaseLockCompletely(c),i._connect(e,t,n,r,o);default:throw new Error('Unexpected Signaling state "'+i.state+'"')}})}},{key:"createLocalParticipantSignaling",value:function(){return new o}},{key:"open",value:function(){var e=this;return this.bracket("open",function(t){switch(e.state){case"closed":return e._open(t);case"open":return e;default:throw new Error('Unexpected Signaling state "'+e.state+'"')}})}}]),t}(a);e.exports=s},2068:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0},i=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Object.defineProperties(e,{_publicationsToTrackSenders:{value:new Map},_trackSendersToPublications:{value:new Map}}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"addTrack",value:function(e,n,r){var i=this._createLocalTrackPublicationSignaling(e,n,r);return this._trackSendersToPublications.set(e,i),this._publicationsToTrackSenders.set(i,e),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addTrack",this).call(this,i),this}},{key:"getPublication",value:function(e){return this._trackSendersToPublications.get(e)||null}},{key:"getSender",value:function(e){return this._publicationsToTrackSenders.get(e)||null}},{key:"removeTrack",value:function(e){var n=this._trackSendersToPublications.get(e);return n?(this._trackSendersToPublications.delete(e),this._publicationsToTrackSenders.delete(n),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"removeTrack",this).call(this,n)&&n.stop(),n):null}}]),t}(n(5252));e.exports=i},3026:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0},i=function(e){function t(e,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o="data"===(e=e.clone()).kind||e.track.enabled,i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n,e.kind,o,r));return i.setTrackTransceiver(e),Object.defineProperties(i,{_updatedPriority:{value:r,writable:!0},id:{enumerable:!0,value:e.id}}),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"enable",value:function(e){return this.trackTransceiver.track.enabled=e="boolean"!=typeof e||e,o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"enable",this).call(this,e)}},{key:"publishFailed",value:function(e){return function(e,t){return null===e._sid&&!e._error&&(e._error=t,!0)}(this,e)&&this.emit("updated"),this}},{key:"setPriority",value:function(e){return this._updatedPriority!==e&&(this._updatedPriority=e,this.emit("updated")),this}},{key:"setSid",value:function(e){return this._error?this:o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setSid",this).call(this,e)}},{key:"stop",value:function(){this.trackTransceiver.stop()}},{key:"updatedPriority",get:function(){return this._updatedPriority}}]),t}(n(3552));e.exports=i},5252:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(963),i=n(2947),a={connecting:["connected"],connected:["disconnected","reconnecting"],reconnecting:["connected","disconnected"],disconnected:[]},c=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"connecting",a));return Object.defineProperties(e,{_identity:{writable:!0,value:null},_networkQualityLevel:{value:null,writable:!0},_networkQualityStats:{value:null,writable:!0},_sid:{writable:!0,value:null},identity:{enumerable:!0,get:function(){return this._identity}},sid:{enumerable:!0,get:function(){return this._sid}},tracks:{enumerable:!0,value:new Map}}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"addTrack",value:function(e){return this.tracks.set(e.id||e.sid,e),this.emit("trackAdded",e),this}},{key:"disconnect",value:function(){return"disconnected"!==this.state&&(this.preempt("disconnected"),!0)}},{key:"removeTrack",value:function(e){var t=this.tracks.get(e.id||e.sid);return this.tracks.delete(e.id||e.sid),t&&this.emit("trackRemoved",e),t||null}},{key:"setNetworkQualityLevel",value:function(e,t){this._networkQualityLevel!==e&&(this._networkQualityLevel=e,this._networkQualityStats=t&&(t.audio||t.video)?new i(t):null,this.emit("networkQualityLevelChanged"))}},{key:"connect",value:function(e,t){return("connecting"===this.state||"reconnecting"===this.state)&&(this._sid||(this._sid=e),this._identity||(this._identity=t),this.preempt("connected"),!0)}},{key:"reconnecting",value:function(){return("connecting"===this.state||"connected"===this.state)&&(this.preempt("reconnecting"),!0)}},{key:"networkQualityLevel",get:function(){return this._networkQualityLevel}},{key:"networkQualityStats",get:function(){return this._networkQualityStats}}]),t}(o);e.exports=c},468:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Object.defineProperties(e,{_isEnabled:{value:null,writable:!0},isEnabled:{enumerable:!0,get:function(){return this._isEnabled}}}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"disable",value:function(){return this.enable(!1)}},{key:"enable",value:function(e){return this.isEnabled!==(e="boolean"!=typeof e||e)&&(this._isEnabled=e,this.emit("updated")),this}}]),t}(n(5068).EventEmitter);e.exports=o},2899:(e,t,n)=>{"use strict";var r=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.connect(e,n),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(n(5252));e.exports=r},5293:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){function t(e,n,r,o,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var c=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n,r,o,i));return Object.defineProperties(c,{_isSwitchedOff:{value:a,writable:!0}}),c.setSid(e),c}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"subscribeFailed",value:function(e){return this.error||(this._error=e,this.emit("updated")),this}},{key:"setPriority",value:function(e){return this._priority!==e&&(this._priority=e,this.emit("updated")),this}},{key:"setSwitchedOff",value:function(e){return this._isSwitchedOff!==e&&(this._isSwitchedOff=e,this.emit("updated")),this}},{key:"isSubscribed",get:function(){return!!this.trackTransceiver}},{key:"isSwitchedOff",get:function(){return this._isSwitchedOff}}]),t}(n(3552));e.exports=o},3527:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(468),i=n(963),a=n(9106),c=n(4384).buildLogLevels,s=n(2779).DEFAULT_LOG_LEVEL,u=n(38),l=n(450),f=l.MediaConnectionError,p=l.MediaDTLSTransportFailedError,d=l.SignalingConnectionDisconnectedError,h=0,v={connected:["reconnecting","disconnected"],reconnecting:["connected","disconnected"],disconnected:[]},y=function(e){function t(e,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i=Object.assign({logLevel:s,RecordingSignaling:o,Timeout:a},i);var l=c(i.logLevel),f=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"connected",v)),d=i.RecordingSignaling,y=new i.Timeout(function(){f._disconnect(f._reconnectingError)},i.sessionTimeout,!1);return Object.defineProperties(f,{_instanceId:{value:h++},_log:{value:i.log?i.log.createLog("default",f):new u("default",f,l,i.loggerName)},_mediaConnectionIsReconnecting:{writable:!0,value:!1},_options:{value:i},_reconnectingError:{value:null,writable:!0},_sessionTimeout:{value:y},dominantSpeakerSid:{enumerable:!0,value:null,writable:!0},localParticipant:{enumerable:!0,value:e},name:{enumerable:!0,value:r},participants:{enumerable:!0,value:new Map},recording:{enumerable:!0,value:new d},sid:{enumerable:!0,value:n}}),f.on("connectionStateChanged",function(){"failed"!==f.connectionState||["disconnected","failed"].includes(f.iceConnectionState)||f._disconnect(new p)}),f.on("iceConnectionStateChanged",function(){return m(f)}),f.on("signalingConnectionStateChanged",function(){return m(f)}),setTimeout(function(){return m(f)}),f}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"_disconnect",value:function(e){return"disconnected"!==this.state&&(this.preempt("disconnected",null,[e]),!0)}},{key:"toString",value:function(){return"[RoomSignaling #"+this._instanceId+": "+(this.localParticipant?this.localParticipant.sid:"null")+"]"}},{key:"connectParticipant",value:function(e){var t=this;return"disconnected"!==e.state&&!this.participants.has(e.sid)&&(this.participants.set(e.sid,e),e.on("stateChanged",function n(r){"disconnected"===r&&(e.removeListener("stateChanged",n),t.participants.delete(e.sid),t.emit("participantDisconnected",e))}),this.emit("participantConnected",e),!0)}},{key:"disconnect",value:function(){return this._disconnect()}},{key:"setDominantSpeaker",value:function(e){this.dominantSpeakerSid=e,this.emit("dominantSpeakerChanged")}}]),t}(i);function m(e){if("disconnected"!==e.state&&"disconnected"!==e.signalingConnectionState){var t=void 0;"reconnecting"===e.signalingConnectionState?t=e.signalingConnectionState:"failed"===e.iceConnectionState?(e._mediaConnectionIsReconnecting=!0,t="reconnecting"):"new"===e.iceConnectionState||"checking"===e.iceConnectionState?t=e._mediaConnectionIsReconnecting?"reconnecting":"connected":(e._mediaConnectionIsReconnecting=!1,e._reconnectingError=null,e._sessionTimeout.clear(),t="connected"),t!==e.state&&("reconnecting"===t?(e._reconnectingError="reconnecting"===e.signalingConnectionState?new d:new f,e._sessionTimeout.start(),e.preempt(t,null,[e._reconnectingError])):e.preempt(t))}else e._sessionTimeout.clear()}e.exports=y},3552:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){function t(e,n,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),a=null;return Object.defineProperties(i,{_error:{value:null,writable:!0},_isEnabled:{value:r,writable:!0},_priority:{value:o,writable:!0},_trackTransceiver:{value:null,writable:!0},_sid:{get:function(){return a},set:function(e){null===a&&(a=e)}},kind:{enumerable:!0,value:n},name:{enumerable:!0,value:e}}),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"disable",value:function(){return this.enable(!1)}},{key:"enable",value:function(e){return this.isEnabled!==(e="boolean"!=typeof e||e)&&(this._isEnabled=e,this.emit("updated")),this}},{key:"setTrackTransceiver",value:function(e){return this.trackTransceiver!==(e=e||null)&&(this._trackTransceiver=e,this.emit("updated")),this}},{key:"setSid",value:function(e){return null===this.sid&&(this._sid=e,this.emit("updated")),this}},{key:"error",get:function(){return this._error}},{key:"isEnabled",get:function(){return this._isEnabled}},{key:"priority",get:function(){return this._priority}},{key:"sid",get:function(){return this._sid}},{key:"trackTransceiver",get:function(){return this._trackTransceiver}}]),t}(n(5068).EventEmitter);e.exports=o},3520:(e,t,n)=>{"use strict";var r=n(6168),o=n(2465),i=n(3209),a=n(7008),c=n(450),s=c.SignalingConnectionDisconnectedError,u=c.SignalingIncomingMessageInvalidError,l=n(4384),f=l.flatMap,p=l.createRoomConnectEventPayload;e.exports=function(e,t,n,c,l,d){var h=(d=Object.assign({PeerConnectionManager:o,RoomV2:i,Transport:a},d)).RoomV2,v=d.Transport,y=d.iceServers,m=d.log,g=new(0,d.PeerConnectionManager)(c,l,d),b=f(n.tracks,function(e){return[e.trackTransceiver]});g.setTrackSenders(b);var _=new Error("Canceled"),w=void 0,k=new r(function(r,o,i){var a=d.InsightsPublisher,c=d.NullInsightsPublisher,l=d.bandwidthProfile,f=d.eventObserver,b=d.name,k=d.wsServerInsights,O=Object.assign({automaticSubscription:d.automaticSubscription,dominantSpeaker:d.dominantSpeaker,environment:d.environment,eventObserver:f,loggerName:d.loggerName,logLevel:d.logLevel,networkMonitor:d.networkMonitor,networkQuality:d.networkQuality,iceServers:y,insights:d.insights,onIced:function(e){return i()?(o(_),Promise.reject(_)):(m.debug("Got ICE servers:",e),d.iceServers=e,g.setConfiguration(d),g.createAndOffer().then(function(){if(i())throw o(_),_;m.debug("createAndOffer() succeeded."),g.dequeue("description")}).catch(function(e){throw m.error("createAndOffer() failed:",e),o(e),e}))},realm:d.realm,renderHints:!!l&&("disabled"!==d.clientTrackSwitchOffControl||"disabled"!==d.contentPreferencesMode),sdpSemantics:d.sdpSemantics,trackPriority:!!l,trackSwitchOff:!!l},"string"==typeof k?{wsServerInsights:k}:{},a?{InsightsPublisher:a}:{},c?{NullInsightsPublisher:c}:{},l?{bandwidthProfile:l}:{});w=new v(b,e,n,g,t,O);var S=p(d);f.emit("event",S),w.once("connected",function(e){m.debug("Transport connected:",e),i()?o(_):e.participant?(n.setSignalingRegion(e.options.signaling_region),r(new h(n,e,w,g,d))):o(new u)}),w.once("stateChanged",function(e,t){"disconnected"===e?(w=null,o(t||new s)):m.debug("Transport state changed:",e)})},function(){w&&(w.disconnect(),w=null)});return k.catch(function(){w&&(w.disconnect(),w=null),g.close()}),k}},883:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"active_speaker",n));return Object.defineProperties(r,{_loudestParticipantSid:{value:null,writable:!0}}),r.on("ready",function(e){e.on("message",function(e){switch(e.type){case"active_speaker":r._setLoudestParticipantSid(e.participant)}})}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"_setLoudestParticipantSid",value:function(e){this.loudestParticipantSid!==e&&(this._loudestParticipantSid=e,this.emit("updated"))}},{key:"loudestParticipantSid",get:function(){return this._loudestParticipantSid}}]),t}(n(4992));e.exports=o},5638:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(5938),i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{_filter:{value:new o({getKey:function(e){return e.ufrag},isLessThanOrEqualTo:function(e,t){return e.revision<=t.revision}})},_ufrag:{writable:!0,value:null},ufrag:{enumerable:!0,get:function(){return this._ufrag}}})}return r(e,[{key:"setUfrag",value:function(e){this._ufrag=e;var t=this._filter.toMap().get(e);return t?t.candidates:[]}},{key:"update",value:function(e){e.candidates=e.candidates||[];var t=this._filter.toMap().get(e.ufrag),n=t?t.candidates:[];return this._filter.update(e)&&this._ufrag===e.ufrag?e.candidates.slice(n.length):[]}}]),e}();e.exports=i},8198:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(2779),i=o.ICE_ACTIVITY_CHECK_PERIOD_MS,a=o.ICE_INACTIVITY_THRESHOLD_MS,c=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n=Object.assign({activityCheckPeriodMs:i,inactivityThresholdMs:a},n),Object.defineProperties(this,{_activityCheckPeriodMs:{value:n.activityCheckPeriodMs},_inactivityThresholdMs:{value:n.inactivityThresholdMs},_lastActivity:{value:null,writable:!0},_peerConnection:{value:t},_timer:{value:null,writable:!0},_onIceConnectionStateChanged:{value:null,writable:!0}})}return r(e,[{key:"_getActivePairStat",value:function(e){var t=Array.from(e.values());return t.find(function(e){return"inbound-rtp"===e.type})?t.find(function(e){return"candidate-pair"===e.type&&e.nominated})||{bytesReceived:0,timestamp:Math.round((new Date).getTime())}:null}},{key:"_getIceConnectionStats",value:function(){var e=this;return this._peerConnection.getStats().then(function(t){return e._getActivePairStat(t)}).catch(function(){return null})}},{key:"_scheduleInactivityCallback",value:function(e){var t=this;e&&null===this._onIceConnectionStateChanged?(this._onIceConnectionStateChanged=function(){"disconnected"===t._peerConnection.iceConnectionState&&e()},this._peerConnection.addEventListener("iceconnectionstatechange",this._onIceConnectionStateChanged)):!e&&this._onIceConnectionStateChanged&&(this._peerConnection.removeEventListener("iceconnectionstatechange",this._onIceConnectionStateChanged),this._onIceConnectionStateChanged=null)}},{key:"start",value:function(e){var t=this;this.stop(),this._timer=setInterval(function(){t._getIceConnectionStats().then(function(n){n&&(t._lastActivity&&t._lastActivity.bytesReceived===n.bytesReceived||(t._lastActivity=n,t._scheduleInactivityCallback(null)),n.timestamp-t._lastActivity.timestamp>=t._inactivityThresholdMs&&("disconnected"===t._peerConnection.iceConnectionState?e():null===t._onIceConnectionStateChanged&&t._scheduleInactivityCallback(e)))})},this._activityCheckPeriodMs)}},{key:"stop",value:function(){this._scheduleInactivityCallback(null),null!==this._timer&&(clearInterval(this._timer),this._timer=null,this._lastActivity=null)}}]),e}();e.exports=c},7041:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(3520),i=n(6609),a=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=Object.assign({createCancelableRoomSignalingPromise:o},n);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Object.defineProperties(r,{_createCancelableRoomSignalingPromise:{value:n.createCancelableRoomSignalingPromise},_options:{value:n},_wsServer:{value:e}}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"_connect",value:function(e,t,n,r,o){return o=Object.assign({},this._options,o),this._createCancelableRoomSignalingPromise.bind(null,t,this._wsServer,e,n,r,o)}},{key:"createLocalParticipantSignaling",value:function(e,t){return new i(e,t)}}]),t}(n(7879));e.exports=a},6609:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0},i=n(2068),a=n(8572),c=n(4384).isDeepEqual,s=function(e){function t(e,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=Object.assign({LocalTrackPublicationV2:a},r);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Object.defineProperties(o,{_bandwidthProfile:{value:null,writable:!0},_bandwidthProfileRevision:{value:0,writable:!0},_encodingParameters:{value:e},_removeListeners:{value:new Map},_LocalTrackPublicationV2:{value:r.LocalTrackPublicationV2},_publishedRevision:{writable:!0,value:0},_revision:{writable:!0,value:1},_signalingRegion:{value:null,writable:!0},bandwidthProfile:{enumerable:!0,get:function(){return this._bandwidthProfile}},bandwidthProfileRevision:{enumerable:!0,get:function(){return this._bandwidthProfileRevision}},networkQualityConfiguration:{enumerable:!0,value:n},revision:{enumerable:!0,get:function(){return this._revision}},signalingRegion:{enumerable:!0,get:function(){return this._signalingRegion}}}),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"setSignalingRegion",value:function(e){this._signalingRegion||(this._signalingRegion=e)}},{key:"setBandwidthProfile",value:function(e){c(this._bandwidthProfile,e)||(this._bandwidthProfile=JSON.parse(JSON.stringify(e)),this._bandwidthProfileRevision++,this.didUpdate())}},{key:"setParameters",value:function(e){return this._encodingParameters.update(e),this}},{key:"update",value:function(e){return this._publishedRevision>=e.revision||(this._publishedRevision=e.revision,e.tracks.forEach(function(e){var t=this.tracks.get(e.id);t&&t.update(e)},this)),this}},{key:"_createLocalTrackPublicationSignaling",value:function(e,t,n){return new this._LocalTrackPublicationV2(e,t,n)}},{key:"addTrack",value:function(e,n,r){var i=this;o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addTrack",this).call(this,e,n,r);var a=this.getPublication(e),c=a.isEnabled,s=a.updatedPriority,u=function(){c===a.isEnabled&&s===a.updatedPriority||(i.didUpdate(),c=a.isEnabled,s=a.updatedPriority)};return a.on("updated",u),this._removeListener(a),this._removeListeners.set(a,function(){return a.removeListener("updated",u)}),this.didUpdate(),this}},{key:"_removeListener",value:function(e){var t=this._removeListeners.get(e);t&&t()}},{key:"getState",value:function(){return{revision:this.revision,tracks:Array.from(this.tracks.values()).map(function(e){return e.getState()})}}},{key:"didUpdate",value:function(){this._revision++,this.emit("updated")}},{key:"removeTrack",value:function(e){var n=o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"removeTrack",this).call(this,e);return n&&(e.removeClone(n.trackTransceiver),this._removeListener(n),this.didUpdate()),n}},{key:"setNetworkQualityConfiguration",value:function(e){this.networkQualityConfiguration.update(e)}}]),t}(i);e.exports=s},8572:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(3026),i=n(450).createTwilioError,a=function(e){function t(e,n,r){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"getState",value:function(){return{enabled:this.isEnabled,id:this.id,kind:this.kind,name:this.name,priority:this.updatedPriority}}},{key:"update",value:function(e){switch(e.state){case"ready":this.setSid(e.sid);break;case"failed":var t=e.error;this.publishFailed(i(t.code,t.message))}return this}}]),t}(o);e.exports=a},4992:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(5068),i=0,a=function(e){function t(e,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Object.defineProperties(o,{_instanceId:{value:i++},channel:{value:n},_log:{value:r.log.createLog("default",o)},_getReceiver:{value:e},_receiverPromise:{value:null,writable:!0},_transport:{value:null,writable:!0}}),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"toString",value:function(){return"[MediaSignaling #"+this._instanceId+":"+this.channel+"]"}},{key:"setup",value:function(e){var t=this;this._teardown(),this._log.info("setting up msp transport for id:",e);var n=this._getReceiver(e).then(function(e){if("data"!==e.kind)throw t._log.error("Expected a DataTrackReceiver"),new Error("Expected a DataTrackReceiver");if(t._receiverPromise===n){try{t._transport=e.toDataTransport()}catch(r){throw t._log.error("Failed to toDataTransport"),new Error("Failed to toDataTransport")}t.emit("ready",t._transport),e.once("close",function(){return t._teardown()})}});this._receiverPromise=n}},{key:"_teardown",value:function(){this._transport&&(this._log.info("Tearing down"),this._transport=null,this._receiverPromise=null,this.emit("teardown"))}},{key:"isSetup",get:function(){return!!this._receiverPromise}}]),t}(o);e.exports=a},8539:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(5068),i=n(7993),a=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Object.defineProperties(r,{_factories:{value:new WeakMap},_manager:{value:e},_signaling:{value:n}}),n.on("updated",function(){return r.emit("updated")}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"start",value:function(){var e=this;this.stop();var t=setTimeout(function(){var n,r;e._timeout===t&&(n=e,r=(n._manager._peerConnections?Array.from(n._manager._peerConnections.values()):[]).map(function(e){return e._peerConnection}).filter(function(e){return"closed"!==e.signalingState}).map(function(e){if(n._factories.has(e))return n._factories.get(e);var t=new i(e);return n._factories.set(e,t),t}).map(function(e){return e.next().catch(function(){return null})}),Promise.all(r).then(function(e){return e.filter(function(e){return e}).map(function(e){return e.summarize()})})).then(function(n){if(e._timeout===t){if(n.length){var r=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),1!==n.length);r=!0);}catch(s){o=!0,i=s}finally{try{!r&&c.return&&c.return()}finally{if(o)throw i}}return n}(e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}(n);e._signaling.put(r[0])}e.start()}})},200);this._timeout=t}},{key:"stop",value:function(){clearTimeout(this._timeout),this._timeout=null}},{key:"level",get:function(){return this._signaling.level}},{key:"levels",get:function(){return this._signaling.levels}},{key:"remoteLevels",get:function(){return this._signaling.remoteLevels}}]),t}(o);e.exports=a},4771:(e,t,n)=>{"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(4992),a=n(8423),c=function(e){function t(e,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"network_quality",r));return Object.defineProperties(o,{_level:{value:null,writable:!0},_levels:{value:null,writable:!0},_remoteLevels:{value:new Map,writable:!0},_networkQualityInputs:{value:new a},_networkQualityReportLevels:{get:function(){return{reportLevel:n.local,remoteReportLevel:n.remote}}}}),o.on("ready",function(e){e.on("message",function(e){switch(e.type){case"network_quality":o._handleNetworkQualityMessage(e)}})}),o._sendNetworkQualityInputs(),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),o(t,[{key:"_handleNetworkQualityMessage",value:function(e){var t=this,n=!1,o=null,i=e?e.local:null;"number"==typeof i?(o=i,this._levels=null):"object"===(void 0===i?"undefined":r(i))&&i&&(this._levels=i,o="number"==typeof i.level?i.level:Math.min(i.audio.send,i.audio.recv,i.video.send,i.video.recv)),null!==o&&this.level!==o&&(this._level=o,n=!0),this._remoteLevels=e&&e.remotes?e.remotes.reduce(function(e,r){return(t._remoteLevels.get(r.sid)||{}).level!==r.level&&(n=!0),e.set(r.sid,r)},new Map):this._remoteLevels,n&&this.emit("updated"),setTimeout(function(){return t._sendNetworkQualityInputs()},1e3)}},{key:"_sendNetworkQualityInputs",value:function(){var e=this;return this._networkQualityInputs.take().then(function(t){e._transport&&e._transport.publish(function(e,t){return Object.assign({type:"network_quality"},e,t)}(t,e._networkQualityReportLevels))})}},{key:"put",value:function(e){this._networkQualityInputs.put(e)}},{key:"level",get:function(){return this._level}},{key:"levels",get:function(){return this._levels}},{key:"remoteLevels",get:function(){return this._remoteLevels}}]),t}(i);e.exports=c},8852:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(4641),i=n(3738),a=i.MediaStream,c=i.RTCIceCandidate,s=i.RTCPeerConnection,u=i.RTCSessionDescription,l=i.getStats,f=n(7454).guessBrowser,p=n(3608).getSdpFormat,d=n(2779),h=d.DEFAULT_ICE_GATHERING_TIMEOUT_MS,v=d.DEFAULT_LOG_LEVEL,y=d.DEFAULT_SESSION_TIMEOUT_SEC,m=d.iceRestartBackoffConfig,g=n(4869),b=g.createCodecMapForMediaSection,_=g.disableRtx,w=g.enableDtxForOpus,k=g.getMediaSections,O=g.removeSSRCAttributes,S=g.revertSimulcastForNonVP8MediaSections,P=g.setBitrateParameters,T=g.setCodecPreferences,C=g.setSimulcast,E=g.unifiedPlanAddOrRewriteNewTrackIds,j=g.unifiedPlanAddOrRewriteTrackIds,R=g.unifiedPlanFilterLocalCodecs,M=n(9106),x=n(450),A=x.MediaClientLocalDescFailedError,L=x.MediaClientRemoteDescFailedError,I=n(4384),D=I.buildLogLevels,N=I.getPlatform,F=I.isChromeScreenShareTrack,V=I.oncePerTick,U=n(5638),B=n(8198),q=n(9026),W=n(7427),H=n(963),Q=n(38),Z=n(204),G=n(8345),z=n(9667),J=n(1651),Y=f(),K=N(),$=/android/.test(K),X="chrome"===Y,ee="firefox"===Y,te="safari"===Y,ne="undefined"!=typeof RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.getParameters&&"function"==typeof RTCRtpSender.prototype.setParameters,re=0,oe={open:["closed","updating"],updating:["closed","open"],closed:[]},ie=function(e){function t(e,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var l=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"open",oe)),f=ue(i=Object.assign({enableDscp:!1,dummyAudioMediaStreamTrack:null,isChromeScreenShareTrack:F,iceServers:[],isRTCRtpSenderParamsSupported:ne,logLevel:v,offerOptions:{},revertSimulcastForNonVP8MediaSections:S,sessionTimeout:1e3*y,setBitrateParameters:P,setCodecPreferences:T,setSimulcast:C,Backoff:o,IceConnectionMonitor:B,MediaStream:a,RTCIceCandidate:c,RTCPeerConnection:s,RTCSessionDescription:u,Timeout:M},i)),d=p(f.sdpSemantics),g="unified"===d,b=g?null:new i.MediaStream,_=D(i.logLevel),w=i.RTCPeerConnection;!0===i.enableDscp&&(i.chromeSpecificConstraints=i.chromeSpecificConstraints||{},i.chromeSpecificConstraints.optional=i.chromeSpecificConstraints.optional||[],i.chromeSpecificConstraints.optional.push({googDscp:!0}));var k=i.log?i.log.createLog("webrtc",l):new Q("webrtc",l,_,i.loggerName),O=new w(f,i.chromeSpecificConstraints);i.dummyAudioMediaStreamTrack&&O.addTrack(i.dummyAudioMediaStreamTrack,b||new i.MediaStream),Object.defineProperties(l,{_appliedTrackIdsToAttributes:{value:new Map,writable:!0},_dataChannels:{value:new Map},_dataTrackReceivers:{value:new Set},_descriptionRevision:{writable:!0,value:0},_didGenerateLocalCandidates:{writable:!0,value:!1},_enableDscp:{value:i.enableDscp},_encodingParameters:{value:n},_isChromeScreenShareTrack:{value:i.isChromeScreenShareTrack},_iceGatheringFailed:{value:!1,writable:!0},_iceGatheringTimeout:{value:new i.Timeout(function(){return l._handleIceGatheringTimeout()},h,!1)},_iceRestartBackoff:{value:i.Backoff.exponential(m)},_instanceId:{value:++re},_isIceConnectionInactive:{writable:!0,value:!1},_isIceLite:{writable:!0,value:!1},_isIceRestartBackoffInProgress:{writable:!0,value:!1},_isRestartingIce:{writable:!0,value:!1},_isUnifiedPlan:{value:g},_isRTCRtpSenderParamsSupported:{value:i.isRTCRtpSenderParamsSupported},_lastIceConnectionState:{writable:!0,value:null},_lastStableDescriptionRevision:{writable:!0,value:0},_localCandidates:{writable:!0,value:[]},_localCodecs:{value:new Set},_localCandidatesRevision:{writable:!0,value:1},_localDescriptionWithoutSimulcast:{writable:!0,value:null},_localDescription:{writable:!0,value:null},_localMediaStream:{value:b},_localUfrag:{writable:!0,value:null},_log:{value:k},_eventObserver:{value:i.eventObserver},_remoteCodecMaps:{value:new Map},_rtpSenders:{value:new Map},_iceConnectionMonitor:{value:new i.IceConnectionMonitor(O)},_mediaTrackReceivers:{value:new Set},_needsAnswer:{writable:!0,value:!1},_negotiationRole:{writable:!0,value:null},_offerOptions:{writable:!0,value:i.offerOptions},_onEncodingParametersChanged:{value:V(function(){l._isRTCRtpSenderParamsSupported?l._needsAnswer||pe(l):l.offer()})},_peerConnection:{value:O},_preferredAudioCodecs:{value:r.audio},_preferredVideoCodecs:{value:r.video},_shouldApplyDtx:{value:r.audio.every(function(e){return"opus"!==e.codec})||r.audio.some(function(e){return"opus"===e.codec&&e.dtx})},_shouldApplySimulcast:{value:(X||te)&&r.video.some(function(e){return"vp8"===e.codec.toLowerCase()&&e.simulcast})},_queuedDescription:{writable:!0,value:null},_iceReconnectTimeout:{value:new i.Timeout(function(){k.debug("ICE reconnect timed out"),l.close()},i.sessionTimeout,!1)},_recycledTransceivers:{value:{audio:[],video:[]}},_replaceTrackPromises:{value:new Map},_remoteCandidates:{writable:!0,value:new U},_sdpFormat:{value:d},_setBitrateParameters:{value:i.setBitrateParameters},_setCodecPreferences:{value:ee&&$&&r.video[0]&&"h264"!==r.video[0].codec.toLowerCase()?function(e){return e}:i.setCodecPreferences},_setSimulcast:{value:i.setSimulcast},_revertSimulcastForNonVP8MediaSections:{value:i.revertSimulcastForNonVP8MediaSections},_RTCIceCandidate:{value:i.RTCIceCandidate},_RTCPeerConnection:{value:i.RTCPeerConnection},_RTCSessionDescription:{value:i.RTCSessionDescription},_shouldOffer:{writable:!0,value:!1},_shouldRestartIce:{writable:!0,value:!1},_trackIdsToAttributes:{value:new Map,writable:!0},_trackMatcher:{writable:!0,value:null},id:{enumerable:!0,value:e}}),n.on("changed",l._onEncodingParametersChanged),O.addEventListener("connectionstatechange",l._handleConnectionStateChange.bind(l)),O.addEventListener("datachannel",l._handleDataChannelEvent.bind(l)),O.addEventListener("icecandidate",l._handleIceCandidateEvent.bind(l)),O.addEventListener("iceconnectionstatechange",l._handleIceConnectionStateChange.bind(l)),O.addEventListener("icegatheringstatechange",l._handleIceGatheringStateChange.bind(l)),O.addEventListener("signalingstatechange",l._handleSignalingStateChange.bind(l)),O.addEventListener("track",l._handleTrackEvent.bind(l)),l._iceRestartBackoff.on("ready",function(){return l._initiateIceRestart()});var E=l;return l.on("stateChanged",function e(t){"closed"===t&&(E.removeListener("stateChanged",e),E._dataChannels.forEach(function(e,t){E.removeDataTrackSender(t)}))}),l}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"toString",value:function(){return"[PeerConnectionV2 #"+this._instanceId+": "+this.id+"]"}},{key:"_addIceCandidate",value:function(e){var t=this;return Promise.resolve().then(function(){return e=new t._RTCIceCandidate(e),t._peerConnection.addIceCandidate(e)}).catch(function(n){t._log.warn("Failed to add RTCIceCandidate "+(e?'"'+e.candidate+'"':"null")+": "+n.message)})}},{key:"_addIceCandidates",value:function(e){return Promise.all(e.map(this._addIceCandidate,this)).then(function(){})}},{key:"_addOrUpdateTransceiver",value:function(e){var t=this,n=function(e,t){var n={audio:e._preferredAudioCodecs.map(function(e){return e.codec.toLowerCase()}),video:e._preferredVideoCodecs.map(function(e){return e.codec.toLowerCase()})}[t],r=e._recycledTransceivers[t],o=n.find(function(t){return e._localCodecs.has(t)});if(!o)return r.shift();var i=r.find(function(t){var n=e._remoteCodecMaps.get(t.mid);return n&&n.has(o)});return i&&r.splice(r.indexOf(i),1),i}(this,e.kind);if(n&&n.sender){var r=n.sender.track?n.sender.track.id:null;return r&&this._log.warn("Reusing transceiver: "+n.mid+"] "+r+" => "+e.id),this._replaceTrackPromises.set(n,n.sender.replaceTrack(e).then(function(){n.direction="sendrecv"},function(){}).finally(function(){t._replaceTrackPromises.delete(n)})),n}return this._peerConnection.addTransceiver(e)}},{key:"_checkIceBox",value:function(e){var t=se(e);if(!t)return Promise.resolve();var n=this._remoteCandidates.setUfrag(t);return this._addIceCandidates(n)}},{key:"_answer",value:function(e){var t=this;return Promise.resolve().then(function(){return t._negotiationRole||(t._negotiationRole="answerer"),t._setRemoteDescription(e)}).catch(function(){throw new L}).then(function(){return t._peerConnection.createAnswer()}).then(function(n){n=ee?new t._RTCSessionDescription({sdp:_(n.sdp),type:n.type}):J(n);var r=O(n.sdp,["mslabel","label"]);if(t._shouldApplySimulcast){var o=r;r=t._setSimulcast(o,t._sdpFormat,t._trackIdsToAttributes),r=t._revertSimulcastForNonVP8MediaSections(r,o,e.sdp)}return r=r.replace(/42e015/g,"42e01f"),t._setLocalDescription({type:n.type,sdp:r})}).then(function(){return t._checkIceBox(e)}).then(function(){return t._queuedDescription&&t._updateDescription(t._queuedDescription)}).then(function(){return t._queuedDescription=null,t._maybeReoffer(t._peerConnection.localDescription)}).catch(function(e){var n=e instanceof L?e:new A;throw t._publishMediaWarning({message:"Failed to _answer",code:n.code,error:e}),n})}},{key:"_close",value:function(){return this._iceConnectionMonitor.stop(),"closed"!==this._peerConnection.signalingState&&(this._peerConnection.close(),this.preempt("closed"),this._encodingParameters.removeListener("changed",this._onEncodingParametersChanged),!0)}},{key:"_handleConnectionStateChange",value:function(){this.emit("connectionStateChanged")}},{key:"_handleDataChannelEvent",value:function(e){var t=this,n=e.channel,r=new q(n);this._dataTrackReceivers.add(r),n.addEventListener("close",function(){t._dataTrackReceivers.delete(r)}),this.emit("trackAdded",r)}},{key:"_handleGlare",value:function(e){var t=this;return this._log.debug("Glare detected; rolling back"),this._isRestartingIce&&(this._log.debug("An ICE restart was in progress; we'll need to restart ICE again after rolling back"),this._isRestartingIce=!1,this._shouldRestartIce=!0),Promise.resolve().then(function(){return t._trackIdsToAttributes=new Map(t._appliedTrackIdsToAttributes),t._setLocalDescription({type:"rollback"})}).then(function(){return t._needsAnswer=!1,t._answer(e)}).then(function(e){return e?Promise.resolve():t._offer()})}},{key:"_publishMediaWarning",value:function(e){this._eventObserver.emit("event",{level:"warning",name:"error",group:"media",payload:{message:e.message,code:e.code,context:JSON.stringify({error:e.error.message,sdp:e.sdp})}})}},{key:"_handleIceCandidateEvent",value:function(e){e.candidate&&(this._log.debug("Clearing ICE gathering timeout"),this._didGenerateLocalCandidates=!0,this._iceGatheringTimeout.clear(),this._localCandidates.push(e.candidate));var t={ice:{candidates:this._isIceLite?[]:this._localCandidates.slice(),ufrag:this._localUfrag},id:this.id};e.candidate||(t.ice.complete=!0),this._isIceLite&&e.candidate||(t.ice.revision=this._localCandidatesRevision++,this.emit("candidates",t))}},{key:"_handleIceConnectionStateChange",value:function(){var e=this,t=this._peerConnection.iceConnectionState,n=["connected","completed"].includes(t),r=this._log;r.debug('ICE connection state is "'+t+'"'),n&&(this._iceReconnectTimeout.clear(),this._iceRestartBackoff.reset()),"failed"===this._lastIceConnectionState||"failed"!==t||this._shouldRestartIce||this._isRestartingIce?["disconnected","failed"].includes(this._lastIceConnectionState)&&n&&r.debug("ICE reconnected"):(r.warn("ICE failed"),this._initiateIceRestartBackoff()),"connected"===t?(this._isIceConnectionInactive=!1,this._iceConnectionMonitor.start(function(){e._iceConnectionMonitor.stop(),e._shouldRestartIce||e._isRestartingIce||(r.warn("ICE Connection Monitor detected inactivity"),e._isIceConnectionInactive=!0,e._initiateIceRestartBackoff(),e.emit("iceConnectionStateChanged"),e.emit("connectionStateChanged"))})):["disconnected","completed"].includes(t)||(this._iceConnectionMonitor.stop(),this._isIceConnectionInactive=!1),this._lastIceConnectionState=t,this.emit("iceConnectionStateChanged")}},{key:"_handleIceGatheringTimeout",value:function(){this._log.warn("ICE failed to gather any local candidates"),this._iceGatheringFailed=!0,this._initiateIceRestartBackoff(),this.emit("iceConnectionStateChanged"),this.emit("connectionStateChanged")}},{key:"_handleIceGatheringStateChange",value:function(){var e=this._peerConnection.iceGatheringState,t=this._log;t.debug('ICE gathering state is "'+e+'"');var n=this._iceGatheringTimeout;"gathering"!==e||this._didGenerateLocalCandidates||n.isSet||(t.debug("Starting ICE gathering timeout: "+n.delay),this._iceGatheringFailed=!1,this._iceGatheringTimeout.start())}},{key:"_handleSignalingStateChange",value:function(){"stable"===this._peerConnection.signalingState&&(this._appliedTrackIdsToAttributes=new Map(this._trackIdsToAttributes))}},{key:"_handleTrackEvent",value:function(e){var t=this,n=this._peerConnection.remoteDescription?this._peerConnection.remoteDescription.sdp:null;this._trackMatcher||(this._trackMatcher=e.transceiver&&e.transceiver.mid?new z:te||this._isUnifiedPlan?new G:new Z),this._trackMatcher.update(n);var r=e.track,o=this._trackMatcher.match(e)||r.id,i=new W(o,r);this._mediaTrackReceivers.forEach(function(e){e.track.id===i.track.id&&t._mediaTrackReceivers.delete(e)}),this._mediaTrackReceivers.add(i),r.addEventListener("ended",function(){return t._mediaTrackReceivers.delete(i)}),this.emit("trackAdded",i)}},{key:"_initiateIceRestart",value:function(){if("closed"!==this._peerConnection.signalingState){var e=this._log;e.warn("Attempting to restart ICE"),this._didGenerateLocalCandidates=!1,this._isIceRestartBackoffInProgress=!1,this._shouldRestartIce=!0;var t=this._iceReconnectTimeout;t.isSet||(e.debug("Starting ICE reconnect timeout: "+t.delay),this._iceReconnectTimeout.start()),this.offer()}}},{key:"_initiateIceRestartBackoff",value:function(){"closed"===this._peerConnection.signalingState||this._isIceRestartBackoffInProgress||(this._log.warn("An ICE restart has been scheduled"),this._isIceRestartBackoffInProgress=!0,this._iceRestartBackoff.backoff())}},{key:"_maybeReoffer",value:function(e){var t=this._shouldOffer;if(e&&e.sdp){if(this._isUnifiedPlan){var n=this._peerConnection.getSenders().filter(function(e){return e.track});t=["audio","video"].reduce(function(t,r){var o=k(e.sdp,r,"(sendrecv|sendonly)"),i=n.filter(le.bind(null,r));return t||o.length<i.length},t)}var r=this._dataChannels.size>0,o=k(e.sdp,"application").length>0;t=t||r&&!o}return(t?this._offer():Promise.resolve()).then(function(){return t})}},{key:"_offer",value:function(){var e=this,t=Object.assign({},this._offerOptions);return this._needsAnswer=!0,this._shouldRestartIce&&(this._shouldRestartIce=!1,this._isRestartingIce=!0,t.iceRestart=!0),Promise.all(this._replaceTrackPromises.values()).then(function(){return e._peerConnection.createOffer(t)}).catch(function(t){var n=new A;throw e._publishMediaWarning({message:"Failed to create offer",code:n.code,error:t}),n}).then(function(t){t=ee?new e._RTCSessionDescription({sdp:_(t.sdp),type:t.type}):J(t);var n=O(t.sdp,["mslabel","label"]);n=e._isUnifiedPlan&&e._peerConnection.remoteDescription?R(n,e._peerConnection.remoteDescription.sdp):n;var r=e._setCodecPreferences(n,e._preferredAudioCodecs,e._preferredVideoCodecs);return e._shouldOffer=!1,e._negotiationRole||(e._negotiationRole="offerer"),e._shouldApplySimulcast&&(e._localDescriptionWithoutSimulcast={type:"offer",sdp:r},r=e._setSimulcast(r,e._sdpFormat,e._trackIdsToAttributes)),e._setLocalDescription({type:"offer",sdp:r})})}},{key:"_getMediaTrackSenderId",value:function(e){var t=Array.from(this._rtpSenders.keys()).find(function(t){return t.track.id===e});return t?t.id:e}},{key:"_addOrRewriteLocalTrackIds",value:function(e){var t=this,n=this._peerConnection.getTransceivers().filter(function(e){var t=e.sender;return!e.stopped&&t&&t.track}),r=n.filter(function(e){return e.mid}),o=new Map(r.map(function(e){return[e.mid,t._getMediaTrackSenderId(e.sender.track.id)]})),i=j(e.sdp,o),a=n.filter(function(e){return!e.mid}),c=new Map(["audio","video"].map(function(e){return[e,a.filter(function(t){return t.sender.track.kind===e}).map(function(e){return t._getMediaTrackSenderId(e.sender.track.id)})]})),s=E(i,o,c);return new this._RTCSessionDescription({sdp:s,type:e.type})}},{key:"_rollbackAndApplyOffer",value:function(e){var t=this;return this._setLocalDescription({type:"rollback"}).then(function(){return t._setLocalDescription(e)})}},{key:"_setLocalDescription",value:function(e){var t=this;return"rollback"!==e.type&&this._shouldApplyDtx&&(e=new this._RTCSessionDescription({sdp:w(e.sdp),type:e.type})),this._peerConnection.setLocalDescription(e).catch(function(n){t._log.warn('Calling setLocalDescription with an RTCSessionDescription of type "'+e.type+'" failed with the error "'+n.message+'".');var r=new A,o={message:'Calling setLocalDescription with an RTCSessionDescription of type "'+e.type+'" failed',code:r.code,error:n};throw e.sdp&&(t._log.warn("The SDP was "+e.sdp),o.sdp=e.sdp),t._publishMediaWarning(o),r}).then(function(){"rollback"!==e.type&&(t._localDescription=t._isUnifiedPlan?t._addOrRewriteLocalTrackIds(e):e,t._shouldApplyDtx&&(t._localDescription=new t._RTCSessionDescription({sdp:w(t._localDescription.sdp,[]),type:t._localDescription.type})),t._localCandidates=[],"offer"===e.type?t._descriptionRevision++:"answer"===e.type&&(t._lastStableDescriptionRevision=t._descriptionRevision,fe(t)),t._localUfrag=se(e),t.emit("description",t.getState()))})}},{key:"_setRemoteDescription",value:function(e){var t=this;return e.sdp&&(this._isRTCRtpSenderParamsSupported||(e.sdp=this._setBitrateParameters(e.sdp,ee?"TIAS":"AS",this._encodingParameters.maxAudioBitrate,this._encodingParameters.maxVideoBitrate)),e.sdp=this._setCodecPreferences(e.sdp,this._preferredAudioCodecs,this._preferredVideoCodecs),e.sdp=this._shouldApplyDtx?w(e.sdp):w(e.sdp,[]),ee&&(e.sdp=e.sdp.replace(/a=msid:[^ ]+ /g,"a=msid:- ")),this._peerConnection.remoteDescription||(this._isIceLite=/a=ice-lite/.test(e.sdp))),e=new this._RTCSessionDescription(e),Promise.resolve().then(function(){if("answer"===e.type&&t._shouldApplySimulcast){var n=t._revertSimulcastForNonVP8MediaSections(t._localDescription.sdp,t._localDescriptionWithoutSimulcast.sdp,e.sdp);if(n!==t._localDescription.sdp)return t._rollbackAndApplyOffer({type:t._localDescription.type,sdp:n})}}).then(function(){return t._peerConnection.setRemoteDescription(e)}).then(function(){"answer"===e.type&&(t._isRestartingIce&&(t._log.debug("An ICE restart was in-progress and is now completed"),t._isRestartingIce=!1),fe(t))},function(n){throw t._log.warn('Calling setRemoteDescription with an RTCSessionDescription of type "'+e.type+'" failed with the error "'+n.message+'".'),e.sdp&&t._log.warn("The SDP was "+e.sdp),n})}},{key:"_updateDescription",value:function(e){var t=this;switch(e.type){case"answer":case"pranswer":if(e.revision!==this._descriptionRevision||"have-local-offer"!==this._peerConnection.signalingState)return Promise.resolve();this._descriptionRevision=e.revision;break;case"close":return this._close();case"create-offer":return e.revision<=this._lastStableDescriptionRevision?Promise.resolve():this._needsAnswer?(this._queuedDescription=e,Promise.resolve()):(this._descriptionRevision=e.revision,this._offer());case"offer":return e.revision<=this._lastStableDescriptionRevision||"closed"===this._peerConnection.signalingState?Promise.resolve():"have-local-offer"===this._peerConnection.signalingState?this._needsAnswer&&0===this._lastStableDescriptionRevision?(this._queuedDescription=e,Promise.resolve()):(this._descriptionRevision=e.revision,this._handleGlare(e)):(this._descriptionRevision=e.revision,this._answer(e).then(function(){}))}var n=e.revision;return Promise.resolve().then(function(){return t._setRemoteDescription(e)}).catch(function(n){var r=new L;throw t._publishMediaWarning({message:'Calling setRemoteDescription with an RTCSessionDescription of type "'+e.type+'" failed',code:r.code,error:n,sdp:e.sdp}),r}).then(function(){return t._lastStableDescriptionRevision=n,t._needsAnswer=!1,t._checkIceBox(e)}).then(function(){return t._queuedDescription&&t._updateDescription(t._queuedDescription)}).then(function(){return t._queuedDescription=null,t._maybeReoffer(t._peerConnection.localDescription).then(function(){})})}},{key:"_updateIce",value:function(e){var t=this._remoteCandidates.update(e);return this._addIceCandidates(t)}},{key:"addDataTrackSender",value:function(e){if(!this._dataChannels.has(e))try{var t={ordered:e.ordered};null!==e.maxPacketLifeTime&&(t.maxPacketLifeTime=e.maxPacketLifeTime),null!==e.maxRetransmits&&(t.maxRetransmits=e.maxRetransmits);var n=this._peerConnection.createDataChannel(e.id,t);e.addDataChannel(n),this._dataChannels.set(e,n)}catch(r){this._log.warn('Error creating an RTCDataChannel for DataTrack "'+e.id+'": '+r.message)}}},{key:"addMediaTrackSender",value:function(e){if("closed"!==this._peerConnection.signalingState&&!this._rtpSenders.has(e)){var t=void 0;this._localMediaStream?(this._localMediaStream.addTrack(e.track),t=this._peerConnection.addTrack(e.track,this._localMediaStream)):t=this._addOrUpdateTransceiver(e.track).sender,e.addSender(t),this._rtpSenders.set(e,t)}}},{key:"close",value:function(){this._close()&&(this._descriptionRevision++,this._localDescription={type:"close"},this.emit("description",this.getState()))}},{key:"getTrackReceivers",value:function(){return Array.from(this._dataTrackReceivers).concat(Array.from(this._mediaTrackReceivers))}},{key:"getState",value:function(){if(!this._localDescription)return null;var e={type:this._localDescription.type,revision:"answer"===this._localDescription.type?this._lastStableDescriptionRevision:this._descriptionRevision};return this._localDescription.sdp&&(e.sdp=this._localDescription.sdp),{description:e,id:this.id}}},{key:"offer",value:function(){var e=this;return this._needsAnswer||this._isRestartingIce?(this._shouldOffer=!0,Promise.resolve()):this.bracket("offering",function(t){return e.transition("updating",t),(e._needsAnswer||e._isRestartingIce?Promise.resolve():e._offer()).then(function(){e.tryTransition("open",t)},function(n){throw e.tryTransition("open",t),n})})}},{key:"removeDataTrackSender",value:function(e){var t=this._dataChannels.get(e);t&&(e.removeDataChannel(t),this._dataChannels.delete(e),t.close())}},{key:"removeMediaTrackSender",value:function(e){var t=this._rtpSenders.get(e);t&&("closed"!==this._peerConnection.signalingState&&this._peerConnection.removeTrack(t),this._localMediaStream&&this._localMediaStream.removeTrack(e.track),e.removeSender(t),this._rtpSenders.delete(e))}},{key:"setConfiguration",value:function(e){"function"==typeof this._peerConnection.setConfiguration&&this._peerConnection.setConfiguration(ue(e))}},{key:"setIceReconnectTimeout",value:function(e){return this._iceReconnectTimeout.setDelay(e),this._log.debug("Updated ICE reconnection timeout period:",this._iceReconnectTimeout.delay),this}},{key:"update",value:function(e){var t=this;return this.bracket("updating",function(n){if("closed"===t.state)return Promise.resolve();t.transition("updating",n);var r=[];return e.ice&&r.push(t._updateIce(e.ice)),e.description&&r.push(t._updateDescription(e.description)),Promise.all(r).then(function(){t.tryTransition("open",n)},function(e){throw t.tryTransition("open",n),e})})}},{key:"getStats",value:function(){var e=this;return l(this._peerConnection).then(function(t){return function(e,t){return Object.assign(t,{remoteAudioTrackStats:t.remoteAudioTrackStats.map(function(t){return ce(e,t)}),remoteVideoTrackStats:t.remoteVideoTrackStats.map(function(t){return ce(e,t)}),localAudioTrackStats:t.localAudioTrackStats.map(function(t){return ae(e,t)}),localVideoTrackStats:t.localVideoTrackStats.map(function(t){return ae(e,t)})})}(e,t)})}},{key:"connectionState",get:function(){return"failed"===this.iceConnectionState?"failed":this._peerConnection.connectionState||this.iceConnectionState}},{key:"iceConnectionState",get:function(){return this._isIceConnectionInactive&&"disconnected"===this._peerConnection.iceConnectionState||this._iceGatheringFailed?"failed":this._peerConnection.iceConnectionState}},{key:"isApplicationSectionNegotiated",get:function(){return"closed"===this._peerConnection.signalingState||!!this._peerConnection.localDescription&&k(this._peerConnection.localDescription.sdp,"application").length>0}}]),t}(H);function ae(e,t){var n=e._getMediaTrackSenderId(t.trackId);return Object.assign(t,{trackId:n})}function ce(e,t){var n=[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(e._mediaTrackReceivers)).find(function(e){return e.track.id===t.trackId});return Object.assign(t,{trackId:n?n.id:null})}function se(e){if(e.sdp){var t=e.sdp.match(/^a=ice-ufrag:([a-zA-Z0-9+/]+)/m);if(t)return t[1]}return null}function ue(e){return Object.assign({bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},e)}function le(e,t){var n=t.track;return n&&n.kind===e&&"ended"!==n.readyState}function fe(e){e._isUnifiedPlan&&(function(e){e._recycledTransceivers.audio=[],e._recycledTransceivers.video=[],e._peerConnection.getTransceivers().forEach(function(t){(function(e,t){return!e.stopped&&!t._replaceTrackPromises.has(e)&&["inactive","recvonly"].includes(e.direction)})(t,e)&&e._recycledTransceivers[t.receiver.track.kind].push(t)})}(e),function(e){var t=e._peerConnection.localDescription;t&&k(t.sdp).forEach(function(t){b(t).forEach(function(t,n){return e._localCodecs.add(n)})})}(e),function(e){var t=e._peerConnection.remoteDescription;t&&k(t.sdp).forEach(function(t){var n=t.match(/^a=mid:(.+)$/m)[1],r=b(t);e._remoteCodecMaps.set(n,r)})}(e)),e._isRTCRtpSenderParamsSupported&&pe(e)}function pe(e){var t=e._encodingParameters,n=new Map([["audio",t.maxAudioBitrate],["video",t.maxVideoBitrate]]);e._peerConnection.getSenders().filter(function(e){return e.track}).forEach(function(t){var r=n.get(t.track.kind),o=t.getParameters();null===r||0===r?function(e){Array.isArray(e.encodings)&&e.encodings.forEach(function(e){return delete e.maxBitrate})}(o):e._isChromeScreenShareTrack(t.track)?e._log.warn("Not setting maxBitrate for "+t.track.kind+" Track "+t.track.id+" because it appears to be screen share track: "+t.track.label):function(e,t){ee?e.encodings=[{maxBitrate:t}]:e.encodings.forEach(function(e){e.maxBitrate=t})}(o,r),!ee&&e._enableDscp&&o.encodings.length>0&&(o.encodings[0].networkPriority="high"),t.setParameters(o).catch(function(n){e._log.warn("Error while setting encodings parameters for "+t.track.kind+" Track "+t.track.id+": "+(n.message||n.name))})})}e.exports=ie},2465:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var i=n(7454).guessBrowser,a=n(8852),c=n(3479),s=n(4673),u=n(4384),l=n(450).MediaConnectionError,f="firefox"===i(),p=function(e){function t(e,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),s=(o=Object.assign({audioContextFactory:f?n(3308):null,PeerConnectionV2:a},o)).audioContextFactory?o.audioContextFactory.getOrCreate(i):null,l=s?{offerToReceiveVideo:!0}:{offerToReceiveAudio:!0,offerToReceiveVideo:!0};return Object.defineProperties(i,{_audioContextFactory:{value:o.audioContextFactory},_closedPeerConnectionIds:{value:new Set},_configuration:{writable:!0,value:null},_configurationDeferred:{writable:!0,value:u.defer()},_connectionState:{value:"new",writable:!0},_dummyAudioTrackSender:{value:s?new c(d(s)):null},_encodingParameters:{value:e},_iceConnectionState:{writable:!0,value:"new"},_dataTrackSenders:{writable:!0,value:new Set},_lastConnectionState:{value:"new",writable:!0},_lastIceConnectionState:{writable:!0,value:"new"},_mediaTrackSenders:{writable:!0,value:new Set},_offerOptions:{value:l},_peerConnections:{value:new Map},_preferredCodecs:{value:r},_sessionTimeout:{value:null,writable:!0},_PeerConnectionV2:{value:o.PeerConnectionV2}}),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"_closeAbsentPeerConnections",value:function(e){var t=new Set(e.map(function(e){return e.id}));return this._peerConnections.forEach(function(e){t.has(e.id)||e._close()}),this}},{key:"_getConfiguration",value:function(){return this._configurationDeferred.promise}},{key:"_getOrCreate",value:function(e,t){var n=this,r=this,o=this._peerConnections.get(e);if(!o){var i=this._PeerConnectionV2,a=Object.assign({dummyAudioMediaStreamTrack:this._dummyAudioTrackSender?this._dummyAudioTrackSender.track:null,offerOptions:this._offerOptions},this._sessionTimeout?{sessionTimeout:this._sessionTimeout}:{},t);try{o=new i(e,this._encodingParameters,this._preferredCodecs,a)}catch(c){throw new l}this._peerConnections.set(o.id,o),o.on("candidates",this.queue.bind(this,"candidates")),o.on("description",this.queue.bind(this,"description")),o.on("trackAdded",this.queue.bind(this,"trackAdded")),o.on("stateChanged",function e(t){"closed"===t&&(o.removeListener("stateChanged",e),r._dataTrackSenders.forEach(function(e){return o.removeDataTrackSender(e)}),r._mediaTrackSenders.forEach(function(e){return o.removeMediaTrackSender(e)}),r._peerConnections.delete(o.id),r._closedPeerConnectionIds.add(o.id),_(r),b(r))}),o.on("connectionStateChanged",function(){return _(n)}),o.on("iceConnectionStateChanged",function(){return b(n)}),this._dataTrackSenders.forEach(o.addDataTrackSender,o),this._mediaTrackSenders.forEach(o.addMediaTrackSender,o),b(this)}return o}},{key:"close",value:function(){return this._peerConnections.forEach(function(e){e.close()}),this._dummyAudioTrackSender&&this._dummyAudioTrackSender.stop(),this._audioContextFactory&&this._audioContextFactory.release(this),b(this),this}},{key:"createAndOffer",value:function(){var e=this;return this._getConfiguration().then(function(t){var n=void 0;do{n=u.makeUUID()}while(e._peerConnections.has(n));return e._getOrCreate(n,t)}).then(function(e){return e.offer()}).then(function(){return e})}},{key:"getTrackReceivers",value:function(){return u.flatMap(this._peerConnections,function(e){return e.getTrackReceivers()})}},{key:"getStates",value:function(){var e=[];return this._peerConnections.forEach(function(t){var n=t.getState();n&&e.push(n)}),e}},{key:"setConfiguration",value:function(e){return this._configuration&&(this._configurationDeferred=u.defer(),this._peerConnections.forEach(function(t){t.setConfiguration(e)})),this._configuration=e,this._configurationDeferred.resolve(e),this}},{key:"setIceReconnectTimeout",value:function(e){return null===this._sessionTimeout&&(this._peerConnections.forEach(function(t){t.setIceReconnectTimeout(e)}),this._sessionTimeout=e),this}},{key:"setTrackSenders",value:function(e){var t=new Set(e.filter(function(e){return"data"===e.kind})),n=new Set(e.filter(function(e){return e&&("audio"===e.kind||"video"===e.kind)})),r=function(e,t,n){return{data:h(e,t),media:v(e,n)}}(this,t,n);return this._dataTrackSenders=t,this._mediaTrackSenders=n,function(e,t){(t.data.add.size||t.data.remove.size||t.media.add.size||t.media.remove.size)&&e._peerConnections.forEach(function(e){t.data.remove.forEach(e.removeDataTrackSender,e),t.media.remove.forEach(e.removeMediaTrackSender,e),t.data.add.forEach(e.addDataTrackSender,e),t.media.add.forEach(e.addMediaTrackSender,e),(t.media.add.size||t.media.remove.size||t.data.add.size&&!e.isApplicationSectionNegotiated)&&e.offer()})}(this,r),this}},{key:"update",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return n&&this._closeAbsentPeerConnections(e),this._getConfiguration().then(function(n){return Promise.all(e.map(function(e){return t._closedPeerConnectionIds.has(e.id)?null:t._getOrCreate(e.id,n).update(e)}))}).then(function(){return t})}},{key:"getStats",value:function(){var e=Array.from(this._peerConnections.values());return Promise.all(e.map(function(e){return e.getStats().then(function(t){return[e.id,t]})})).then(function(e){return new Map(e)})}},{key:"connectionState",get:function(){return this._connectionState}},{key:"iceConnectionState",get:function(){return this._iceConnectionState}}]),t}(s);function d(e){return e.createMediaStreamDestination().stream.getAudioTracks()[0]}function h(e,t){return{add:u.difference(t,e._dataTrackSenders),remove:u.difference(e._dataTrackSenders,t)}}function v(e,t){return{add:u.difference(t,e._mediaTrackSenders),remove:u.difference(e._mediaTrackSenders,t)}}var y={new:0,checking:1,connecting:2,connected:3,completed:4,disconnected:-1,failed:-2,closed:-3},m=void 0;function g(e){return e.length?(m=m||Object.keys(y).reduce(function(e,t){return Object.assign(e,(o=t,(r=y[t])in(n={})?Object.defineProperty(n,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[r]=o,n));var n,r,o},{}),e.reduce(function(e,t){return m[Math.max(y[e],y[t])]})):"new"}function b(e){e._lastIceConnectionState=e.iceConnectionState,e._iceConnectionState=g([].concat(o(e._peerConnections.values())).map(function(e){return e.iceConnectionState})),e.iceConnectionState!==e._lastIceConnectionState&&e.emit("iceConnectionStateChanged")}function _(e){e._lastConnectionState=e.connectionState,e._connectionState=g([].concat(o(e._peerConnections.values())).map(function(e){return e.connectionState})),e.connectionState!==e._lastConnectionState&&e.emit("connectionStateChanged")}e.exports=p},6378:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Object.defineProperties(e,{_revision:{value:1,writable:!0}}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"update",value:function(e){return e.revision<this._revision?this:(this._revision=e.revision,this.enable(e.is_recording))}}]),t}(n(468));e.exports=o},5666:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var i=n(2899),a=n(3214),c=function(e){function t(e,n,r,i,c,s){var u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var l=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.sid,e.identity));return s=Object.assign({RemoteTrackPublicationV2:a},s),Object.defineProperties(l,{_revision:{writable:!0,value:null},_RemoteTrackPublicationV2:{value:s.RemoteTrackPublicationV2},_getInitialTrackSwitchOffState:{value:n},updateSubscriberTrackPriority:{value:function(e,t){return r(e,t)}},updateTrackRenderHint:{value:function(e,t){return i(e,t)}},clearTrackHint:{value:function(e){return c(e)}},revision:{enumerable:!0,get:function(){return this._revision}}}),u=l.update(e),o(l,u)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"_getOrCreateTrack",value:function(e){var t=this._RemoteTrackPublicationV2,n=this.tracks.get(e.sid);return n||(n=new t(e,this._getInitialTrackSwitchOffState(e.sid)),this.addTrack(n)),n}},{key:"update",value:function(e){var t=this;if(null!==this.revision&&e.revision<=this.revision)return this;this._revision=e.revision;var n=new Set;switch(e.tracks.forEach(function(e){var r=t._getOrCreateTrack(e);r.update(e),n.add(r)}),this.tracks.forEach(function(e){n.has(e)||t.removeTrack(e)}),e.state){case"disconnected":this.disconnect();break;case"reconnecting":this.reconnecting();break;case"connected":this.connect(this.sid,this.identity)}return this}}]),t}(i);e.exports=c},3214:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){function t(e,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.sid,e.name,e.kind,e.enabled,e.priority,n))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"update",value:function(e){return this.enable(e.enabled),this.setPriority(e.priority),this}}]),t}(n(5293));e.exports=o},334:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(4992),i=n(4384).isDeepEqual,a=1,c=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"render_hints",n));return Object.defineProperties(r,{_trackSidsToRenderHints:{value:new Map},_dirtyTrackSids:{value:new Set},_isResponsePending:{value:!1,writable:!0}}),r.on("ready",function(e){e.on("message",function(e){switch(r._log.debug("Incoming: ",e),e.type){case"render_hints":r._processHintResults(e&&e.subscriber&&e.subscriber.hints||[]);break;default:r._log.warn("Unknown message type: ",e.type)}}),Array.from(r._trackSidsToRenderHints.keys()).forEach(function(e){return r._dirtyTrackSids.add(e)}),r._sendHints()}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"_processHintResults",value:function(e){var t=this;this._isResponsePending=!1,e.forEach(function(e){"OK"!==e.result&&t._log.debug("Server error processing hint:",e)}),this._sendHints()}},{key:"_sendHints",value:function(){var e=this;if(this._transport&&!this._isResponsePending&&0!==this._dirtyTrackSids.size){var t=[];Array.from(this._dirtyTrackSids).forEach(function(n){var r=e._trackSidsToRenderHints.get(n);t.push(r),e._dirtyTrackSids.delete(n)});var n={type:"render_hints",subscriber:{id:a++,hints:t}};this._log.debug("Outgoing: ",n),this._transport.publish(n),this._isResponsePending=!0}}},{key:"setTrackHint",value:function(e,t){var n={track:e};"enabled"in t&&(n.enabled=!!t.enabled),t.renderDimensions&&(n.render_dimensions=t.renderDimensions);var r=this._trackSidsToRenderHints.get(e);i(r,n)||(this._trackSidsToRenderHints.set(e,n),this._dirtyTrackSids.add(e),this._sendHints())}},{key:"clearTrackHint",value:function(e){this._trackSidsToRenderHints.delete(e),this._dirtyTrackSids.delete(e)}}]),t}(o);e.exports=c},3209:(e,t,n)=>{"use strict";var r=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(s){o=!0,i=s}finally{try{!r&&c.return&&c.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0},a=n(883),c=n(8539),s=n(4771),u=n(6378),l=n(3527),f=n(5666),p=n(2376),d=n(6308),h=n(6681),v=n(334),y=n(4384),m=y.constants.DEFAULT_SESSION_TIMEOUT_SEC,g=y.createBandwidthProfilePayload,b=y.defer,_=y.difference,w=y.filterObject,k=y.flatMap,O=y.oncePerTick,S=n(4040),P=n(450).createTwilioError,T=function(e){function t(e,n,r,o,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n.options=Object.assign({session_timeout:m},n.options),i=Object.assign({DominantSpeakerSignaling:a,NetworkQualityMonitor:c,NetworkQualitySignaling:s,RecordingSignaling:u,RemoteParticipantV2:f,TrackPrioritySignaling:d,TrackSwitchOffSignaling:h,bandwidthProfile:null,sessionTimeout:1e3*n.options.session_timeout,statsPublishIntervalMs:1e4},i),e.setBandwidthProfile(i.bandwidthProfile),o.setIceReconnectTimeout(i.sessionTimeout);var l=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n.sid,n.name,i)),y=function(e){return l._getTrackReceiver(e)},g=l._log;return Object.defineProperties(l,{_disconnectedParticipantRevisions:{value:new Map},_NetworkQualityMonitor:{value:i.NetworkQualityMonitor},_lastBandwidthProfileRevision:{value:e.bandwidthProfileRevision,writable:!0},_networkQualityMonitor:{value:null,writable:!0},_networkQualityConfiguration:{value:e.networkQualityConfiguration},_peerConnectionManager:{value:o},_published:{value:new Map},_publishedRevision:{value:0,writable:!0},_RemoteParticipantV2:{value:i.RemoteParticipantV2},_subscribed:{value:new Map},_subscribedRevision:{value:0,writable:!0},_subscriptionFailures:{value:new Map},_dominantSpeakerSignaling:{value:new i.DominantSpeakerSignaling(y,{log:g})},_networkQualitySignaling:{value:new i.NetworkQualitySignaling(y,e.networkQualityConfiguration,{log:g})},_renderHintsSignaling:{value:new v(y,{log:g})},_trackPrioritySignaling:{value:new i.TrackPrioritySignaling(y,{log:g})},_trackSwitchOffSignaling:{value:new i.TrackSwitchOffSignaling(y,{log:g})},_pendingSwitchOffStates:{value:new Map},_transport:{value:r},_trackReceiverDeferreds:{value:new Map},mediaRegion:{enumerable:!0,value:n.options.media_region||null}}),l._initTrackSwitchOffSignaling(),l._initDominantSpeakerSignaling(),l._initNetworkQualityMonitorSignaling(),function(e,t){var n=O(function(){e._publishNewLocalParticipantState()}),r=O(function(){var n=k(t.tracks,function(e){return e.trackTransceiver});e._peerConnectionManager.setTrackSenders(n)});t.on("trackAdded",r),t.on("trackRemoved",r),t.on("updated",n),e.on("stateChanged",function o(i){"disconnected"===i&&(t.removeListener("trackAdded",r),t.removeListener("trackRemoved",r),t.removeListener("updated",n),e.removeListener("stateChanged",o),t.disconnect())}),e.on("signalingConnectionStateChanged",function(){var t=e.localParticipant,n=t.identity,r=t.sid;switch(e.signalingConnectionState){case"connected":t.connect(r,n);break;case"reconnecting":t.reconnecting()}})}(l,e),function(e,t){t.on("description",function(t){e._publishPeerConnectionState(t)}),t.dequeue("description"),t.on("candidates",function(t){e._publishPeerConnectionState(t)}),t.dequeue("candidates"),t.on("trackAdded",e._addTrackReceiver.bind(e)),t.dequeue("trackAdded"),t.getTrackReceivers().forEach(e._addTrackReceiver,e),t.on("connectionStateChanged",function(){e.emit("connectionStateChanged")}),t.on("iceConnectionStateChanged",function(){e.emit("iceConnectionStateChanged"),"failed"===e.iceConnectionState&&(null!==e.localParticipant.networkQualityLevel&&e.localParticipant.setNetworkQualityLevel(0),e.participants.forEach(function(e){null!==e.networkQualityLevel&&e.setNetworkQualityLevel(0)}))})}(l,o),function(e,t){t.on("message",e._update.bind(e)),t.on("stateChanged",function n(r,o){"disconnected"===r&&("disconnected"!==e.state&&e._disconnect(o),t.removeListener("stateChanged",n)),e.emit("signalingConnectionStateChanged")})}(l,r),function(e,t,n){var r=new Map,o=!1,i=setInterval(function(){e.getStats().then(function(e){o=!o,e.forEach(function(e,n){var i=new p(n,e,!0);t.publishEvent("quality","stats-report","info",{audioTrackStats:i.remoteAudioTrackStats.map(function(t,n){return M(t,e.remoteAudioTrackStats[n],r)}),localAudioTrackStats:i.localAudioTrackStats.map(function(t,n){return R(t,e.localAudioTrackStats[n],r)}),localVideoTrackStats:i.localVideoTrackStats.map(function(t,n){return R(t,e.localVideoTrackStats[n],r)}),peerConnectionId:i.peerConnectionId,videoTrackStats:i.remoteVideoTrackStats.map(function(t,n){return M(t,e.remoteVideoTrackStats[n],r)})});var a=k(["localAudioTrackStats","localVideoTrackStats","remoteAudioTrackStats","remoteVideoTrackStats"],function(e){return i[e].map(function(e){return e.trackSid+"+"+e.ssrc})});if(_(Array.from(r.keys()),a).forEach(function(e){return r.delete(e)}),o){var c=function(e,t){return(e=Object.assign({availableIncomingBitrate:0,availableOutgoingBitrate:0,bytesReceived:0,bytesSent:0,consentRequestsSent:0,currentRoundTripTime:0,lastPacketReceivedTimestamp:0,lastPacketSentTimestamp:0,nominated:!1,peerConnectionId:t,priority:0,readable:!1,requestsReceived:0,requestsSent:0,responsesReceived:0,responsesSent:0,retransmissionsReceived:0,retransmissionsSent:0,state:"failed",totalRoundTripTime:0,transportId:"",writable:!1},w(e||{},null))).localCandidate=Object.assign({candidateType:"host",deleted:!1,ip:"",port:0,priority:0,protocol:"udp",url:""},w(e.localCandidate||{},null)),e.remoteCandidate=Object.assign({candidateType:"host",ip:"",port:0,priority:0,protocol:"udp",url:""},w(e.remoteCandidate||{},null)),e}(e.activeIceCandidatePair,i.peerConnectionId);t.publishEvent("quality","active-ice-candidate-pair","info",c)}})},function(){})},n);e.on("stateChanged",function t(n){"disconnected"===n&&(clearInterval(i),e.removeListener("stateChanged",t))})}(l,r,i.statsPublishIntervalMs),l._update(n),l}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),o(t,[{key:"_deleteTrackReceiverDeferred",value:function(e){return this._trackReceiverDeferreds.delete(e)}},{key:"_getOrCreateTrackReceiverDeferred",value:function(e){var t=this._trackReceiverDeferreds.get(e)||b(),n=this._peerConnectionManager.getTrackReceivers().find(function(t){return t.id===e&&"ended"!==t.readyState});return n?t.resolve(n):this._trackReceiverDeferreds.set(e,t),t}},{key:"_addTrackReceiver",value:function(e){return this._getOrCreateTrackReceiverDeferred(e.id).resolve(e),this}},{key:"_disconnect",value:function(e){var n=i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_disconnect",this).call(this,e);return n&&(this._teardownNetworkQualityMonitor(),this._transport.disconnect(),this._peerConnectionManager.close()),this.localParticipant.tracks.forEach(function(t){t.publishFailed(e||new Error("LocalParticipant disconnected"))}),n}},{key:"_getTrackReceiver",value:function(e){var t=this;return this._getOrCreateTrackReceiverDeferred(e).promise.then(function(n){return t._deleteTrackReceiverDeferred(e),n})}},{key:"_getInitialTrackSwitchOffState",value:function(e){var t=this._pendingSwitchOffStates.get(e)||!1;return this._pendingSwitchOffStates.delete(e),t&&this._log.warn("["+e+"] was initially switched off! "),t}},{key:"_getTrackSidsToTrackSignalings",value:function(){var e=k(this.participants,function(e){return Array.from(e.tracks)});return new Map(e)}},{key:"_getOrCreateRemoteParticipant",value:function(e){var t=this,n=this._RemoteParticipantV2,r=this.participants.get(e.sid),o=this;return r||((r=new n(e,function(e){return t._getInitialTrackSwitchOffState(e)},function(e,n){return t._trackPrioritySignaling.sendTrackPriorityUpdate(e,"subscribe",n)},function(e,n){return t._renderHintsSignaling.setTrackHint(e,n)},function(e){return t._renderHintsSignaling.clearTrackHint(e)})).on("stateChanged",function e(t){"disconnected"===t&&(r.removeListener("stateChanged",e),o.participants.delete(r.sid),o._disconnectedParticipantRevisions.set(r.sid,r.revision))}),this.connectParticipant(r)),r}},{key:"_getState",value:function(){return{participant:this.localParticipant.getState()}}},{key:"_maybeAddBandwidthProfile",value:function(e){var t=this.localParticipant,n=t.bandwidthProfile,r=t.bandwidthProfileRevision;return n&&this._lastBandwidthProfileRevision<r?(this._lastBandwidthProfileRevision=r,Object.assign({bandwidth_profile:g(n)},e)):e}},{key:"_publishNewLocalParticipantState",value:function(){this._transport.publish(this._maybeAddBandwidthProfile(this._getState()))}},{key:"_publishPeerConnectionState",value:function(e){this._transport.publish(Object.assign({peer_connections:[e]},this._getState()))}},{key:"_update",value:function(e){var t=this;if(e.subscribed&&e.subscribed.revision>this._subscribedRevision){this._subscribedRevision=e.subscribed.revision,e.subscribed.tracks.forEach(function(e){e.id?(t._subscriptionFailures.delete(e.sid),t._subscribed.set(e.sid,e.id)):e.error&&!t._subscriptionFailures.has(e.sid)&&t._subscriptionFailures.set(e.sid,e.error)});var n=new Set(e.subscribed.tracks.filter(function(e){return!!e.id}).map(function(e){return e.sid}));this._subscribed.forEach(function(e,r){n.has(r)||t._subscribed.delete(r)})}var r,o,i=new Set;return(e.participants||[]).forEach(function(e){if(e.sid!==t.localParticipant.sid){var n=t._disconnectedParticipantRevisions.get(e.sid);if(!(n&&e.revision<=n)){n&&t._disconnectedParticipantRevisions.delete(e.sid);var r=t._getOrCreateRemoteParticipant(e);r.update(e),i.add(r)}}}),"synced"===e.type&&this.participants.forEach(function(e){i.has(e)||e.disconnect()}),o=(r=this)._getTrackSidsToTrackSignalings(),r._subscriptionFailures.forEach(function(e,t){var n=o.get(t);n&&(r._subscriptionFailures.delete(t),n.subscribeFailed(P(e.code,e.message)))}),o.forEach(function(e){var t=r._subscribed.get(e.sid);(!t||e.isSubscribed&&e.trackTransceiver.id!==t)&&e.setTrackTransceiver(null),t&&r._getTrackReceiver(t).then(function(t){return e.setTrackTransceiver(t)})}),e.peer_connections&&this._peerConnectionManager.update(e.peer_connections,"synced"===e.type),e.recording&&this.recording.update(e.recording),e.published&&e.published.revision>this._publishedRevision&&(this._publishedRevision=e.published.revision,e.published.tracks.forEach(function(e){e.sid&&t._published.set(e.id,e.sid)}),this.localParticipant.update(e.published)),e.participant&&this.localParticipant.connect(e.participant.sid,e.participant.identity),[this._dominantSpeakerSignaling,this._networkQualitySignaling,this._trackPrioritySignaling,this._trackSwitchOffSignaling,this._renderHintsSignaling].forEach(function(t){var n=t.channel;!t.isSetup&&e.media_signaling&&e.media_signaling[n]&&e.media_signaling[n].transport&&"data-channel"===e.media_signaling[n].transport.type&&t.setup(e.media_signaling[n].transport.label)}),this}},{key:"_initTrackSwitchOffSignaling",value:function(){var e=this;this._trackSwitchOffSignaling.on("updated",function(t,n){try{e._log.debug("received trackSwitch: ",{tracksOn:n,tracksOff:t});var r=new Map;n.forEach(function(e){return r.set(e,!0)}),t.forEach(function(t){r.get(t)&&e._log.warn(t+" is DUPLICATED in both tracksOff and tracksOn list"),r.set(t,!1)}),e.participants.forEach(function(e){e.tracks.forEach(function(e){var t=r.get(e.sid);void 0!==t&&(e.setSwitchedOff(!t),r.delete(e.sid))})}),r.forEach(function(t,n){return e._pendingSwitchOffStates.set(n,!t)})}catch(o){e._log.error("error processing track switch off:",o)}})}},{key:"_initDominantSpeakerSignaling",value:function(){var e=this;this._dominantSpeakerSignaling.on("updated",function(){return e.setDominantSpeaker(e._dominantSpeakerSignaling.loudestParticipantSid)})}},{key:"_initNetworkQualityMonitorSignaling",value:function(){var e=this;this._networkQualitySignaling.on("ready",function(){var t=new e._NetworkQualityMonitor(e._peerConnectionManager,e._networkQualitySignaling);e._networkQualityMonitor=t,t.on("updated",function(){"failed"!==e.iceConnectionState&&(e.localParticipant.setNetworkQualityLevel(t.level,t.levels),e.participants.forEach(function(e){var n=t.remoteLevels.get(e.sid);n&&e.setNetworkQualityLevel(n.level,n)}))}),t.start()}),this._networkQualitySignaling.on("teardown",function(){return e._teardownNetworkQualityMonitor()})}},{key:"_teardownNetworkQualityMonitor",value:function(){this._networkQualityMonitor&&(this._networkQualityMonitor.stop(),this._networkQualityMonitor=null)}},{key:"getStats",value:function(){var e=this;return this._peerConnectionManager.getStats().then(function(t){return new Map(Array.from(t).map(function(t){var n=r(t,2),o=n[1];return[n[0],Object.assign({},o,{localAudioTrackStats:E(e,o.localAudioTrackStats),localVideoTrackStats:E(e,o.localVideoTrackStats),remoteAudioTrackStats:j(e,o.remoteAudioTrackStats),remoteVideoTrackStats:j(e,o.remoteVideoTrackStats)})]}))})}},{key:"connectionState",get:function(){return this._peerConnectionManager.connectionState}},{key:"signalingConnectionState",get:function(){return"syncing"===this._transport.state?"reconnecting":this._transport.state}},{key:"iceConnectionState",get:function(){return this._peerConnectionManager.iceConnectionState}}]),t}(l);function C(e,t){return t.reduce(function(t,n){var r=e.get(n.trackId);return r?[Object.assign({},n,{trackSid:r})].concat(t):t},[])}function E(e,t){return C(e._published,t)}function j(e,t){return C(new Map(Array.from(e._subscribed.entries()).map(function(e){var t=r(e,2);return[t[1],t[0]]})),t)}function R(e,t,n){var r=t.framesEncoded,o=t.packetsSent,i=t.totalEncodeTime,a=t.totalPacketSendDelay,c=Object.assign({},e),s=e.trackSid+"+"+e.ssrc,u=n.get(s)||new Map;if("number"==typeof i&&"number"==typeof r){var l=u.get("avgEncodeDelay")||new S;l.putSample(1e3*i,r),c.avgEncodeDelay=l.get(),u.set("avgEncodeDelay",l)}if("number"==typeof a&&"number"==typeof o){var f=u.get("avgPacketSendDelay")||new S;f.putSample(1e3*a,o),c.avgPacketSendDelay=f.get(),u.set("avgPacketSendDelay",f)}return n.set(s,u),c}function M(e,t,n){var r=t.estimatedPlayoutTimestamp,o=t.framesDecoded,i=t.jitterBufferDelay,a=t.jitterBufferEmittedCount,c=t.totalDecodeTime,s=Object.assign({},e),u=e.trackSid+"+"+e.ssrc,l=n.get(u)||new Map;if("number"==typeof r&&(s.estimatedPlayoutTimestamp=r),"number"==typeof o&&"number"==typeof c){var f=l.get("avgDecodeDelay")||new S;f.putSample(1e3*c,o),s.avgDecodeDelay=f.get(),l.set("avgDecodeDelay",f)}if("number"==typeof i&&"number"==typeof a){var p=l.get("avgJitterBufferDelay")||new S;p.putSample(1e3*i,a),s.avgJitterBufferDelay=p.get(),l.set("avgJitterBufferDelay",p)}return n.set(u,l),s}e.exports=T},6308:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"track_priority",n));return Object.defineProperties(r,{_enqueuedPriorityUpdates:{value:new Map}}),r.on("ready",function(e){Array.from(r._enqueuedPriorityUpdates.keys()).forEach(function(t){e.publish({type:"track_priority",track:t,subscribe:r._enqueuedPriorityUpdates.get(t)})})}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"sendTrackPriorityUpdate",value:function(e,t,n){if("subscribe"!==t)throw new Error("only subscribe priorities are supported, found: "+t);this._enqueuedPriorityUpdates.set(e,n),this._transport&&this._transport.publish({type:"track_priority",track:e,subscribe:n})}}]),t}(n(4992));e.exports=o},6681:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"track_switch_off",n));return r.on("ready",function(e){e.on("message",function(e){switch(e.type){case"track_switch_off":r._setTrackSwitchOffUpdates(e.off||[],e.on||[])}})}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"_setTrackSwitchOffUpdates",value:function(e,t){this.emit("updated",e,t)}}]),t}(n(4992));e.exports=o},7008:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(3608).getSdpFormat,i=n(5406),a=n(3518),c=n(8488),s=n(963),u=n(6921),l=n(4641),f=n(2779).reconnectBackoffConfig,p=n(9106),d=n(4384),h=d.createBandwidthProfilePayload,v=d.createMediaSignalingPayload,y=d.createSubscribePayload,m=d.getUserAgent,g=d.isNonArrayObject,b=n(450),_=b.createTwilioError,w=b.RoomCompletedError,k=b.SignalingConnectionError,O=b.SignalingServerBusyError,S=i.name+".js",P=i.version,T={connecting:["connected","disconnected"],connected:["disconnected","syncing"],syncing:["connected","disconnected"],disconnected:[]},C=function(e){function t(e,n,r,i,s,p){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),p=Object.assign({Backoff:l,InsightsPublisher:a,NullInsightsPublisher:c,TwilioConnection:u,iceServers:null,sdpFormat:o(p.sdpSemantics),trackPriority:!0,trackSwitchOff:!0,renderHints:!0,userAgent:m()},p);var d=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"connecting",T)),h={};p.wsServerInsights&&(h.gateway=p.wsServerInsights);var v=new(p.insights?p.InsightsPublisher:p.NullInsightsPublisher)(n,S,P,p.environment,p.realm,h);return Object.defineProperties(d,{_accessToken:{value:n},_automaticSubscription:{value:p.automaticSubscription},_bandwidthProfile:{value:p.bandwidthProfile},_disconnectEventPublisher:{value:function(){return v.disconnect()}},_dominantSpeaker:{value:p.dominantSpeaker},_eventObserver:{value:p.eventObserver,writable:!1},_renderHints:{value:p.renderHints},_iceServersStatus:{value:Array.isArray(p.iceServers)?"overrode":"acquire"},_localParticipant:{value:r},_name:{value:e},_networkQuality:{value:g(p.networkQuality)||p.networkQuality},_options:{value:p},_peerConnectionManager:{value:i},_sessionTimer:{value:null,writable:!0},_sessionTimeoutMS:{value:0,writable:!0},_reconnectBackoff:{value:p.Backoff.exponential(f)},_session:{value:null,writable:!0},_trackPriority:{value:p.trackPriority},_trackSwitchOff:{value:p.trackSwitchOff},_twilioConnection:{value:null,writable:!0},_updatesReceived:{value:[]},_updatesToSend:{value:[]},_userAgent:{value:p.userAgent},_wsServer:{value:s}}),d._eventObserver.setPublisher(v),function(e){function t(){if("disconnected"!==e.state){e._twilioConnection&&e._twilioConnection.removeListener("message",r);var t=e._options,o=t.TwilioConnection,i=new o(e._wsServer,Object.assign({helloBody:"connecting"===e.state&&"acquire"===e._iceServersStatus?e._createIceMessage():e._createConnectOrSyncOrDisconnectMessage()},t));i.once("close",function(e){e===o.CloseReason.LOCAL?n():n(new Error(e))}),i.on("message",r),e._twilioConnection=i}}function n(n){if("disconnected"!==e.state)if(n){var r=e._getReconnectTimer();if(r)"connected"===e.state&&e.preempt("syncing"),r.then(t);else{var o=n.message===u.CloseReason.BUSY?new O:new k;e.disconnect(o)}}else e.disconnect()}function r(t){if("disconnected"!==e.state)if("error"!==t.type)switch(e.state){case"connected":switch(t.type){case"connected":case"synced":case"update":return void e.emit("message",t);case"disconnected":return void e.disconnect("completed"===t.status?new w:null);default:return}case"connecting":switch(t.type){case"iced":return void e._options.onIced(t.ice_servers).then(function(){e._sendConnectOrSyncOrDisconnectMessage()});case"connected":return e._setSession(t.session,t.options.session_timeout),e.emit("connected",t),void e.preempt("connected");case"synced":case"update":return void e._updatesReceived.push(t);case"disconnected":return void e.disconnect("completed"===t.status?new w:null);default:return}case"syncing":switch(t.type){case"connected":case"update":return void e._updatesReceived.push(t);case"synced":return e._clearReconnectTimer(),e.emit("message",t),void e.preempt("connected");case"disconnected":return void e.disconnect("completed"===t.status?new w:null);default:return}default:return}else e.disconnect(_(t.code,t.message))}e.on("stateChanged",function t(n){switch(n){case"connected":var o=e._updatesToSend.splice(0);return o.length&&e.publish(function(e){return e.reduce(function(e,t){return(!e.participant&&t.participant||e.participant&&t.participant&&t.participant.revision>e.participant.revision)&&(e.participant=t.participant),!e.peer_connections&&t.peer_connections?e.peer_connections=E(t.peer_connections):e.peer_connections&&t.peer_connections&&(e.peer_connections=E(e.peer_connections.concat(t.peer_connections))),e},{})}(o)),void e._updatesReceived.splice(0).forEach(function(t){return e.emit("message",t)});case"disconnected":return e._twilioConnection.removeListener("message",r),void e.removeListener("stateChanged",t);case"syncing":default:return}});var o=e._options;"overrode"===e._iceServersStatus?(0,o.onIced)(o.iceServers).then(t):t()}(d),d.once("connected",function(e){v.connect(e.sid,e.participant.sid)}),d}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"_createConnectOrSyncOrDisconnectMessage",value:function(){if("connected"===this.state)return null;if("disconnected"===this.state)return{session:this._session,type:"disconnect",version:2};var e={connecting:"connect",syncing:"sync"}[this.state],t={name:this._name,participant:this._localParticipant.getState(),peer_connections:this._peerConnectionManager.getStates(),type:e,version:2};if("connect"===t.type){t.ice_servers=this._iceServersStatus,t.publisher={name:S,sdk_version:P,user_agent:this._userAgent},this._bandwidthProfile&&(t.bandwidth_profile=h(this._bandwidthProfile)),t.media_signaling=v(this._dominantSpeaker,this._networkQuality,this._trackPriority,this._trackSwitchOff,this._renderHints),t.subscribe=y(this._automaticSubscription);var n=this._options.sdpFormat;n&&(t.format=n),t.token=this._accessToken}else"sync"===t.type?(t.session=this._session,t.token=this._accessToken):"update"===t.type&&(t.session=this._session);return t}},{key:"_createIceMessage",value:function(){return{edge:"roaming",token:this._accessToken,type:"ice",version:1}}},{key:"_sendConnectOrSyncOrDisconnectMessage",value:function(){var e=this._createConnectOrSyncOrDisconnectMessage();e&&this._twilioConnection.sendMessage(e)}},{key:"disconnect",value:function(e){return"disconnected"!==this.state&&(this.preempt("disconnected",null,[e]),this._sendConnectOrSyncOrDisconnectMessage(),this._twilioConnection.close(),this._disconnectEventPublisher(),!0)}},{key:"publish",value:function(e){switch(this.state){case"connected":return this._twilioConnection.sendMessage(Object.assign({session:this._session,type:"update",version:2},e)),!0;case"connecting":case"syncing":return this._updatesToSend.push(e),!0;case"disconnected":default:return!1}}},{key:"publishEvent",value:function(e,t,n,r){this._eventObserver.emit("event",{group:e,name:t,level:n,payload:r})}},{key:"sync",value:function(){return"connected"===this.state&&(this.preempt("syncing"),this._sendConnectOrSyncOrDisconnectMessage(),!0)}},{key:"_setSession",value:function(e,t){this._session=e,this._sessionTimeoutMS=1e3*t}},{key:"_getReconnectTimer",value:function(){var e=this;return 0===this._sessionTimeoutMS?null:(this._sessionTimer||(this._sessionTimer=new p(function(){e._sessionTimer&&(e._sessionTimeoutMS=0)},this._sessionTimeoutMS)),new Promise(function(t){e._reconnectBackoff.once("ready",t),e._reconnectBackoff.backoff()}))}},{key:"_clearReconnectTimer",value:function(){this._reconnectBackoff.reset(),this._sessionTimer&&(this._sessionTimer.clear(),this._sessionTimer=null)}}]),t}(s);function E(e){return Array.from(e.reduce(function(e,t){var n=e.get(t.id)||t;return(!n.description&&t.description||n.description&&t.description&&t.description.revision>n.description.revision)&&(n.description=t.description),(!n.ice&&t.ice||n.ice&&t.ice&&t.ice.revision>n.ice.revision)&&(n.ice=t.ice),e.set(n.id,n),e},new Map).values())}e.exports=C},963:(e,t,n)=>{"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(5068).EventEmitter,a=n(4384),c=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r,o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),i=null,a=e;return n=function(e){var t=new Map;for(var n in e)t.set(n,new Set(e[n]));return t}(n),Object.defineProperties(o,{_lock:{get:function(){return i},set:function(e){i=e}},_reachableStates:{value:(r=n,Array.from(r.keys()).reduce(function(e,t){return e.set(t,u(r,t))},new Map))},_state:{get:function(){return a},set:function(e){a=e}},_states:{value:n},_whenDeferreds:{value:new Set},isLocked:{enumerable:!0,get:function(){return null!==i}},state:{enumerable:!0,get:function(){return a}}}),o.on("stateChanged",function(e){o._whenDeferreds.forEach(function(t){t.when(e,t.resolve,t.reject)})}),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),o(t,[{key:"_whenPromise",value:function(e){var t=this;if("function"!=typeof e)return Promise.reject(new Error("when() executor must be a function"));var n=a.defer();return n.when=e,this._whenDeferreds.add(n),n.promise.then(function(e){return t._whenDeferreds.delete(n),e},function(e){throw t._whenDeferreds.delete(n),e})}},{key:"bracket",value:function(e,t){var n=void 0,r=this;function o(e){if(r.hasLock(n)&&r.releaseLockCompletely(n),e)throw e}return this.takeLock(e).then(function(e){return t(n=e)}).then(function(e){return o(),e},o)}},{key:"hasLock",value:function(e){return this._lock===e}},{key:"preempt",value:function(e,t,n){if(!s(this._states,this.state,e))throw new Error('Cannot transition from "'+this.state+'" to "'+e+'"');var r=void 0;this.isLocked&&(r=this._lock,this._lock=null);var o=null;t&&(o=this.takeLockSync(t));var i=o?null:this.takeLockSync("preemption");return this.transition(e,o||i,n),r&&r.resolve(),i&&this.releaseLock(i),o}},{key:"releaseLock",value:function(e){if(!this.isLocked)throw new Error("Could not release the lock for "+e.name+" because the StateMachine is not locked");if(!this.hasLock(e))throw new Error("Could not release the lock for "+e.name+" because "+this._lock.name+" has the lock");0===e.depth?(this._lock=null,e.resolve()):e.depth--}},{key:"releaseLockCompletely",value:function(e){if(!this.isLocked)throw new Error("Could not release the lock for "+e.name+" because the StateMachine is not locked");if(!this.hasLock(e))throw new Error("Could not release the lock for "+e.name+" because "+this._lock.name+" has the lock");e.depth=0,this._lock=null,e.resolve()}},{key:"takeLock",value:function(e){var t=this;if("object"===(void 0===e?"undefined":r(e))){var n=e;return new Promise(function(e){e(t.takeLockSync(n))})}var o=e;if(this.isLocked){var i=this.takeLock.bind(this,o);return this._lock.promise.then(i)}return Promise.resolve(this.takeLockSync(o))}},{key:"takeLockSync",value:function(e){var t="string"==typeof e?null:e,n=t?t.name:e;if(t&&!this.hasLock(t)||!t&&this.isLocked)throw new Error("Could not take the lock for "+n+" because the lock for "+this._lock.name+" was not released");if(t)return t.depth++,t;var r=function(e){var t=a.defer();return t.name=e,t.depth=0,t}(n);return this._lock=r,r}},{key:"transition",value:function(e,t,n){if(n=n||[],this.isLocked){if(!t)throw new Error("You must provide the key in order to transition");if(!this.hasLock(t))throw new Error("Could not transition using the key for "+t.name+" because "+this._lock.name+" has the lock")}else if(t)throw new Error("Key provided for "+t.name+", but the StateMachine was not locked (possibly due to preemption)");if(!s(this._states,this.state,e))throw new Error('Cannot transition from "'+this.state+'" to "'+e+'"');this._state=e,this.emit.apply(this,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(["stateChanged",e].concat(n)))}},{key:"tryTransition",value:function(e,t,n){try{this.transition(e,t,n)}catch(r){return!1}return!0}},{key:"when",value:function(e){var t=this;return this.state===e?Promise.resolve(this):s(this._reachableStates,this.state,e)?this._whenPromise(function(n,r,o){n===e?r(t):s(t._reachableStates,n,e)||o(l(n,e))}):Promise.reject(l(this.state,e))}}]),t}(i);function s(e,t,n){return e.get(t).has(n)}function u(e,t,n){return n=n||new Set,e.get(t).forEach(function(t){n.has(t)||(n.add(t),u(e,t,n).forEach(n.add,n))}),n}function l(e,t){return new Error('"'+t+'" cannot be reached from "'+e+'"')}e.exports=c},9352:e=>{"use strict";e.exports=function(e){return(e=e.filter(function(e){return"number"==typeof e})).length<1?void 0:e.reduce(function(e,t){return t+e})/e.length}},4232:e=>{"use strict";var t=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),n=function(){function e(t,n,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{availableSend:{enumerable:!0,value:r},recv:{enumerable:!0,value:n},rtt:{enumerable:!0,value:o},send:{enumerable:!0,value:t}})}return t(e,null,[{key:"of",value:function(t,n){var r=(n.timestamp-t.timestamp)/1e3;return new e(r>0?(n.bytesSent-t.bytesSent)/r*8:0,r>0?(n.bytesReceived-t.bytesReceived)/r*8:0,n.availableOutgoingBitrate,n.currentRoundTripTime)}}]),e}();e.exports=n},6313:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(4232),i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{lastReport:{enumerable:!0,value:new o(0,0),writable:!0},lastStats:{enumerable:!0,value:null,writable:!0}})}return r(e,[{key:"next",value:function(e){var t=this.lastStats;if(this.lastStats=e,t){var n=t.id===e.id?o.of(t,e):new o(0,0);this.lastReport=n}return this.lastReport}}]),e}();e.exports=i},2736:(e,t,n)=>{"use strict";var r=function(e){function t(e,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r));return Object.defineProperties(o,{audioLevel:{value:"number"==typeof n.audioInputLevel?n.audioInputLevel:null,enumerable:!0},jitter:{value:"number"==typeof n.jitter?n.jitter:null,enumerable:!0}}),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(n(4802));e.exports=r},4802:(e,t,n)=>{"use strict";var r=function(e){function t(e,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return Object.defineProperties(o,{bytesSent:{value:"number"==typeof n.bytesSent?n.bytesSent:r?0:null,enumerable:!0},packetsSent:{value:"number"==typeof n.packetsSent?n.packetsSent:r?0:null,enumerable:!0},roundTripTime:{value:"number"==typeof n.roundTripTime?n.roundTripTime:r?0:null,enumerable:!0}}),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(n(8610));e.exports=r},8176:(e,t,n)=>{"use strict";var r=function(e){function t(e,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r)),i=null;"number"==typeof n.frameWidthInput&&"number"==typeof n.frameHeightInput&&(i={},Object.defineProperties(i,{width:{value:n.frameWidthInput,enumerable:!0},height:{value:n.frameHeightInput,enumerable:!0}}));var a=null;return"number"==typeof n.frameWidthSent&&"number"==typeof n.frameHeightSent&&(a={},Object.defineProperties(a,{width:{value:n.frameWidthSent,enumerable:!0},height:{value:n.frameHeightSent,enumerable:!0}})),Object.defineProperties(o,{captureDimensions:{value:i,enumerable:!0},dimensions:{value:a,enumerable:!0},captureFrameRate:{value:"number"==typeof n.frameRateInput?n.frameRateInput:null,enumerable:!0},frameRate:{value:"number"==typeof n.frameRateSent?n.frameRateSent:null,enumerable:!0}}),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(n(4802));e.exports=r},9921:(e,t,n)=>{"use strict";var r=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(n(6155));e.exports=r},9607:e=>{"use strict";e.exports=function e(t){var n=t.actual,r=void 0===n?null:n,o=t.available,i=void 0===o?null:o,a=t.level,c=void 0===a?null:a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{actual:{value:r,enumerable:!0},available:{value:i,enumerable:!0},level:{value:c,enumerable:!0}})}},6730:e=>{"use strict";e.exports=function e(t){var n=t.fractionLost,r=void 0===n?null:n,o=t.level,i=void 0===o?null:o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{fractionLost:{value:r,enumerable:!0},level:{value:i,enumerable:!0}})}},5379:e=>{"use strict";e.exports=function e(t){var n=t.jitter,r=void 0===n?null:n,o=t.rtt,i=void 0===o?null:o,a=t.level,c=void 0===a?null:a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{jitter:{value:r,enumerable:!0},rtt:{value:i,enumerable:!0},level:{value:c,enumerable:!0}})}},6155:(e,t,n)=>{"use strict";var r=n(1164),o=n(788);e.exports=function e(t){var n=t.send,i=t.recv,a=t.sendStats,c=void 0===a?null:a,s=t.recvStats,u=void 0===s?null:s;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{send:{value:n,enumerable:!0},recv:{value:i,enumerable:!0},sendStats:{value:c?new r(c):null,enumerable:!0},recvStats:{value:u?new o(u):null,enumerable:!0}})}},788:(e,t,n)=>{"use strict";var r=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(n(7496));e.exports=r},7496:(e,t,n)=>{"use strict";var r=n(9607),o=n(6730),i=n(5379);e.exports=function e(t){var n=t.bandwidth,a=void 0===n?null:n,c=t.fractionLost,s=void 0===c?null:c,u=t.latency,l=void 0===u?null:u;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{bandwidth:{value:a?new r(a):null,enumerable:!0},fractionLost:{value:s?new o(s):null,enumerable:!0},latency:{value:l?new i(l):null,enumerable:!0}})}},1164:(e,t,n)=>{"use strict";var r=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(n(7496));e.exports=r},2947:(e,t,n)=>{"use strict";var r=n(9921),o=n(4582);e.exports=function e(t){var n=t.level,i=t.audio,a=t.video;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{level:{value:n,enumerable:!0},audio:{value:i?new r(i):null,enumerable:!0},video:{value:a?new o(a):null,enumerable:!0}})}},4582:(e,t,n)=>{"use strict";var r=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(n(6155));e.exports=r},9813:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(9420),i=n(202),a=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{ice:{enumerable:!0,value:t},audio:{enumerable:!0,value:n},video:{enumerable:!0,value:r}})}return r(e,[{key:"summarize",value:function(){var e=this.audio.send.concat(this.video.send),t=i.summarize(e),n=this.audio.recv.concat(this.video.recv),r=o.summarize(n);return{ice:this.ice,send:t,recv:r,audio:{send:i.summarize(this.audio.send),recv:o.summarize(this.audio.recv)},video:{send:i.summarize(this.video.send),recv:o.summarize(this.video.recv)}}}}]),e}();e.exports=a},7993:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var i=n(7454).guessBrowser,a=n(6313),c=n(9813),s=n(7034),u=n(1629),l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{pc:{enumerable:!0,value:t},ice:{enumerable:!0,value:new a},audio:{enumerable:!0,value:{send:new Map,recv:new Map}},video:{enumerable:!0,value:{send:new Map,recv:new Map}},lastReport:{enumerable:!0,value:null,writable:!0}})}return r(e,[{key:"next",value:function(){var e,t,n,r=this;return("firefox"===i()?(t=(e=this).pc.getTransceivers().filter(function(e){return e.currentDirection&&e.currentDirection.match(/send/)&&e.sender.track}).map(function(e){return e.sender}),n=e.pc.getTransceivers().filter(function(e){return e.currentDirection&&e.currentDirection.match(/recv/)}).map(function(e){return e.receiver}),Promise.all([f(t),f(n),e.pc.getStats()]).then(function(t){var n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),3!==n.length);r=!0);}catch(s){o=!0,i=s}finally{try{!r&&c.return&&c.return()}finally{if(o)throw i}}return n}(e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}(t),r=n[0],o=n[1],i=n[2],a=d(e),c=m(e);r.forEach(function(t,n){return b(e,t,c,n)}),w(a,c);var s=h(e),u=g(e);o.forEach(function(t,n){return _(e,t,u,n)}),w(s,u),k(e.ice,i)})):function(e){return e.pc.getStats().then(function(t){var n=d(e),r=m(e);b(e,t,r),w(n,r);var o=h(e),i=g(e);_(e,t,i),w(o,i),k(e.ice,t)})}(this)).then(function(){var e=[].concat(o(r.audio.send.values())),t=[].concat(o(r.video.send.values())),n=[].concat(o(r.audio.recv.values())),i=[].concat(o(r.video.recv.values())),a=new c(r.ice.lastReport,{send:e.map(function(e){return e.lastReport}).filter(function(e){return e}),recv:n.map(function(e){return e.lastReport}).filter(function(e){return e})},{send:t.map(function(e){return e.lastReport}).filter(function(e){return e}),recv:i.map(function(e){return e.lastReport}).filter(function(e){return e})});return r.lastReport=a,a})}}]),e}();function f(e){return Promise.all(e.map(function(e){var t=e.track.id;return e.getStats().then(function(e){var n=!0,r=!1,o=void 0;try{for(var i,a=e.values()[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var c=i.value;"inbound-rtp"===c.type&&(c.id=t+"-"+c.id)}}catch(s){r=!0,o=s}finally{try{!n&&a.return&&a.return()}finally{if(r)throw o}}return[t,e]})})).then(function(e){return new Map(e)})}function p(e,t,n,r,o){var i=t[r.mediaType];if(!o){var a=n.get(r.trackId);a&&(o=a.trackIdentifier)}if(i&&o){if(i.has(r.id))return i.get(r.id);var c=new e(o,r);i.set(r.id,c)}return null}function d(e){return{audio:e.audio.send,video:e.video.send}}function h(e){return{audio:e.audio.recv,video:e.video.recv}}function v(e,t,n,r){return p(u,d(e),t,n,r)}function y(e,t,n,r){return p(s,h(e),t,n,r)}function m(e){return{audio:new Set(e.audio.send.keys()),video:new Set(e.video.send.keys())}}function g(e){return{audio:new Set(e.audio.recv.keys()),video:new Set(e.video.recv.keys())}}function b(e,t,n,r){var o=!0,a=!1,c=void 0;try{for(var s,u=t.values()[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){var l=s.value;if("outbound-rtp"===l.type&&!l.isRemote){if("firefox"!==i()&&!l.trackId)continue;var f=n[l.mediaType];f&&f.delete(l.id);var p=v(e,t,l,r);if(p){var d=t.get(l.remoteId);p.next(r||p.trackId,l,d)}}}}catch(h){a=!0,c=h}finally{try{!o&&u.return&&u.return()}finally{if(a)throw c}}}function _(e,t,n,r){var o=!0,i=!1,a=void 0;try{for(var c,s=t.values()[Symbol.iterator]();!(o=(c=s.next()).done);o=!0){var u=c.value;if("inbound-rtp"===u.type&&!u.isRemote){var l=n[u.mediaType];l&&l.delete(u.id);var f=y(e,t,u,r);f&&f.next(r||f.trackId,u)}}}catch(p){i=!0,a=p}finally{try{!o&&s.return&&s.return()}finally{if(i)throw a}}}function w(e,t){var n=function(n){var r=e[n];t[n].forEach(function(e){return r.delete(e)})};for(var r in t)n(r)}function k(e,t){var n=void 0,r=!0,o=!1,i=void 0;try{for(var a,c=t.values()[Symbol.iterator]();!(r=(a=c.next()).done);r=!0){var s=a.value;"transport"===s.type&&(n=t.get(s.selectedCandidatePairId))}}catch(v){o=!0,i=v}finally{try{!r&&c.return&&c.return()}finally{if(o)throw i}}if(n)e.next(n);else{var u=!0,l=!1,f=void 0;try{for(var p,d=t.values()[Symbol.iterator]();!(u=(p=d.next()).done);u=!0){var h=p.value;"candidate-pair"!==h.type||!h.nominated||"selected"in h&&!h.selected||e.next(h)}}catch(v){l=!0,f=v}finally{try{!u&&d.return&&d.return()}finally{if(l)throw f}}}}e.exports=l},9420:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(9352),i=n(1666),a=n(1982),c=function(e){function t(e,n,r,o,i,a,c){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r));return Object.defineProperties(s,{deltaPacketsLost:{enumerable:!0,value:o},deltaPacketsReceived:{enumerable:!0,value:i},fractionLost:{enumerable:!0,value:a},jitter:{enumerable:!0,value:c},phonyFractionLost:{enumerable:!0,value:i>0?o/i:0}}),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"summarize",value:function(){return{bitrate:this.bitrate,fractionLost:"number"==typeof this.fractionLost?this.fractionLost:this.phonyFractionLost,jitter:this.jitter}}}],[{key:"of",value:function(e,n,r){if(n.id!==r.id)throw new Error("RTCStats IDs must match");var o=(r.timestamp-n.timestamp)/1e3,i=o>0?(r.bytesReceived-n.bytesReceived)/o*8:0,a=Math.max(r.packetsLost-n.packetsLost,0);return new t(n.id,e,i,a,r.packetsReceived-n.packetsReceived,r.fractionLost,r.jitter)}},{key:"summarize",value:function(e){var t=e.map(function(e){return e.summarize()});return{bitrate:a(t.map(function(e){return e.bitrate})),fractionLost:o(t.map(function(e){return e.fractionLost})),jitter:o(t.map(function(e){return e.jitter}))}}}]),t}(i);e.exports=c},7034:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(9420),i=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n.id,e,n));return Object.defineProperties(r,{lastReport:{enumerable:!0,value:null,writable:!0}}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"next",value:function(e,t){var n=this.lastStats;this.lastStats=t,this.trackId=e;var r=o.of(e,n,t);return this.lastReport=r,r}}]),t}(n(7719));e.exports=i},1068:(e,t,n)=>{"use strict";var r=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return Object.defineProperties(r,{audioLevel:{value:"number"==typeof n.audioOutputLevel?n.audioOutputLevel:null,enumerable:!0},jitter:{value:"number"==typeof n.jitter?n.jitter:null,enumerable:!0}}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(n(5649));e.exports=r},5649:(e,t,n)=>{"use strict";var r=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return Object.defineProperties(r,{bytesReceived:{value:"number"==typeof n.bytesReceived?n.bytesReceived:null,enumerable:!0},packetsReceived:{value:"number"==typeof n.packetsReceived?n.packetsReceived:null,enumerable:!0}}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(n(8610));e.exports=r},1419:(e,t,n)=>{"use strict";var r=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),o=null;return"number"==typeof n.frameWidthReceived&&"number"==typeof n.frameHeightReceived&&(o={},Object.defineProperties(o,{width:{value:n.frameWidthReceived,enumerable:!0},height:{value:n.frameHeightReceived,enumerable:!0}})),Object.defineProperties(r,{dimensions:{value:o,enumerable:!0},frameRate:{value:"number"==typeof n.frameRateReceived?n.frameRateReceived:null,enumerable:!0}}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(n(5649));e.exports=r},1666:e=>{"use strict";e.exports=function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{id:{enumerable:!0,value:t},trackId:{enumerable:!0,value:n},bitrate:{enumerable:!0,value:r}})}},7719:e=>{"use strict";e.exports=function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{id:{enumerable:!0,value:t,writable:!0},trackId:{enumerable:!0,value:n,writable:!0},lastStats:{enumerable:!0,value:r,writable:!0}})}},202:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(9352),i=n(1666),a=n(1982),c=function(e){function t(e,n,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r));return Object.defineProperties(i,{rtt:{enumerable:!0,value:o}}),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,null,[{key:"of",value:function(e,n,r,o){if(n.id!==r.id)throw new Error("RTCStats IDs must match");var i=(r.timestamp-n.timestamp)/1e3;return new t(n.id,e,i>0?(r.bytesSent-n.bytesSent)/i*8:0,o&&"number"==typeof o.roundTripTime?o.roundTripTime/1e3:void 0)}},{key:"summarize",value:function(e){return{bitrate:a(e.map(function(e){return e.bitrate})),rtt:o(e.map(function(e){return e.rtt}))}}}]),t}(i);e.exports=c},1629:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(7719),i=n(202),a=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n.id,e,n));return Object.defineProperties(r,{lastReport:{enumerable:!0,value:null,writable:!0}}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"next",value:function(e,t,n){var r=this.lastStats;this.lastStats=t,this.trackId=e;var o=i.of(e,r,t,n);return this.lastReport=o,o}}]),t}(o);e.exports=a},2376:(e,t,n)=>{"use strict";var r=n(2736),o=n(8176),i=n(1068),a=n(1419);e.exports=function e(t,n,c){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"string"!=typeof t)throw new Error("RTCPeerConnection id must be a string");Object.defineProperties(this,{peerConnectionId:{value:t,enumerable:!0},localAudioTrackStats:{value:n.localAudioTrackStats.map(function(e){return new r(e.trackId,e,c)}),enumerable:!0},localVideoTrackStats:{value:n.localVideoTrackStats.map(function(e){return new o(e.trackId,e,c)}),enumerable:!0},remoteAudioTrackStats:{value:n.remoteAudioTrackStats.map(function(e){return new i(e.trackId,e)}),enumerable:!0},remoteVideoTrackStats:{value:n.remoteVideoTrackStats.map(function(e){return new a(e.trackId,e)}),enumerable:!0}})}},1982:e=>{"use strict";e.exports=function(e){return e.reduce(function(e,t){return"number"==typeof t?t+e:e},0)}},8610:e=>{"use strict";e.exports=function e(t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"string"!=typeof t)throw new Error("Track id must be a string");Object.defineProperties(this,{trackId:{value:t,enumerable:!0},trackSid:{value:n.trackSid,enumerable:!0},timestamp:{value:n.timestamp,enumerable:!0},ssrc:{value:n.ssrc,enumerable:!0},packetsLost:{value:"number"==typeof n.packetsLost?n.packetsLost:null,enumerable:!0},codec:{value:"string"==typeof n.codecName?n.codecName:null,enumerable:!0}})}},5757:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Object.defineProperties(r,{id:{enumerable:!0,value:e},kind:{enumerable:!0,value:n}}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"stop",value:function(){this.emit("stopped")}}]),t}(n(5068).EventEmitter);e.exports=o},6921:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(963),i=n(4384),a=i.buildLogLevels,c=i.makeUUID,s=n(38),u=n(4628),l=n(9106),f=0,p={closed:[],connecting:["closed","open","waiting"],early:["closed","connecting"],open:["closed"],waiting:["closed","connecting","early","open"]},d={closed:"close",open:"open",waiting:"waiting"},h=3005,v=global.window||global,y=v.WebSocket?v.WebSocket:n(8160),m={BUSY:"busy",FAILED:"failed",LOCAL:"local",REMOTE:"remote",TIMEOUT:"timeout"},g=new Map([[3e3,m.TIMEOUT],[3001,m.TIMEOUT],[3002,m.FAILED],[3003,m.FAILED],[3004,m.TIMEOUT],[3006,m.BUSY],[3007,m.TIMEOUT]]),b=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"early",p));n=Object.assign({helloBody:null,maxConsecutiveFailedHellos:3,maxConsecutiveMissedHeartbeats:3,requestedHeartbeatTimeout:5e3,openTimeout:15e3,welcomeTimeout:5e3,Log:s,WebSocket:y},n);var o=a(n.logLevel),i=new n.Log("default",r,o,n.loggerName),c=n.networkMonitor?new u(function(){var e=c.type,t="Network changed"+(e?" to "+e:"");i.debug(t),r._close({code:3004,reason:t})}):null;Object.defineProperties(r,{_busyWaitTimeout:{value:null,writable:!0},_consecutiveHeartbeatsMissed:{value:0,writable:!0},_cookie:{value:null,writable:!0},_eventObserver:{value:n.eventObserver},_heartbeatTimeout:{value:null,writable:!0},_hellosLeft:{value:n.maxConsecutiveFailedHellos,writable:!0},_instanceId:{value:++f},_log:{value:i},_messageQueue:{value:[]},_networkMonitor:{value:c},_options:{value:n},_openTimeout:{value:null,writable:!0},_sendHeartbeatTimeout:{value:null,writable:!0},_serverUrl:{value:e},_welcomeTimeout:{value:null,writable:!0},_ws:{value:null,writable:!0}});var l={connecting:"info",early:"info",open:"info",waiting:"warning",closed:"info"};return r.on("stateChanged",function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];e in d&&r.emit.apply(r,[d[e]].concat(n));var i={name:e,group:"signaling",level:l[r.state]};if("closed"===e){var a=n[0];i.payload={reason:a},i.level=a===m.LOCAL?"info":"error"}r._eventObserver.emit("event",i)}),r._eventObserver.emit("event",{name:r.state,group:"signaling",level:l[r.state]}),r._connect(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"toString",value:function(){return"[TwilioConnection #"+this._instanceId+": "+this._ws.url+"]"}},{key:"_close",value:function(e){var t=e.code,n=e.reason;if("closed"!==this.state){this._openTimeout&&this._openTimeout.clear(),this._welcomeTimeout&&this._welcomeTimeout.clear(),this._heartbeatTimeout&&this._heartbeatTimeout.clear(),this._sendHeartbeatTimeout&&this._sendHeartbeatTimeout.clear(),this._networkMonitor&&this._networkMonitor.stop(),this._busyWaitTimeout&&t!==h&&this._busyWaitTimeout.clear(),this._messageQueue.splice(0);var r=this._log;1e3===t?(r.debug("Closed"),this.transition("closed",null,[m.LOCAL])):(r.warn("Closed: "+t+" - "+n),t!==h&&this.transition("closed",null,[g.get(t)||m.REMOTE]));var o=this._ws.readyState,i=this._options.WebSocket;o!==i.CLOSING&&o!==i.CLOSED&&this._ws.close(t,n)}}},{key:"_connect",value:function(){var e=this,t=this._log;if("waiting"===this.state)this.transition("early");else if("early"!==this.state)return void t.warn('Unexpected state "'+this.state+'" for connecting to the TCMP server.');this._ws=new this._options.WebSocket(this._serverUrl);var n=this._ws;t.debug("Created a new WebSocket:",n),n.addEventListener("close",function(t){return e._close(t)});var r=this._options.openTimeout;this._openTimeout=new l(function(){e._close({code:3007,reason:"Failed to open in "+r+" ms"})},r),n.addEventListener("open",function(){t.debug("WebSocket opened:",n),e._openTimeout.clear(),e._startHandshake(),e._networkMonitor&&e._networkMonitor.start()}),n.addEventListener("message",function(n){t.debug("Incoming: "+n.data);try{n=JSON.parse(n.data)}catch(r){return void e.emit("error",r)}switch(n.type){case"bad":e._handleBad(n);break;case"busy":e._handleBusy(n);break;case"bye":break;case"msg":e._handleMessage(n);case"heartbeat":e._handleHeartbeat();break;case"welcome":e._handleWelcome(n);break;default:e._log.debug("Unknown message type: "+n.type),e.emit("error",new Error("Unknown message type: "+n.type))}})}},{key:"_handleBad",value:function(e){var t=e.reason,n=this._log;if(["connecting","open"].includes(this.state)){if("connecting"===this.state)return n.warn("Closing: 3002 - "+t),void this._close({code:3002,reason:t});n.debug("Error: "+t),this.emit("error",new Error(t))}else n.warn('Unexpected state "'+this.state+'" for handling a "bad" message from the TCMP server.')}},{key:"_handleBusy",value:function(e){var t=this,n=e.cookie,r=e.keepAlive,o=e.retryAfter,i=this._log;if(["connecting","waiting"].includes(this.state)){this._busyWaitTimeout&&this._busyWaitTimeout.clear(),this._welcomeTimeout&&this._welcomeTimeout.clear();var a=o<0?'Received terminal "busy" message':'Received "busy" message, retrying after '+o+" ms";if(o<0)return i.warn("Closing: 3006 - "+a),void this._close({code:3006,reason:a});this._hellosLeft=this._options.maxConsecutiveFailedHellos,this._cookie=n||null,r?(i.warn(a),this._busyWaitTimeout=new l(function(){return t._startHandshake()},o)):(i.warn("Closing: 3005 - "+a),this._close({code:h,reason:a}),this._busyWaitTimeout=new l(function(){return t._connect()},o)),this.transition("waiting",null,[r,o])}else i.warn('Unexpected state "'+this.state+'" for handling a "busy" message from the TCMP server.')}},{key:"_handleHeartbeat",value:function(){"open"===this.state?this._heartbeatTimeout.reset():this._log.warn('Unexpected state "'+this.state+'" for handling a "heartbeat" message from the TCMP server.')}},{key:"_handleHeartbeatTimeout",value:function(){if("open"===this.state){var e=this._log,t=this._options.maxConsecutiveMissedHeartbeats;e.debug("Consecutive heartbeats missed: "+t);var n="Missed "+t+' "heartbeat" messages';e.warn("Closing: 3001 - "+n),this._close({code:3001,reason:n})}}},{key:"_handleMessage",value:function(e){"open"===this.state?this.emit("message",e.body):this._log.warn('Unexpected state "'+this.state+'" for handling a "msg" message from the TCMP server.')}},{key:"_handleWelcome",value:function(e){var t=this,n=e.negotiatedTimeout,r=this._log;if(["connecting","waiting"].includes(this.state)){"waiting"===this.state&&(r.debug('Received "welcome" message, no need to retry connection.'),this._busyWaitTimeout.clear());var o=n*this._options.maxConsecutiveMissedHeartbeats,i=n-200;this._welcomeTimeout.clear(),this._heartbeatTimeout=new l(function(){return t._handleHeartbeatTimeout()},o),this._messageQueue.splice(0).forEach(function(e){return t._send(e)}),this._sendHeartbeatTimeout=new l(function(){return t._sendHeartbeat()},i),this.transition("open")}else r.warn('Unexpected state "'+this.state+'" for handling a "welcome" message from the TCMP server.')}},{key:"_handleWelcomeTimeout",value:function(){if("connecting"===this.state){var e=this._log;if(this._hellosLeft<=0){var t="All handshake attempts failed";return e.warn("Closing: 3000 - "+t),void this._close({code:3e3,reason:t})}e.warn("Handshake attempt "+(this._options.maxConsecutiveFailedHellos-this._hellosLeft)+" failed"),this._startHandshake()}}},{key:"_send",value:function(e){if(this._ws.readyState===this._options.WebSocket.OPEN){var t=JSON.stringify(e);this._log.debug("Outgoing: "+t);try{this._ws.send(t),this._sendHeartbeatTimeout&&this._sendHeartbeatTimeout.reset()}catch(r){var n="Failed to send message";this._log.warn("Closing: 3003 - "+n),this._close({code:3003,reason:n})}}}},{key:"_sendHeartbeat",value:function(){"closed"!==this.state&&this._send({type:"heartbeat"})}},{key:"_sendHello",value:function(){var e=this._options,t=e.helloBody,n=e.requestedHeartbeatTimeout,r={id:c(),timeout:n,type:"hello",version:2};this._cookie&&(r.cookie=this._cookie),t&&(r.body=t),this._send(r)}},{key:"_sendOrEnqueue",value:function(e){var t=this;"closed"!==this.state&&("open"===this.state?function(e){return t._send(e)}:function(e){return t._messageQueue.push(e)})(e)}},{key:"_startHandshake",value:function(){var e=this;["early","waiting"].includes(this.state)&&this.transition("connecting"),"connecting"===this.state&&(this._hellosLeft--,this._sendHello(),this._welcomeTimeout=new l(function(){return e._handleWelcomeTimeout()},this._options.welcomeTimeout))}},{key:"close",value:function(){"closed"!==this.state&&(this._sendOrEnqueue({type:"bye"}),this._close({code:1e3,reason:"Normal"}))}},{key:"sendMessage",value:function(e){this._sendOrEnqueue({body:e,type:"msg"})}}]),t}(o);b.CloseReason=m,e.exports=b},8423:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(4384).defer,i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{_deferreds:{value:[]},_hasValue:{value:!1,writable:!0},_value:{value:null,writable:!0}})}return r(e,[{key:"put",value:function(e){this._hasValue=!0,this._value=e;var t=this._deferreds.shift();return t&&t.resolve(e),this}},{key:"take",value:function(){var e=this;if(this._hasValue&&!this._deferreds.length)return this._hasValue=!1,Promise.resolve(this._value);var t=o();return this._deferreds.push(t),t.promise.then(function(t){return e._hasValue=!1,t})}}]),e}();e.exports=i},6168:e=>{"use strict";var t=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function n(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var r=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{_isCancelable:{writable:!0,value:!0},_isCanceled:{writable:!0,value:!1},_onCancel:{value:n}}),Object.defineProperty(this,"_promise",{value:new Promise(function(e,n){t(function(t){r._isCancelable=!1,e(t)},function(e){r._isCancelable=!1,n(e)},function(){return r._isCanceled})})})}return t(e,[{key:"cancel",value:function(){return this._isCancelable&&(this._isCanceled=!0,this._onCancel()),this}},{key:"catch",value:function(){var t=[].slice.call(arguments),r=this._promise;return new e(function(e,o){r.catch.apply(r,n(t)).then(e,o)},this._onCancel)}},{key:"then",value:function(){var t=[].slice.call(arguments),r=this._promise;return new e(function(e,o){r.then.apply(r,n(t)).then(e,o)},this._onCancel)}}],[{key:"reject",value:function(t){return new e(function(e,n){n(t)},function(){})}},{key:"resolve",value:function(t){return new e(function(e){e(t)},function(){})}}]),e}();e.exports=r},2779:e=>{"use strict";e.exports.DEFAULT_ENVIRONMENT="prod",e.exports.DEFAULT_REALM="us1",e.exports.DEFAULT_REGION="gll",e.exports.DEFAULT_LOG_LEVEL="warn",e.exports.DEFAULT_LOGGER_NAME="twilio-video",e.exports.WS_SERVER=function(e,t){return t="gll"===t?"global":encodeURIComponent(t),"prod"===e?"wss://"+t+".vss.twilio.com/signaling":"wss://"+t+".vss."+e+".twilio.com/signaling"},e.exports.PUBLISH_MAX_ATTEMPTS=5,e.exports.PUBLISH_BACKOFF_JITTER=10,e.exports.PUBLISH_BACKOFF_MS=20,e.exports.typeErrors={ILLEGAL_INVOKE:function(e,t){return new TypeError("Illegal call to "+e+": "+t)},INVALID_TYPE:function(e,t){return new TypeError(e+" must be "+(["a","e","i","o","u"].includes(t.toLowerCase()[0])?"an":"a")+" "+t)},INVALID_VALUE:function(e,t){return new RangeError(e+" must be one of "+t.join(", "))},REQUIRED_ARGUMENT:function(e){return new TypeError(e+" must be specified")}},e.exports.DEFAULT_FRAME_RATE=24,e.exports.DEFAULT_VIDEO_PROCESSOR_STATS_INTERVAL_MS=1e4,e.exports.DEFAULT_ICE_GATHERING_TIMEOUT_MS=15e3,e.exports.DEFAULT_SESSION_TIMEOUT_SEC=30,e.exports.DEFAULT_NQ_LEVEL_LOCAL=1,e.exports.DEFAULT_NQ_LEVEL_REMOTE=0,e.exports.MAX_NQ_LEVEL=3,e.exports.ICE_ACTIVITY_CHECK_PERIOD_MS=1e3,e.exports.ICE_INACTIVITY_THRESHOLD_MS=3e3,e.exports.iceRestartBackoffConfig={factor:1.1,initialDelay:1,maxDelay:1e3*e.exports.DEFAULT_SESSION_TIMEOUT_SEC,randomisationFactor:.5},e.exports.reconnectBackoffConfig={factor:1.5,initialDelay:80,randomisationFactor:.5},e.exports.subscriptionMode={MODE_COLLABORATION:"collaboration",MODE_GRID:"grid",MODE_PRESENTATION:"presentation"},e.exports.trackSwitchOffMode={MODE_DISABLED:"disabled",MODE_DETECTED:"detected",MODE_PREDICTED:"predicted"},e.exports.trackPriority={PRIORITY_HIGH:"high",PRIORITY_LOW:"low",PRIORITY_STANDARD:"standard"},e.exports.clientTrackSwitchOffControl={MODE_AUTO:"auto",MODE_MANUAL:"manual"},e.exports.videoContentPreferencesMode={MODE_AUTO:"auto",MODE_MANUAL:"manual"}},6296:(e,t,n)=>{"use strict";var r=n(5369);e.exports=function(e){var t=n(3308),o={},i=t.getOrCreate(o),a=3;return function t(){return a--,r(i,e.srcObject,250).then(function(e){return!!e&&(!(a>0)||t())}).catch(function(){return!0})}().finally(function(){t.release(o)})}},5046:e=>{"use strict";var t=null;e.exports=function(e){return t=t||document.createElement("canvas"),new Promise(function(n){var r=3;setTimeout(function o(){return r--,function(e){try{var n=t.getContext("2d");n.drawImage(e,0,0,50,50);var r=n.getImageData(0,0,50,50).data.filter(function(e,t){return(t+1)%4});return 0===Math.max.apply(Math,r)}catch(o){return console.log("Error checking silence: ",o),!1}}(e)?r>0?setTimeout(o,250):n(!0):n(!1)},250)})}},418:e=>{"use strict";var t=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;n(this,e),Object.defineProperties(this,{_listeners:{value:[]},_onVisibilityChange:{value:function(){t._emitVisible("visible"===document.visibilityState)}}});for(var o=0;o<r;o++)this._listeners.push([])}return t(e,[{key:"clear",value:function(){for(var e=this._listeners.length,t=0;t<e;t++)this._listeners[t]=[]}},{key:"_listenerCount",value:function(){return this._listeners.reduce(function(e,t){return e+t.length},0)}},{key:"_emitVisible",value:function(e){for(var t=this,n=Promise.resolve(),r=function(r){n=n.then(function(){return t._emitVisiblePhase(r,e)})},o=1;o<=this._listeners.length;o++)r(o);return n}},{key:"_emitVisiblePhase",value:function(e,t){return Promise.all(this._listeners[e-1].map(function(e){var n=e(t);return n instanceof Promise?n:Promise.resolve(n)}))}},{key:"_start",value:function(){document.addEventListener("visibilitychange",this._onVisibilityChange)}},{key:"_stop",value:function(){document.removeEventListener("visibilitychange",this._onVisibilityChange)}},{key:"onVisibilityChange",value:function(e,t){if("number"!=typeof e||e<=0||e>this._listeners.length)throw new Error("invalid phase: ",e);return this._listeners[e-1].push(t),1===this._listenerCount()&&this._start(),this}},{key:"offVisibilityChange",value:function(e,t){if("number"!=typeof e||e<=0||e>this._listeners.length)throw new Error("invalid phase: ",e);var n=this._listeners[e-1],r=n.indexOf(t);return-1!==r&&(n.splice(r,1),0===this._listenerCount()&&this._stop()),this}}]),e}();e.exports=new r(2)},2955:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var a=n(5068),c=["signaling","room","media","quality","video-processor"],s=["debug","error","info","warning"],u=function(e){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;o(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Object.defineProperties(a,{_publisher:{value:null,writable:!0}}),a.on("event",function(t){var o=t.name,i=t.group,u=t.level,l=t.payload;if("string"!=typeof o)throw new Error("Unexpected name: ",o);if(!c.includes(i))throw new Error("Unexpected group: ",i);if(!s.includes(u))throw new Error("Unexpected level: ",u);var f=Date.now(),p=f-e;if(a._publisher){var d=Object.assign({elapsedTime:p,level:u},l||{});a._publisher.publish(i,o,d)}var h=Object.assign({elapsedTime:p,group:i,level:u,name:o,timestamp:f},l?{payload:l}:{});n[{debug:"debug",error:"error",info:"info",warning:"warn"}[u]]("event",h),r&&"signaling"===i&&r.emit("event",h)}),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"setPublisher",value:function(e){this._publisher=e}}]),t}(a.EventEmitter);e.exports=u},5938:e=>{"use strict";var t=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=Object.assign({getKey:function(e){return e},getValue:function(e){return e},isLessThanOrEqualTo:function(e,t){return e<=t}},t),Object.defineProperties(this,{_getKey:{value:t.getKey},_getValue:{value:t.getValue},_isLessThanOrEqualTo:{value:t.isLessThanOrEqualTo},_map:{value:new Map}})}return t(e,[{key:"toMap",value:function(){return new Map(this._map)}},{key:"updateAndFilter",value:function(e){return e.filter(this.update,this)}},{key:"update",value:function(e){var t=this._getKey(e),n=this._getValue(e);return!(this._map.has(t)&&this._isLessThanOrEqualTo(n,this._map.get(t))||(this._map.set(t,n),0))}}]),e}();e.exports=n},4384:(e,t,n)=>{"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(s){o=!0,i=s}finally{try{!r&&c.return&&c.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var u=n(2779),l=u.typeErrors,f=u.trackPriority,p=n(7454);function d(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent:"Unknown"}function h(e,t,n,o){if(!(o in t)&&!o.match(/^on[a-z]+$/)){var i=void 0;try{i=r(e[o])}catch(a){}"function"===i&&(t[o]=function(){var e;return(e=this[n])[o].apply(e,arguments)})}}function v(e){return"object"===(void 0===e?"undefined":r(e))&&!Array.isArray(e)}function y(e){Object.getOwnPropertyNames(e).forEach(function(t){t.startsWith("_")&&m(e,t)})}function m(e,t){var n=Object.getOwnPropertyDescriptor(e,t);n.enumerable=!1,Object.defineProperty(e,t,n)}function g(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];t.forEach(function(t){e.hasOwnProperty(t)&&m(e,t)})}function b(e){return e.map(_)}function _(e){return Array.isArray(e)?b(e):e instanceof Set?b([].concat(s(e))):e instanceof Map?[].concat(s(e.entries())).reduce(function(e,t){var n=o(t,2);return Object.assign(i({},n[0],_(n[1])),e)},{}):e&&"object"===(void 0===e?"undefined":r(e))?Object.entries(e).reduce(function(e,t){var n=o(t,2);return Object.assign(i({},n[0],_(n[1])),e)},{}):e}function w(e){return S(e,[{prop:"dominantSpeakerPriority",type:"string",payloadProp:"active_speaker_priority"},{prop:"maxSubscriptionBitrate",type:"number",payloadProp:"max_subscription_bandwidth"},{prop:"maxTracks",type:"number",payloadProp:"max_tracks"},{prop:"mode",type:"string"},{prop:"renderDimensions",type:"object",payloadProp:"render_dimensions",transform:O},{prop:"trackSwitchOffMode",type:"string",payloadProp:"track_switch_off"}])}function k(e){return S(e,[{prop:"height",type:"number"},{prop:"width",type:"number"}])}function O(e){return S(e,[{prop:f.PRIORITY_HIGH,type:"object",transform:k},{prop:f.PRIORITY_LOW,type:"object",transform:k},{prop:f.PRIORITY_STANDARD,type:"object",transform:k}])}function S(e,t){return t.reduce(function(t,n){var o=n.prop,a=n.type,c=n.payloadProp,s=void 0===c?o:c,u=n.transform,l=void 0===u?function(e){return e}:u;return r(e[o])===a?Object.assign(i({},s,l(e[o])),t):t},{})}t.constants=u,t.createBandwidthProfilePayload=function(e){return S(e,[{prop:"video",type:"object",transform:w}])},t.createMediaSignalingPayload=function(e,t,n,r,o){var i={transports:[{type:"data-channel"}]};return Object.assign(e?{active_speaker:i}:{},t?{network_quality:i}:{},o?{render_hints:i}:{},n?{track_priority:i}:{},r?{track_switch_off:i}:{})},t.createRoomConnectEventPayload=function(e){function t(e){return e?"true":"false"}var n={iceServers:(e.iceServers||[]).length,audioTracks:(e.tracks||[]).filter(function(e){return"audio"===e.kind}).length,videoTracks:(e.tracks||[]).filter(function(e){return"video"===e.kind}).length,dataTracks:(e.tracks||[]).filter(function(e){return"data"===e.kind}).length};if([["audio"],["automaticSubscription"],["enableDscp"],["eventListener"],["preflight"],["video"],["dominantSpeaker","enableDominantSpeaker"]].forEach(function(r){var i=o(r,2),a=i[0],c=i[1];n[c=c||a]=t(!!e[a])}),[["maxVideoBitrate"],["maxAudioBitrate"],["iceTransportPolicy"],["region"],["name","roomName"]].forEach(function(t){var r=o(t,2),i=r[0],a=r[1];a=a||i,"number"!=typeof e[i]&&"string"!=typeof e[i]||(n[a]=e[i])}),["preferredAudioCodecs","preferredVideoCodecs"].forEach(function(t){t in e&&(n[t]=JSON.stringify(e[t]))}),"networkQuality"in e&&(n.networkQualityConfiguration={},v(e.networkQuality)?["local","remote"].forEach(function(t){"number"==typeof e.networkQuality[t]&&(n.networkQualityConfiguration[t]=e.networkQuality[t])}):(n.networkQualityConfiguration.remote=0,n.networkQualityConfiguration.local=e.networkQuality?1:0)),e.bandwidthProfile&&e.bandwidthProfile.video){var i=e.bandwidthProfile.video||{};n.bandwidthProfileOptions={},["mode","maxTracks","trackSwitchOffMode","dominantSpeakerPriority","maxSubscriptionBitrate","renderDimensions","contentPreferencesMode","clientTrackSwitchOffControl"].forEach(function(e){"number"==typeof i[e]||"string"==typeof i[e]?n.bandwidthProfileOptions[e]=i[e]:"boolean"==typeof i[e]?n.bandwidthProfileOptions[e]=t(i[e]):"object"===r(i[e])&&(n.bandwidthProfileOptions[e]=JSON.stringify(i[e]))})}return{group:"room",name:"connect",level:"info",payload:n}},t.createSubscribePayload=function(e){return{rules:[{type:e?"include":"exclude",all:!0}],revision:1}},t.asLocalTrack=function(e,t){if(e instanceof t.LocalAudioTrack||e instanceof t.LocalVideoTrack||e instanceof t.LocalDataTrack)return e;if(e instanceof t.MediaStreamTrack)return"audio"===e.kind?new t.LocalAudioTrack(e,t):new t.LocalVideoTrack(e,t);throw l.INVALID_TYPE("track","LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack")},t.asLocalTrackPublication=function(e,t,n,r){return new(0,{audio:r.LocalAudioTrackPublication,video:r.LocalVideoTrackPublication,data:r.LocalDataTrackPublication}[e.kind])(t,e,n,r)},t.capitalize=function(e){return e[0].toUpperCase()+e.slice(1)},t.deprecateEvents=function(e,t,n,r){var o=new Set;t.on("newListener",function i(a){n.has(a)&&!o.has(a)&&(r.deprecated(e+"#"+a+" has been deprecated and scheduled for removal in twilio-video.js@2.0.0."+(n.get(a)?" Use "+e+"#"+n.get(a)+" instead.":"")),o.add(a)),o.size>=n.size&&t.removeListener("newListener",i)})},t.difference=function(e,t){e=Array.isArray(e)?new Set(e):new Set(e.values()),t=Array.isArray(t)?new Set(t):new Set(t.values());var n=new Set;return e.forEach(function(e){t.has(e)||n.add(e)}),n},t.filterObject=function(e,t){return Object.keys(e).reduce(function(n,r){return e[r]!==t&&(n[r]=e[r]),n},{})},t.flatMap=function(e,t){var n=e instanceof Map||e instanceof Set?Array.from(e.values()):e;return t=t||function(e){return e},n.reduce(function(e,n){var r=t(n);return e.concat(r)},[])},t.getPlatform=function(){var e=d().match(/\(([^)]+)\)/)||[],t=o(e,2)[1],n=(void 0===t?"unknown":t).split(";").map(function(e){return e.trim()});return o(n,1)[0].toLowerCase()},t.getUserAgent=d,t.hidePrivateProperties=y,t.hidePrivateAndCertainPublicPropertiesInClass=function(e,t){return function(e){function n(){var e;a(this,n);for(var r=arguments.length,o=Array(r),i=0;i<r;i++)o[i]=arguments[i];var s=c(this,(e=n.__proto__||Object.getPrototypeOf(n)).call.apply(e,[this].concat(o)));return y(s),g(s,t),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,e),n}(e)},t.isDeepEqual=function e(t,n){if(t===n)return!0;if((void 0===t?"undefined":r(t))!==(void 0===n?"undefined":r(n)))return!1;if(null===t)return null===n;if(null===n)return!1;if(Array.isArray(t))return Array.isArray(n)&&t.length===n.length&&t.every(function(t,r){return e(t,n[r])});if("object"===(void 0===t?"undefined":r(t))){var o=Object.keys(t).sort(),i=Object.keys(n).sort();return!Array.isArray(n)&&e(o,i)&&o.every(function(r){return e(t[r],n[r])})}return!1},t.isNonArrayObject=v,t.inRange=function(e,t,n){return t<=e&&e<=n},t.makeUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},t.oncePerTick=function(e){var t=null;function n(){t=null,e()}return function(){t&&clearTimeout(t),t=setTimeout(n)}},t.promiseFromEvents=function(e,t,n,r){return new Promise(function(o,i){function a(){var e=[].slice.call(arguments);r&&t.removeListener(r,c),o.apply(void 0,s(e))}function c(){var e=[].slice.call(arguments);t.removeListener(n,a),i.apply(void 0,s(e))}t.once(n,a),r&&t.once(r,c),e()})},t.getOrNull=function(e,t){return t.split(".").reduce(function(e,t){return e?e[t]:null},e)},t.defer=function(){var e={};return e.promise=new Promise(function(t,n){e.resolve=t,e.reject=n}),e},t.delegateMethods=function(e,t,n){for(var r in e)h(e,t,n,r)},t.proxyProperties=function(e,t,n){Object.getOwnPropertyNames(e).forEach(function(e){!function(e,t,n,r){r in t||(r.match(/^on[a-z]+$/)?(Object.defineProperty(t,r,{value:null,writable:!0}),n.addEventListener(r.slice(2),function(){t.dispatchEvent.apply(t,arguments)})):Object.defineProperty(t,r,{enumerable:!0,get:function(){return n[r]}}))}(0,t,n,e)})},t.legacyPromise=function(e,t,n){return t?e.then(function(e){t(e)},function(e){n(e)}):e},t.buildLogLevels=function(e){return"string"==typeof e?{default:e,media:e,signaling:e,webrtc:e}:e},t.trackClass=function(e,t){return(t=t?"Local":"")+(e.kind||"").replace(/\w{1}/,function(e){return e.toUpperCase()})+"Track"},t.trackPublicationClass=function(e,t){return(t=t?"Local":"")+(e.kind||"").replace(/\w{1}/,function(e){return e.toUpperCase()})+"TrackPublication"},t.valueToJSON=_,t.withJitter=function(e,t){var n=Math.random();return e-t+Math.floor(2*t*n+.5)},t.isChromeScreenShareTrack=function(e){return"chrome"===p.guessBrowser()&&"video"===e.kind&&e.label&&(/^screen:[0-9]+/.test(e.label)||/^web-contents-media-stream:[0-9/]+/.test(e.label)||/^window:[0-9]+/.test(e.label))},t.waitForSometime=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return new Promise(function(t){return setTimeout(t,e)})},t.waitForEvent=function(e,t){return new Promise(function(n){e.addEventListener(t,function r(o){e.removeEventListener(t,r),n(o)})})}},3518:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(5068).EventEmitter,i=n(4384).getUserAgent,a=global.window||global,c=a.WebSocket?a.WebSocket:n(8160),s=n(4384),u=function(e){function t(e,n,r,o,a,u){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var p=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return u=Object.assign({gateway:f(o,a)+"/v1/VideoEvents",maxReconnectAttempts:5,reconnectIntervalMs:50,userAgent:i(),WebSocket:c},u),Object.defineProperties(p,{_connectTimestamp:{value:0,writable:!0},_eventQueue:{value:[]},_readyToConnect:{value:s.defer()},_reconnectAttemptsLeft:{value:u.maxReconnectAttempts,writable:!0},_ws:{value:null,writable:!0},_WebSocket:{value:u.WebSocket}}),p._readyToConnect.promise.then(function(t){var o=t.roomSid,i=t.participantSid,a=p;p.on("disconnected",function t(c){if(a._session=null,c&&a._reconnectAttemptsLeft>0)return a.emit("reconnecting"),void function(e,t,n,r,o,i,a){var c=Date.now()-e._connectTimestamp,s=a.reconnectIntervalMs-c;s>0?setTimeout(function(){l(e,t,n,r,o,i,a)},s):l(e,t,n,r,o,i,a)}(a,e,n,r,o,i,u);a.removeListener("disconnected",t)}),l(p,e,n,r,o,i,u)}).catch(function(){}),p}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"connect",value:function(e,t){this._readyToConnect.resolve({roomSid:e,participantSid:t})}},{key:"_publish",value:function(e){e.session=this._session,this._ws.send(JSON.stringify(e))}},{key:"disconnect",value:function(){if(null===this._ws||this._ws.readyState===this._WebSocket.CLOSING||this._ws.readyState===this._WebSocket.CLOSED)return!1;try{this._ws.close()}catch(e){}return this.emit("disconnected"),!0}},{key:"publish",value:function(e,t,n){return(null===this._ws||this._ws.readyState!==this._WebSocket.CLOSING&&this._ws.readyState!==this._WebSocket.CLOSED)&&(("string"==typeof this._session?this._publish.bind(this):this._eventQueue.push.bind(this._eventQueue))({group:e,name:t,payload:n,timestamp:Date.now(),type:"event",version:1}),!0)}}]),t}(o);function l(e,t,n,r,o,i,a){e._connectTimestamp=Date.now(),e._reconnectAttemptsLeft--,e._ws=new a.WebSocket(a.gateway);var c=e._ws;c.addEventListener("close",function(t){1e3!==t.code?e.emit("disconnected",new Error("WebSocket Error "+t.code+": "+t.reason)):e.emit("disconnected")}),c.addEventListener("message",function(t){!function(e,t,n){switch(t.type){case"connected":e._session=t.session,e._reconnectAttemptsLeft=n.maxReconnectAttempts,e._eventQueue.splice(0).forEach(e._publish,e),e.emit("connected");break;case"error":e._ws.close(),e.emit("disconnected",new Error(t.message))}}(e,JSON.parse(t.data),a)}),c.addEventListener("open",function(){var e={type:"connect",token:t,version:1};e.publisher={name:n,sdkVersion:r,userAgent:a.userAgent,participantSid:i,roomSid:o},c.send(JSON.stringify(e))})}function f(e,t){return"prod"===e?"wss://sdkgw."+t+".twilio.com":"wss://sdkgw."+e+"-"+t+".twilio.com"}e.exports=u},8488:e=>{"use strict";var t=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{_connected:{writable:!0,value:!0}})}return t(e,[{key:"connect",value:function(){}},{key:"disconnect",value:function(){return!!this._connected&&(this._connected=!1,!0)}},{key:"publish",value:function(){return this._connected}}]),e}();e.exports=n},9076:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(4384).defer,i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{_audio:{value:o(),writable:!0},_video:{value:o(),writable:!0}}),this._audio.resolve(),this._video.resolve()}return r(e,[{key:"resolveDeferred",value:function(e){"audio"===e?this._audio.resolve():this._video.resolve()}},{key:"startDeferred",value:function(e){"audio"===e?this._audio=o():this._video=o()}},{key:"whenResolved",value:function(e){return"audio"===e?this._audio.promise:this._video.promise}}]),e}();e.exports=new i},38:(e,t,n)=>{"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(3649).getLogger,a=n(2779),c=a.DEFAULT_LOG_LEVEL,s=a.DEFAULT_LOGGER_NAME,u=n(2779).typeErrors,l=void 0,f=function(){function e(t,n,o,a,l){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"string"!=typeof t)throw u.INVALID_TYPE("moduleName","string");if(!n)throw u.REQUIRED_ARGUMENT("component");"object"!==(void 0===o?"undefined":r(o))&&(o={}),l=l||i,y(o),Object.defineProperties(this,{_component:{value:n},_logLevels:{value:o},_warnings:{value:new Set},_loggerName:{get:function(){var e=a&&"string"==typeof a?a:s;return this._logLevelsEqual||(e=e+"-"+t),e}},_logger:{get:function(){var e=l(this._loggerName),n=this._logLevels[t]||c;return e.setDefaultLevel(n="off"===n?"silent":n),e}},_logLevelsEqual:{get:function(){return 1===new Set(Object.values(this._logLevels)).size}},logLevel:{get:function(){return e.getLevelByName(o[t]||c)}},name:{get:n.toString.bind(n)}})}return o(e,[{key:"createLog",value:function(t,n){var r=this._loggerName;return this._logLevelsEqual||(r=r.substring(0,r.lastIndexOf("-"))),new e(t,n,this._logLevels,r)}},{key:"setLevels",value:function(e){return y(e),Object.assign(this._logLevels,e),this}},{key:"log",value:function(t,n){var r=e._levels[t];if(!r)throw u.INVALID_VALUE("logLevel",d);r=r.toLowerCase();var o=[(new Date).toISOString(),r,this.name];return(this._logger[r]||function(){}).apply(void 0,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(o.concat(n))),this}},{key:"debug",value:function(){return this.log(e.DEBUG,[].slice.call(arguments))}},{key:"deprecated",value:function(e){var t=function(e){if((l=l||new Map).has(e))return l.get(e);var t=new Set;return l.set(e,t),t}(this._component.constructor);return t.has(e)?this:(t.add(e),this.warn(e))}},{key:"info",value:function(){return this.log(e.INFO,[].slice.call(arguments))}},{key:"warn",value:function(){return this.log(e.WARN,[].slice.call(arguments))}},{key:"warnOnce",value:function(e){return this._warnings.has(e)?this:(this._warnings.add(e),this.warn(e))}},{key:"error",value:function(){return this.log(e.ERROR,[].slice.call(arguments))}},{key:"throw",value:function(t,n){throw t.clone&&(t=t.clone(n)),this.log(e.ERROR,t),t}}],[{key:"getLevelByName",value:function(t){return isNaN(t)?(v(t=t.toUpperCase()),e[t]):parseInt(t,10)}}]),e}();Object.defineProperties(f,{DEBUG:{value:0},INFO:{value:1},WARN:{value:2},ERROR:{value:3},OFF:{value:4},_levels:{value:["DEBUG","INFO","WARN","ERROR","OFF"]}});var p={},d=[],h=f._levels.map(function(e,t){return p[e]=!0,d.push(t),e});function v(e){if(!(e in p))throw u.INVALID_VALUE("level",h)}function y(e){Object.keys(e).forEach(function(t){v(e[t].toUpperCase())})}e.exports=f},4040:e=>{"use strict";var t=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{_samples:{value:[{denominator:0,numerator:0},{denominator:0,numerator:0}]}})}return t(e,[{key:"get",value:function(){var e=this._samples;return Math.round((e[1].numerator-e[0].numerator)/(e[1].denominator-e[0].denominator||1/0))}},{key:"putSample",value:function(e,t){var n=this._samples;n.shift(),n.push({denominator:t,numerator:e})}}]),e}();e.exports=n},4628:e=>{"use strict";var t=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),n=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var o=(n=Object.assign({navigator:navigator,window:window},n)).navigator,i=o.connection||{type:null},a=i.type,c=i.type?{_events:{value:["change","typechange"]},_listener:{value:function(){var e=a!==r.type&&r.isOnline;a=r.type,e&&t()}},_target:{value:i}}:{_events:{value:["online"]},_listener:{value:t},_target:{value:n.window}};Object.defineProperties(this,{isOnline:{enumerable:!0,get:function(){return"boolean"!=typeof o.onLine||o.onLine}},type:{enumerable:!0,get:function(){return i.type||null}},_listener:c._listener,_events:c._events,_target:c._target})}return t(e,[{key:"start",value:function(){var e=this;this._events.forEach(function(t){e._target.addEventListener(t,e._listener)})}},{key:"stop",value:function(){var e=this;this._events.forEach(function(t){e._target.removeEventListener(t,e._listener)})}}]),e}();e.exports=n},1118:e=>{"use strict";var t=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(t){o(this,e),Object.defineProperties(this,{_callback:{value:t}})}return t(e,[{key:"observe",value:function(){}},{key:"unobserve",value:function(){}},{key:"makeVisible",value:function(e){var t=this._makeFakeEntry(e,!0);this._callback([t])}},{key:"makeInvisible",value:function(e){var t=this._makeFakeEntry(e,!1);this._callback([t])}},{key:"_makeFakeEntry",value:function(e,t){return{target:e,isIntersecting:t}}}]),e}(),a=function(e){function t(){return o(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),t}(i),c=function(e){function i(){return o(this,i),n(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments))}return r(i,e),t(i,[{key:"resize",value:function(e){var t=this._makeFakeEntry(e,!0);this._callback([t])}}]),i}(i);e.exports={NullIntersectionObserver:a,NullResizeObserver:c,NullObserver:i}},4869:(e,t,n)=>{"use strict";var r=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(s){o=!0,i=s}finally{try{!r&&c.return&&c.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=n(4384),i=o.difference,a=o.flatMap,c=n(7229),s={0:"PCMU",8:"PCMA"};function u(e,t){return t?"\r\nb="+e+":"+("AS"===e?Math.round((t+16e3)/950):t):null}function l(e){return Array.from(p(e)).reduce(function(e,t){var n=t[0],r=t[1],o=e.get(r)||[];return e.set(r,o.concat(n))},new Map)}function f(e){return v(e).reduce(function(e,t){var n=h(t);return n?e.set(n,t):e},new Map)}function p(e){return y(e).reduce(function(t,n){var r=new RegExp("a=rtpmap:"+n+" ([^/]+)"),o=e.match(r),i=o?o[1].toLowerCase():s[n]?s[n].toLowerCase():"";return t.set(n,i)},new Map)}function d(e,t){var n=new RegExp("^a=fmtp:"+e+" (.+)$","m"),o=t.match(n);return o&&o[1].split(";").reduce(function(e,t){var n=t.split("="),o=r(n,2),i=o[1];return e[o[0]]=isNaN(i)?i:parseInt(i,10),e},{})}function h(e){var t=e.match(/^a=mid:(.+)$/m);return t&&t[1]}function v(e,t,n){return e.replace(/\r\n\r\n$/,"\r\n").split("\r\nm=").slice(1).map(function(e){return"m="+e}).filter(function(e){var r=new RegExp("m="+(t||".*"),"gm"),o=new RegExp("a="+(n||".*"),"gm");return r.test(e)&&o.test(e)})}function y(e){var t=e.split("\r\n")[0].match(/([0-9]+)/g);return t?t.slice(1).map(function(e){return parseInt(e,10)}):[]}function m(e,t){var n=t.split("\r\n"),r=n[0],o=n.slice(1);return[r=r.replace(/([0-9]+\s?)+$/,e.join(" "))].concat(o).join("\r\n")}function g(e,t){var n=v(e);return[e.split("\r\nm=")[0]].concat(n.map(function(e){if(!/^m=(audio|video)/.test(e))return e;var n=h(e);if(!n)return e;var o=t.get(n);if(!o)return e;var i=(e.match(/^a=msid:(.+)$/m)||[])[1];if(!i)return e;var a=i.split(" "),c=r(a,2),s=c[0],u=c[1],l=new RegExp("msid:"+s+(u?" "+u:"")+"$","gm");return e.replace(l,"msid:"+s+" "+o)})).join("\r\n")}function b(e,t){return"a=fmtp:"+e+" "+Object.entries(t).map(function(e){var t=r(e,2);return t[0]+"="+t[1]}).join(";")}t.createCodecMapForMediaSection=l,t.createPtToCodecName=p,t.disableRtx=function(e){var t=v(e);return[e.split("\r\nm=")[0]].concat(t.map(function(e){if(!/^m=video/.test(e))return e;var t=l(e).get("rtx");if(!t)return e;var n=new Set(y(e));t.forEach(function(e){return n.delete(e)});var r=e.match(/a=ssrc-group:FID [0-9]+ ([0-9]+)/),o=r&&r[1],i=[/^a=fmtp:.+ apt=.+$/,/^a=rtpmap:.+ rtx\/.+$/,/^a=ssrc-group:.+$/].concat(o?[new RegExp("^a=ssrc:"+o+" .+$")]:[]);return e=e.split("\r\n").filter(function(e){return i.every(function(t){return!t.test(e)})}).join("\r\n"),m(Array.from(n),e)})).join("\r\n")},t.enableDtxForOpus=function(e,t){var n=v(e),r=e.split("\r\nm=")[0];return t=t||n.filter(function(e){return/^m=audio/.test(e)}).map(h),[r].concat(n.map(function(e){if(!/^m=audio/.test(e))return e;var n=l(e).get("opus");if(!n)return e;var r=d(n,e);if(!r)return e;var o=b(n,r),i=new RegExp(o),a=h(e);t.includes(a)?r.usedtx=1:delete r.usedtx;var c=b(n,r);return e.replace(i,c)})).join("\r\n")},t.getMediaSections=v,t.removeSSRCAttributes=function(e,t){return e.split("\r\n").filter(function(e){return!t.find(function(t){return new RegExp("a=ssrc:.*"+t+":","g").test(e)})}).join("\r\n")},t.revertSimulcastForNonVP8MediaSections=function(e,t,n){var r=f(n),o=f(t),i=v(e);return[e.split("\r\nm=")[0]].concat(i.map(function(e){if(e=e.replace(/\r\n$/,""),!/^m=video/.test(e))return e;var t=e.match(/^a=mid:(.+)$/m),n=t&&t[1];if(!n)return e;var i=r.get(n),a=p(i),c=y(i);return c.length&&"vp8"===a.get(c[0])?e:o.get(n).replace(/\r\n$/,"")})).concat("").join("\r\n")},t.setBitrateParameters=function(e,t,n,r){var o=v(e);return[e.split("\r\nm=")[0]].concat(o.map(function(e){if(!/^m=(audio|video)/.test(e)||!/a=(recvonly|sendrecv)/.test(e))return e;var o=e.match(/^m=(audio|video)/)[1];return function(e,t,n){var r=u(e,t)||"",o=/\r\nb=(AS|TIAS):([0-9]+)/,i=n.match(o);if(!i)return n.replace(/(\r\n)?$/,r+"$1");var a=parseInt(i[2],10);return t=t||1/0,r=u(e,Math.min(a,t)),n.replace(o,r)}(t,"audio"===o?n:r,e)})).join("\r\n")},t.setCodecPreferences=function(e,t,n){var r=v(e);return[e.split("\r\nm=")[0]].concat(r.map(function(e){if(!/^m=(audio|video)/.test(e))return e;var r=e.match(/^m=(audio|video)/)[1],o=l(e),c=function(e,t){t=t.map(function(e){return e.codec.toLowerCase()});var n=a(t,function(t){return e.get(t)||[]}),r=i(Array.from(e.keys()),t),o=a(r,function(t){return e.get(t)});return n.concat(o)}(o,"audio"===r?t:n),s=m(c,e),u=o.get("pcma")||[],f=o.get("pcmu")||[];return("audio"===r?new Set(u.concat(f)):new Set).has(c[0])?s.replace(/\r\nb=(AS|TIAS):([0-9]+)/g,""):s})).join("\r\n")},t.setSimulcast=function(e,t,n){var r=v(e);return[e.split("\r\nm=")[0]].concat(r.map(function(e){if(e=e.replace(/\r\n$/,""),!/^m=video/.test(e))return e;var r=l(e),o=y(e),i=new Set(r.get("vp8")||[]);return o.some(function(e){return i.has(e)})?c(e,t,n):e})).concat("").join("\r\n")},t.unifiedPlanFilterLocalCodecs=function(e,t){var n=v(e),o=e.split("\r\nm=")[0],i=f(t);return[o].concat(n.map(function(e){return function(e,t,n){if(!/^m=(audio|video)/.test(e))return e;var o=h(e),i=o&&t.get(o);if(!i)return e;var c=p(i),s=l(e),u=a(Array.from(c),function(t){var o=r(t,2),a=o[0],c=o[1];return"rtx"===c||n.includes(c)?[]:function(e,t,n,r,o){var i=n.get(e)||[];if(i.length<=1)return i;var a=d(t,o);if(!a)return i;var c=i.find(function(e){var t=d(e,r);return t&&Object.keys(a).every(function(e){return a[e]===t[e]})});return"number"==typeof c?[c]:i}(c,a,s,e,i)}),f=s.get("rtx")||[];u=u.concat(f.filter(function(t){var n=d(t,e);return n&&u.includes(n.apt)}));var v=e.split("\r\n").filter(function(e){var t=e.match(/^a=(rtpmap|fmtp|rtcp-fb):(.+) .+$/),n=t&&t[2];return!t||n&&u.includes(parseInt(n,10))});return m(y(e).filter(function(e){return u.includes(e)}),v.join("\r\n"))}(e,i,[])})).join("\r\n")},t.unifiedPlanAddOrRewriteNewTrackIds=function(e,t,n){var o=Array.from(n).reduce(function(n,o){var i=r(o,2),a=i[1];return v(e,i[0],"send(only|recv)").map(h).filter(function(e){return!t.has(e)}).forEach(function(e,t){return n.set(e,a[t])}),n},new Map);return g(e,o)},t.unifiedPlanAddOrRewriteTrackIds=g},1651:(e,t,n)=>{"use strict";var r=n(3738).RTCSessionDescription,o=n(4869).createPtToCodecName,i=n(4869).getMediaSections;function a(e){var t=o(e);e=function(e,t){return Array.from(t.keys()).reduce(function(e,n){var r=new RegExp("^a=rtpmap:"+n+" rtx.+$","gm");return(e.match(r)||[]).slice("rtx"===t.get(n)?1:0).reduce(function(e,t){var r=new RegExp("\r\n"+t),o=new RegExp("\r\na=fmtp:"+n+" apt=[0-9]+");return e.replace(r,"").replace(o,"")},e)},e)}(e,t);var n=function(e){var t=new Map;return e.forEach(function(e,n){var r=t.get(e)||new Set;return t.set(e,r.add(n))}),t}(t),r=n.get("rtx")||new Set,i=new Set,a=function(e,t){var n=Array.from(e).reduce(function(e,t){var n=t[0],r=t[1],o=e.get(r)||new Set;return e.set(r,o.add(n))},new Map);return Array.from(n).reduce(function(e,n){var r=n[0],o=Array.from(n[1]);return o.length>1?(o.forEach(function(e){t.add(e)}),e):e.set(r,o[0])},new Map)}(function(e,t,n,r){return Array.from(n).reduce(function(n,o){var i=new RegExp("a=fmtp:"+o+" apt=(\\d+)"),a=e.match(i);if(!a)return r.add(o),n;var c=Number.parseInt(a[1]);return t.has(c)?"rtx"===t.get(c)?(r.add(o),n):n.set(o,c):(r.add(o),n)},new Map)}(e,t,r,i),i),s=Array.from(i);return["h264","vp8","vp9"].reduce(function(e,t){var r=n.get(t)||new Set;return Array.from(r).reduce(function(e,t){return a.has(t)?e:e.add(t)},e)},new Set).forEach(function(t){if(s.length){var n=s.shift();e=function(e,t,n){return e.endsWith("\r\n")?e+"a=fmtp:"+t+" apt="+n+"\r\n":e+"\r\na=fmtp:"+t+" apt="+n}(e=c(e,n),n,t)}}),s.forEach(function(t){e=function(e,t){var n=new RegExp("a=rtpmap:"+t+".*\r\n","gm");return e.replace(n,"")}(e=c(e,t),t)}),e}function c(e,t){var n=new RegExp("a=fmtp:"+t+".*\r\n","gm");return e.replace(n,"")}e.exports=function(e){var t,n,o={type:e.type};return"rollback"!==e.type&&(o.sdp=(n=i(t=e.sdp),[t.split("\r\nm=")[0]].concat(n.map(a)).join("\r\n"))),new r(o)}},7229:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(4384).difference,i=n(4384).flatMap;function a(){return String(Math.floor(4294967295*Math.random()))}var c=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{cName:{enumerable:!0,value:r},isSimulcastEnabled:{enumerable:!0,value:!1,writable:!0},primarySSRCs:{enumerable:!0,value:new Set},rtxPairs:{enumerable:!0,value:new Map},streamId:{enumerable:!0,value:n},trackId:{enumerable:!0,value:t}})}return r(e,[{key:"addSimulcastSSRCs",value:function(){if(!this.isSimulcastEnabled){var e=[a(),a()];e.forEach(function(e){this.primarySSRCs.add(e)},this),this.rtxPairs.size&&e.forEach(function(e){this.rtxPairs.set(a(),e)},this)}}},{key:"addSSRC",value:function(e,t,n){t?this.rtxPairs.set(e,t):this.primarySSRCs.add(e),this.isSimulcastEnabled=this.isSimulcastEnabled||n}},{key:"toSdpLines",value:function(e){var t=this,n=e?[]:Array.from(this.rtxPairs.entries()).map(function(e){return e.reverse()}),r=Array.from(this.primarySSRCs.values()),o=n.length?i(n):r,a=i(o,function(e){return["a=ssrc:"+e+" cname:"+t.cName,"a=ssrc:"+e+" msid:"+t.streamId+" "+t.trackId]}),c=n.map(function(e){return"a=ssrc-group:FID "+e.join(" ")}),s=["a=ssrc-group:SIM "+r.join(" ")];return c.concat(a).concat(s)}}]),e}();function s(e,t){return(e.match(new RegExp(t,"gm"))||[]).map(function(e){return(e.match(new RegExp(t))||[]).slice(1)})}function u(e){return s(e,"^a=ssrc:([0-9]+) msid:([^\\s]+) ([^\\s]+)$")}function l(e){var t=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),2!==n.length);r=!0);}catch(s){o=!0,i=s}finally{try{!r&&c.return&&c.return()}finally{if(o)throw i}}return n}(e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}(i(s(e,"^a=msid:(.+) (.+)$"))),n=t[0],r=t[1];return i(s(e,"^a=ssrc:(.+) cname:.+$")).map(function(e){return[e,n,r]})}e.exports=function(e,t,n){var r=function(e,t){var n=function(e){return new Set(i(s(e,"^a=ssrc-group:SIM ([0-9]+) ([0-9]+) ([0-9]+)$")))}(e),r=function(e){return new Map(s(e,"^a=ssrc-group:FID ([0-9]+) ([0-9]+)$").map(function(e){return e.reverse()}))}(e);return function(e,t){return{planb:u,unified:l}[t](e)}(e,t).reduce(function(t,o){var i=o[0],a=o[1],s=o[2],u=t.get(s)||new c(s,a,function(e,t,n){return e.match(new RegExp("a=ssrc:"+t+" cname:(.+)"))[1]}(e,i)),l=r.get(i)||null;return u.addSSRC(i,l,n.has(i)),t.set(s,u)},new Map)}(e,t),a=Array.from(r.keys()),f=Array.from(n.keys()),p=o(a,f),d=o(f,a);i(p,function(e){return r.get(e)}).forEach(function(e){e.addSimulcastSSRCs(),n.set(e.trackId,e)}),f=Array.from(n.keys());var h=o(f,d),v=i(h,function(e){return n.get(e)}),y=!e.match(/a=rtpmap:[0-9]+ rtx/),m=i(v,function(e){return e.toSdpLines(y)}),g=i(new Set(e.split("\r\n").concat(m))),b="a=x-google-flag:conference";return e.match(b)||g.push(b),g.join("\r\n")}},204:e=>{"use strict";var t=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return t(e,[{key:"match",value:function(e){return e.track.id}},{key:"update",value:function(){}}]),e}();e.exports=n},9667:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(4869).getMediaSections,i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperties(this,{_midsToTrackIds:{value:new Map,writable:!0}})}return r(e,[{key:"match",value:function(e){return this._midsToTrackIds.get(e.transceiver.mid)||null}},{key:"update",value:function(e){var t=o(e,"(audio|video)");this._midsToTrackIds=t.reduce(function(e,t){var n=t.match(/^a=mid:(.+)$/m)||[],r=t.match(/^a=msid:.+ (.+)$/m)||[],o=n[1],i=r[1];return o&&i?e.set(o,i):e},this._midsToTrackIds)}}]),e}();e.exports=i},8345:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(4384),i=n(4869).getMediaSections;function a(){return{matched:new Set,unmatched:new Set}}var c=function(){function e(){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!(this instanceof e))return new e;Object.defineProperties(this,{audio:{enumerable:!0,value:a()},video:{enumerable:!0,value:a()}})}return r(e,[{key:"match",value:function(e){return function(e){var t=Array.from(e.unmatched);if(!t.length)return null;var n=t[0];return e.matched.add(n),e.unmatched.delete(n),n}(this[e.track.kind])}},{key:"update",value:function(e){["audio","video"].forEach(function(t){var n,r;n=this[t],r=function(e,t){var n=i(t,e),r="msid: ?(.+) +(.+) ?$";return new Set(o.flatMap(n,function(e){return e.match(new RegExp(r,"mg"))||[]}).map(function(e){return e.match(new RegExp(r))[2]}))}(t,e),r=new Set(r),o.difference(n.matched,r).forEach(n.matched.delete,n.matched),n.unmatched=o.difference(r,n.matched)},this)}}]),e}();e.exports=c},7925:(e,t,n)=>{"use strict";var r=n(7454),o=r.guessBrowser,i=r.support,a=["edg","edge","electron","headlesschrome"],c=["chrome","firefox"],s=["safari"],u=[];e.exports=function(){var e,t=o(),n=function(e){return"chrome"!==e?null:"brave"in navigator?"brave":(t=(function(e){for(var t=[],n=[],r=0;r<e.length;r++)if("("===e[r])t.push(r);else if(")"===e[r]&&t.length>0){var o=t.pop();0===t.length&&n.push(e.substring(o,r+1))}return n}(navigator.userAgent).reduce(function(e,t){return e.replace(t,"")},navigator.userAgent).match(/[^\s]+/g)||[]).map(function(e){return e.split("/")[0].toLowerCase()}),Array.isArray(t)?t:Array.from(t)).slice(2).find(function(e){return!["chrome","mobile","safari"].includes(e)})||null;var t}(t),r=function(e){return"safari"!==e?null:"brave"in navigator?"brave":["edge","edg"].find(function(e){return navigator.userAgent.toLowerCase().includes(e)})||null}(t),l=/android/.test(navigator.userAgent.toLowerCase())?c:s;return!!t&&i()&&(!n||a.includes(n))&&!function(e){return"chrome"===e&&/Edge/.test(navigator.userAgent)&&("undefined"==typeof chrome||void 0===chrome.runtime)}(t)&&(!r||u.includes(r))&&(e=e||navigator.userAgent,!/Mobi/.test(e)||l.includes(t))}},9106:e=>{"use strict";var t=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(t,r){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];n(this,e),Object.defineProperties(this,{_delay:{value:r,writable:!0},_fn:{value:t},_timeout:{value:null,writable:!0}}),o&&this.start()}return t(e,[{key:"setDelay",value:function(e){this._delay=e}},{key:"start",value:function(){var e=this;this.isSet||(this._timeout=setTimeout(function(){var t=e._fn;e.clear(),t()},this._delay))}},{key:"clear",value:function(){clearTimeout(this._timeout),this._timeout=null}},{key:"reset",value:function(){this.clear(),this.start()}},{key:"delay",get:function(){return this._delay}},{key:"isSet",get:function(){return!!this._timeout}}]),e}();e.exports=r},450:(e,t,n)=>{"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(6294),c={};t.createTwilioError=function(e,t){return t="string"==typeof t&&t?t:"Unknown error",c[e="number"==typeof e?e:0]?new c[e]:new a(e,t)};var s=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,20101,"Invalid Access Token"))}return i(t,e),t}(a);t.AccessTokenInvalidError=s,Object.defineProperty(c,20101,{value:s});var u=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,20102,"Invalid Access Token header"))}return i(t,e),t}(a);t.AccessTokenHeaderInvalidError=u,Object.defineProperty(c,20102,{value:u});var l=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,20103,"Invalid Access Token issuer/subject"))}return i(t,e),t}(a);t.AccessTokenIssuerInvalidError=l,Object.defineProperty(c,20103,{value:l});var f=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,20104,"Access Token expired or expiration date invalid"))}return i(t,e),t}(a);t.AccessTokenExpiredError=f,Object.defineProperty(c,20104,{value:f});var p=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,20105,"Access Token not yet valid"))}return i(t,e),t}(a);t.AccessTokenNotYetValidError=p,Object.defineProperty(c,20105,{value:p});var d=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,20106,"Invalid Access Token grants"))}return i(t,e),t}(a);t.AccessTokenGrantsInvalidError=d,Object.defineProperty(c,20106,{value:d});var h=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,20107,"Invalid Access Token signature"))}return i(t,e),t}(a);t.AccessTokenSignatureInvalidError=h,Object.defineProperty(c,20107,{value:h});var v=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53e3,"Signaling connection error"))}return i(t,e),t}(a);t.SignalingConnectionError=v,Object.defineProperty(c,53e3,{value:v});var y=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53001,"Signaling connection disconnected"))}return i(t,e),t}(a);t.SignalingConnectionDisconnectedError=y,Object.defineProperty(c,53001,{value:y});var m=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53002,"Signaling connection timed out"))}return i(t,e),t}(a);t.SignalingConnectionTimeoutError=m,Object.defineProperty(c,53002,{value:m});var g=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53003,"Client received an invalid signaling message"))}return i(t,e),t}(a);t.SignalingIncomingMessageInvalidError=g,Object.defineProperty(c,53003,{value:g});var b=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53004,"Client sent an invalid signaling message"))}return i(t,e),t}(a);t.SignalingOutgoingMessageInvalidError=b,Object.defineProperty(c,53004,{value:b});var _=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53006,"Video server is busy"))}return i(t,e),t}(a);t.SignalingServerBusyError=_,Object.defineProperty(c,53006,{value:_});var w=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53100,"Room name is invalid"))}return i(t,e),t}(a);t.RoomNameInvalidError=w,Object.defineProperty(c,53100,{value:w});var k=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53101,"Room name is too long"))}return i(t,e),t}(a);t.RoomNameTooLongError=k,Object.defineProperty(c,53101,{value:k});var O=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53102,"Room name contains invalid characters"))}return i(t,e),t}(a);t.RoomNameCharsInvalidError=O,Object.defineProperty(c,53102,{value:O});var S=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53103,"Unable to create Room"))}return i(t,e),t}(a);t.RoomCreateFailedError=S,Object.defineProperty(c,53103,{value:S});var P=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53104,"Unable to connect to Room"))}return i(t,e),t}(a);t.RoomConnectFailedError=P,Object.defineProperty(c,53104,{value:P});var T=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53105,"Room contains too many Participants"))}return i(t,e),t}(a);t.RoomMaxParticipantsExceededError=T,Object.defineProperty(c,53105,{value:T});var C=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53106,"Room not found"))}return i(t,e),t}(a);t.RoomNotFoundError=C,Object.defineProperty(c,53106,{value:C});var E=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53107,"MaxParticipants is out of range"))}return i(t,e),t}(a);t.RoomMaxParticipantsOutOfRangeError=E,Object.defineProperty(c,53107,{value:E});var j=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53108,"RoomType is not valid"))}return i(t,e),t}(a);t.RoomTypeInvalidError=j,Object.defineProperty(c,53108,{value:j});var R=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53109,"Timeout is out of range"))}return i(t,e),t}(a);t.RoomTimeoutOutOfRangeError=R,Object.defineProperty(c,53109,{value:R});var M=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53110,"StatusCallbackMethod is invalid"))}return i(t,e),t}(a);t.RoomStatusCallbackMethodInvalidError=M,Object.defineProperty(c,53110,{value:M});var x=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53111,"StatusCallback is invalid"))}return i(t,e),t}(a);t.RoomStatusCallbackInvalidError=x,Object.defineProperty(c,53111,{value:x});var A=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53112,"Status is invalid"))}return i(t,e),t}(a);t.RoomStatusInvalidError=A,Object.defineProperty(c,53112,{value:A});var L=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53113,"Room exists"))}return i(t,e),t}(a);t.RoomRoomExistsError=L,Object.defineProperty(c,53113,{value:L});var I=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53114,"Room creation parameter(s) incompatible with the Room type"))}return i(t,e),t}(a);t.RoomInvalidParametersError=I,Object.defineProperty(c,53114,{value:I});var D=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53115,"MediaRegion is invalid"))}return i(t,e),t}(a);t.RoomMediaRegionInvalidError=D,Object.defineProperty(c,53115,{value:D});var N=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53116,"There are no media servers available in the MediaRegion"))}return i(t,e),t}(a);t.RoomMediaRegionUnavailableError=N,Object.defineProperty(c,53116,{value:N});var F=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53117,"The subscription operation requested is not supported for the Room type"))}return i(t,e),t}(a);t.RoomSubscriptionOperationNotSupportedError=F,Object.defineProperty(c,53117,{value:F});var V=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53118,"Room completed"))}return i(t,e),t}(a);t.RoomCompletedError=V,Object.defineProperty(c,53118,{value:V});var U=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53200,"Participant identity is invalid"))}return i(t,e),t}(a);t.ParticipantIdentityInvalidError=U,Object.defineProperty(c,53200,{value:U});var B=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53201,"Participant identity is too long"))}return i(t,e),t}(a);t.ParticipantIdentityTooLongError=B,Object.defineProperty(c,53201,{value:B});var q=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53202,"Participant identity contains invalid characters"))}return i(t,e),t}(a);t.ParticipantIdentityCharsInvalidError=q,Object.defineProperty(c,53202,{value:q});var W=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53203,"The maximum number of published tracks allowed in the Room at the same time has been reached"))}return i(t,e),t}(a);t.ParticipantMaxTracksExceededError=W,Object.defineProperty(c,53203,{value:W});var H=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53204,"Participant not found"))}return i(t,e),t}(a);t.ParticipantNotFoundError=H,Object.defineProperty(c,53204,{value:H});var Q=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53205,"Participant disconnected because of duplicate identity"))}return i(t,e),t}(a);t.ParticipantDuplicateIdentityError=Q,Object.defineProperty(c,53205,{value:Q});var Z=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53300,"Track is invalid"))}return i(t,e),t}(a);t.TrackInvalidError=Z,Object.defineProperty(c,53300,{value:Z});var G=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53301,"Track name is invalid"))}return i(t,e),t}(a);t.TrackNameInvalidError=G,Object.defineProperty(c,53301,{value:G});var z=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53302,"Track name is too long"))}return i(t,e),t}(a);t.TrackNameTooLongError=z,Object.defineProperty(c,53302,{value:z});var J=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53303,"Track name contains invalid characters"))}return i(t,e),t}(a);t.TrackNameCharsInvalidError=J,Object.defineProperty(c,53303,{value:J});var Y=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53304,"Track name is duplicated"))}return i(t,e),t}(a);t.TrackNameIsDuplicatedError=Y,Object.defineProperty(c,53304,{value:Y});var K=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53305,"The server has reached capacity and cannot fulfill this request"))}return i(t,e),t}(a);t.TrackServerTrackCapacityReachedError=K,Object.defineProperty(c,53305,{value:K});var $=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53400,"Client is unable to create or apply a local media description"))}return i(t,e),t}(a);t.MediaClientLocalDescFailedError=$,Object.defineProperty(c,53400,{value:$});var X=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53401,"Server is unable to create or apply a local media description"))}return i(t,e),t}(a);t.MediaServerLocalDescFailedError=X,Object.defineProperty(c,53401,{value:X});var ee=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53402,"Client is unable to apply a remote media description"))}return i(t,e),t}(a);t.MediaClientRemoteDescFailedError=ee,Object.defineProperty(c,53402,{value:ee});var te=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53403,"Server is unable to apply a remote media description"))}return i(t,e),t}(a);t.MediaServerRemoteDescFailedError=te,Object.defineProperty(c,53403,{value:te});var ne=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53404,"No supported codec"))}return i(t,e),t}(a);t.MediaNoSupportedCodecError=ne,Object.defineProperty(c,53404,{value:ne});var re=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53405,"Media connection failed or Media activity ceased"))}return i(t,e),t}(a);t.MediaConnectionError=re,Object.defineProperty(c,53405,{value:re});var oe=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53407,"Media connection failed due to DTLS handshake failure"))}return i(t,e),t}(a);t.MediaDTLSTransportFailedError=oe,Object.defineProperty(c,53407,{value:oe});var ie=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53500,"Unable to acquire configuration"))}return i(t,e),t}(a);t.ConfigurationAcquireFailedError=ie,Object.defineProperty(c,53500,{value:ie});var ae=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,53501,"Unable to acquire TURN credentials"))}return i(t,e),t}(a);t.ConfigurationAcquireTurnFailedError=ae,Object.defineProperty(c,53501,{value:ae})},6294:e=>{"use strict";var t=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function n(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var i=function(e){function i(e){var t;r(this,i);var a=[].slice.call(arguments,1),c=o(this,(t=i.__proto__||Object.getPrototypeOf(i)).call.apply(t,[this].concat(n(a)))),s=Error.apply(c,a);return s.name="TwilioError",Object.defineProperty(c,"code",{value:e,enumerable:!0}),Object.getOwnPropertyNames(s).forEach(function(e){Object.defineProperty(this,e,{value:s[e],enumerable:!0})},c),c}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,Error),t(i,[{key:"toString",value:function(){return this.name+" "+this.code+(this.message?": "+this.message:"")}}]),i}();e.exports=i},5330:(e,t,n)=>{"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(4384).isNonArrayObject,i=n(2779),a=i.typeErrors,c=i.clientTrackSwitchOffControl,s=i.videoContentPreferencesMode,u=i.subscriptionMode,l=i.trackPriority,f=i.trackSwitchOffMode;function p(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return void 0===e?null:null!==e&&o(e)?n.reduce(function(n,o){var i=o.prop,c=o.type,s=o.values;if(n||!(i in e))return n;var u=e[i];return c&&(void 0===u?"undefined":r(u))!==c||"number"===c&&isNaN(u)?a.INVALID_TYPE(t+"."+i,c):Array.isArray(s)&&!s.includes(u)?a.INVALID_VALUE(t+"."+i,s):n},null):a.INVALID_TYPE(t,"object")}t.validateBandwidthProfile=function(e){var t=p(e,"options.bandwidthProfile");return!e||t?t:(t=p(e.video,"options.bandwidthProfile.video",[{prop:"contentPreferencesMode",values:Object.values(s)},{prop:"dominantSpeakerPriority",values:Object.values(l)},{prop:"maxSubscriptionBitrate",type:"number"},{prop:"maxTracks",type:"number"},{prop:"mode",values:Object.values(u)},{prop:"clientTrackSwitchOffControl",values:Object.values(c)},{prop:"trackSwitchOffMode",values:Object.values(f)}]))||(e.video?"maxTracks"in e.video&&"clientTrackSwitchOffControl"in e.video?new TypeError("options.bandwidthProfile.video.maxTracks is deprecated. Use options.bandwidthProfile.video.clientTrackSwitchOffControl instead."):"renderDimensions"in e.video&&"contentPreferencesMode"in e.video?new TypeError("options.bandwidthProfile.video.renderDimensions is deprecated. Use options.bandwidthProfile.video.contentPreferencesMode instead."):function(e){var t="options.bandwidthProfile.video.renderDimensions",n=p(e,t);return e?n||Object.values(l).reduce(function(n,r){return n||p(e[r],t+"."+r,[{prop:"height",type:"number"},{prop:"width",type:"number"}])},null):n}(e.video.renderDimensions):null)},t.validateLocalTrack=function(e,t){if(!(e instanceof t.LocalAudioTrack||e instanceof t.LocalDataTrack||e instanceof t.LocalVideoTrack||e instanceof t.MediaStreamTrack))throw a.INVALID_TYPE("track","LocalAudioTrack, LocalVideoTrack, LocalDataTrack, or MediaStreamTrack")},t.validateObject=p},3649:e=>{"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(){},r="undefined",o=("undefined"==typeof window?"undefined":t(window))!==r&&t(window.navigator)!==r&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"];function a(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(r){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function s(e){return"debug"===e&&(e="log"),("undefined"==typeof console?"undefined":t(console))!==r&&("trace"===e&&o?c:void 0!==console[e]?a(console,e):void 0!==console.log?a(console,"log"):n)}function u(e,t){for(var r=0;r<i.length;r++){var o=i[r];this[o]=r<e?n:this.methodFactory(o,e,t)}this.log=this.debug}function l(e,n,o){return function(){("undefined"==typeof console?"undefined":t(console))!==r&&(u.call(this,n,o),this[e].apply(this,arguments))}}function f(e,t,n){return s(e)||l.apply(this,arguments)}function p(e,n,o){var a,c=this,s="loglevel";function l(){var e;if(("undefined"==typeof window?"undefined":t(window))!==r&&s){try{e=window.localStorage[s]}catch(i){}if((void 0===e?"undefined":t(e))===r)try{var n=window.document.cookie,o=n.indexOf(encodeURIComponent(s)+"=");-1!==o&&(e=/^([^;]+)/.exec(n.slice(o))[1])}catch(i){}return void 0===c.levels[e]&&(e=void 0),e}}"string"==typeof e?s+=":"+e:"symbol"===(void 0===e?"undefined":t(e))&&(s=void 0),c.name=e,c.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},c.methodFactory=o||f,c.getLevel=function(){return a},c.setLevel=function(n,o){if("string"==typeof n&&void 0!==c.levels[n.toUpperCase()]&&(n=c.levels[n.toUpperCase()]),!("number"==typeof n&&n>=0&&n<=c.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;if(a=n,!1!==o&&function(e){var n=(i[e]||"silent").toUpperCase();if(("undefined"==typeof window?"undefined":t(window))!==r&&s){try{return void(window.localStorage[s]=n)}catch(o){}try{window.document.cookie=encodeURIComponent(s)+"="+n+";"}catch(o){}}}(n),u.call(c,n,e),("undefined"==typeof console?"undefined":t(console))===r&&n<c.levels.SILENT)return"No console available for logging"},c.setDefaultLevel=function(e){l()||c.setLevel(e,!1)},c.enableAll=function(e){c.setLevel(c.levels.TRACE,e)},c.disableAll=function(e){c.setLevel(c.levels.SILENT,e)};var p=l();null==p&&(p=null==n?"WARN":n),c.setLevel(p,!1)}var d=new p,h={};d.getLogger=function(e){if("symbol"!==(void 0===e?"undefined":t(e))&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var n=h[e];return n||(n=h[e]=new p(e,d.getLevel(),d.methodFactory)),n};var v=("undefined"==typeof window?"undefined":t(window))!==r?window.log:void 0;d.noConflict=function(){return("undefined"==typeof window?"undefined":t(window))!==r&&window.log===d&&(window.log=v),d},d.getLoggers=function(){return h},d.default=d,e.exports=d},3308:e=>{"use strict";var t=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),n="undefined"!=typeof AudioContext?AudioContext:"undefined"!=typeof webkitAudioContext?webkitAudioContext:null,r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=Object.assign({AudioContext:n},t),Object.defineProperties(this,{_AudioContext:{value:t.AudioContext},_audioContext:{value:null,writable:!0},_holders:{value:new Set},AudioContextFactory:{enumerable:!0,value:e}})}return t(e,[{key:"getOrCreate",value:function(e){if(!this._holders.has(e)&&(this._holders.add(e),this._AudioContext&&!this._audioContext))try{this._audioContext=new this._AudioContext}catch(t){}return this._audioContext}},{key:"release",value:function(e){this._holders.has(e)&&(this._holders.delete(e),!this._holders.size&&this._audioContext&&(this._audioContext.close(),this._audioContext=null))}}]),e}();e.exports=new r},5369:e=>{"use strict";e.exports=function(e,t,n){n="number"==typeof n?n:250;var r=e.createMediaStreamSource(t),o=e.createAnalyser();o.fftSize=2048,r.connect(o);var i=new Uint8Array(o.fftSize),a=!1;return setTimeout(function(){a=!0},n),function e(){return a?Promise.resolve(!0):(o.getByteTimeDomainData(i),i.some(function(e){return 128!==e&&0!==e})?Promise.resolve(!1):function(e){return e="number"==typeof e?e:0,new Promise(function(t){return setTimeout(t,e)})}().then(e))}().then(function(e){return r.disconnect(),e},function(e){throw r.disconnect(),e})}},817:(e,t,n)=>{"use strict";var r=n(5369);e.exports=function(e,t,o,i,a){i="number"==typeof i?i:3;var c=0,s=n(3308),u={},l=s.getOrCreate(u);return function n(){return t(o).then(function(t){return(o.audio?r(l,t,a).catch(function(t){return e.warn("Encountered an error while detecting silence",t),!0}):Promise.resolve(!1)).then(function(r){return r?i<=0?(e.warn("Got a silent audio MediaStreamTrack. Normally we would try to get a new one, but we've run out of retries; returning it anyway."),t):(e.warn("Got a silent audio MediaStreamTrack. Stopping all MediaStreamTracks and calling getUserMedia again. This is retry #"+ ++c+"."),t.getTracks().forEach(function(e){return e.stop()}),i--,n()):(e.info("Got a non-silent audio MediaStreamTrack; returning it."),t)})})}().then(function(e){return s.release(u),e},function(e){throw s.release(u),e})}},8160:e=>{e.exports=WebSocket},7614:e=>{e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},6529:(e,t,n)=>{"use strict";var r=n(4650),o=n(1951),i=n(2594),a=n(4103);function c(e){return e.call.bind(e)}var s="undefined"!=typeof BigInt,u="undefined"!=typeof Symbol,l=c(Object.prototype.toString),f=c(Number.prototype.valueOf),p=c(String.prototype.valueOf),d=c(Boolean.prototype.valueOf);if(s)var h=c(BigInt.prototype.valueOf);if(u)var v=c(Symbol.prototype.valueOf);function y(e,t){if("object"!=typeof e)return!1;try{return t(e),!0}catch(n){return!1}}function m(e){return"[object Map]"===l(e)}function g(e){return"[object Set]"===l(e)}function b(e){return"[object WeakMap]"===l(e)}function _(e){return"[object WeakSet]"===l(e)}function w(e){return"[object ArrayBuffer]"===l(e)}function k(e){return"undefined"!=typeof ArrayBuffer&&(w.working?w(e):e instanceof ArrayBuffer)}function O(e){return"[object DataView]"===l(e)}function S(e){return"undefined"!=typeof DataView&&(O.working?O(e):e instanceof DataView)}t.isArgumentsObject=r,t.isGeneratorFunction=o,t.isTypedArray=a,t.isPromise=function(e){return"undefined"!=typeof Promise&&e instanceof Promise||null!==e&&"object"==typeof e&&"function"==typeof e.then&&"function"==typeof e.catch},t.isArrayBufferView=function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):a(e)||S(e)},t.isUint8Array=function(e){return"Uint8Array"===i(e)},t.isUint8ClampedArray=function(e){return"Uint8ClampedArray"===i(e)},t.isUint16Array=function(e){return"Uint16Array"===i(e)},t.isUint32Array=function(e){return"Uint32Array"===i(e)},t.isInt8Array=function(e){return"Int8Array"===i(e)},t.isInt16Array=function(e){return"Int16Array"===i(e)},t.isInt32Array=function(e){return"Int32Array"===i(e)},t.isFloat32Array=function(e){return"Float32Array"===i(e)},t.isFloat64Array=function(e){return"Float64Array"===i(e)},t.isBigInt64Array=function(e){return"BigInt64Array"===i(e)},t.isBigUint64Array=function(e){return"BigUint64Array"===i(e)},m.working="undefined"!=typeof Map&&m(new Map),t.isMap=function(e){return"undefined"!=typeof Map&&(m.working?m(e):e instanceof Map)},g.working="undefined"!=typeof Set&&g(new Set),t.isSet=function(e){return"undefined"!=typeof Set&&(g.working?g(e):e instanceof Set)},b.working="undefined"!=typeof WeakMap&&b(new WeakMap),t.isWeakMap=function(e){return"undefined"!=typeof WeakMap&&(b.working?b(e):e instanceof WeakMap)},_.working="undefined"!=typeof WeakSet&&_(new WeakSet),t.isWeakSet=function(e){return _(e)},w.working="undefined"!=typeof ArrayBuffer&&w(new ArrayBuffer),t.isArrayBuffer=k,O.working="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView&&O(new DataView(new ArrayBuffer(1),0,1)),t.isDataView=S;var P="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:void 0;function T(e){return"[object SharedArrayBuffer]"===l(e)}function C(e){return void 0!==P&&(void 0===T.working&&(T.working=T(new P)),T.working?T(e):e instanceof P)}function E(e){return y(e,f)}function j(e){return y(e,p)}function R(e){return y(e,d)}function M(e){return s&&y(e,h)}function x(e){return u&&y(e,v)}t.isSharedArrayBuffer=C,t.isAsyncFunction=function(e){return"[object AsyncFunction]"===l(e)},t.isMapIterator=function(e){return"[object Map Iterator]"===l(e)},t.isSetIterator=function(e){return"[object Set Iterator]"===l(e)},t.isGeneratorObject=function(e){return"[object Generator]"===l(e)},t.isWebAssemblyCompiledModule=function(e){return"[object WebAssembly.Module]"===l(e)},t.isNumberObject=E,t.isStringObject=j,t.isBooleanObject=R,t.isBigIntObject=M,t.isSymbolObject=x,t.isBoxedPrimitive=function(e){return E(e)||j(e)||R(e)||M(e)||x(e)},t.isAnyArrayBuffer=function(e){return"undefined"!=typeof Uint8Array&&(k(e)||C(e))},["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(e){Object.defineProperty(t,e,{enumerable:!1,value:function(){throw new Error(e+" is not supported in userland")}})})},1036:(e,t,n)=>{var r=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++)n[t[r]]=Object.getOwnPropertyDescriptor(e,t[r]);return n},o=/%[sdj%]/g;t.format=function(e){if(!g(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(s(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,i=r.length,a=String(e).replace(o,function(e){if("%%"===e)return"%";if(n>=i)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(t){return"[Circular]"}default:return e}}),c=r[n];n<i;c=r[++n])y(c)||!w(c)?a+=" "+c:a+=" "+s(c);return a},t.deprecate=function(e,n){if("undefined"!=typeof process&&!0===process.noDeprecation)return e;if("undefined"==typeof process)return function(){return t.deprecate(e,n).apply(this,arguments)};var r=!1;return function(){if(!r){if(process.throwDeprecation)throw new Error(n);process.traceDeprecation?console.trace(n):console.error(n),r=!0}return e.apply(this,arguments)}};var i={},a=/^$/;if(process.env.NODE_DEBUG){var c=process.env.NODE_DEBUG;c=c.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),a=new RegExp("^"+c+"$","i")}function s(e,n){var r={seen:[],stylize:l};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),v(n)?r.showHidden=n:n&&t._extend(r,n),b(r.showHidden)&&(r.showHidden=!1),b(r.depth)&&(r.depth=2),b(r.colors)&&(r.colors=!1),b(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=u),f(r,e,r.depth)}function u(e,t){var n=s.styles[t];return n?"\x1b["+s.colors[n][0]+"m"+e+"\x1b["+s.colors[n][1]+"m":e}function l(e,t){return e}function f(e,n,r){if(e.customInspect&&n&&S(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var o=n.inspect(r,e);return g(o)||(o=f(e,o,r)),o}var i=function(e,t){if(b(t))return e.stylize("undefined","undefined");if(g(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return m(t)?e.stylize(""+t,"number"):v(t)?e.stylize(""+t,"boolean"):y(t)?e.stylize("null","null"):void 0}(e,n);if(i)return i;var a=Object.keys(n),c=function(e){var t={};return e.forEach(function(e,n){t[e]=!0}),t}(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(n)),O(n)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return p(n);if(0===a.length){if(S(n))return e.stylize("[Function"+(n.name?": "+n.name:"")+"]","special");if(_(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(k(n))return e.stylize(Date.prototype.toString.call(n),"date");if(O(n))return p(n)}var s,u="",l=!1,w=["{","}"];return h(n)&&(l=!0,w=["[","]"]),S(n)&&(u=" [Function"+(n.name?": "+n.name:"")+"]"),_(n)&&(u=" "+RegExp.prototype.toString.call(n)),k(n)&&(u=" "+Date.prototype.toUTCString.call(n)),O(n)&&(u=" "+p(n)),0!==a.length||l&&0!=n.length?r<0?_(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),s=l?function(e,t,n,r,o){for(var i=[],a=0,c=t.length;a<c;++a)j(t,String(a))?i.push(d(e,t,n,r,String(a),!0)):i.push("");return o.forEach(function(o){o.match(/^\d+$/)||i.push(d(e,t,n,r,o,!0))}),i}(e,n,r,c,a):a.map(function(t){return d(e,n,r,c,t,l)}),e.seen.pop(),function(e,t,n){return e.reduce(function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}(s,u,w)):w[0]+u+w[1]}function p(e){return"["+Error.prototype.toString.call(e)+"]"}function d(e,t,n,r,o,i){var a,c,s;if((s=Object.getOwnPropertyDescriptor(t,o)||{value:t[o]}).get?c=e.stylize(s.set?"[Getter/Setter]":"[Getter]","special"):s.set&&(c=e.stylize("[Setter]","special")),j(r,o)||(a="["+o+"]"),c||(e.seen.indexOf(s.value)<0?(c=y(n)?f(e,s.value,null):f(e,s.value,n-1)).indexOf("\n")>-1&&(c=i?c.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+c.split("\n").map(function(e){return"   "+e}).join("\n")):c=e.stylize("[Circular]","special")),b(a)){if(i&&o.match(/^\d+$/))return c;(a=JSON.stringify(""+o)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+c}function h(e){return Array.isArray(e)}function v(e){return"boolean"==typeof e}function y(e){return null===e}function m(e){return"number"==typeof e}function g(e){return"string"==typeof e}function b(e){return void 0===e}function _(e){return w(e)&&"[object RegExp]"===P(e)}function w(e){return"object"==typeof e&&null!==e}function k(e){return w(e)&&"[object Date]"===P(e)}function O(e){return w(e)&&("[object Error]"===P(e)||e instanceof Error)}function S(e){return"function"==typeof e}function P(e){return Object.prototype.toString.call(e)}function T(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(e){if(e=e.toUpperCase(),!i[e])if(a.test(e)){var n=process.pid;i[e]=function(){var r=t.format.apply(t,arguments);console.error("%s %d: %s",e,n,r)}}else i[e]=function(){};return i[e]},t.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.types=n(6529),t.isArray=h,t.isBoolean=v,t.isNull=y,t.isNullOrUndefined=function(e){return null==e},t.isNumber=m,t.isString=g,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=b,t.isRegExp=_,t.types.isRegExp=_,t.isObject=w,t.isDate=k,t.types.isDate=k,t.isError=O,t.types.isNativeError=O,t.isFunction=S,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(7614);var C=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function E(){var e=new Date,t=[T(e.getHours()),T(e.getMinutes()),T(e.getSeconds())].join(":");return[e.getDate(),C[e.getMonth()],t].join(" ")}function j(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",E(),t.format.apply(t,arguments))},t.inherits=n(5457),t._extend=function(e,t){if(!t||!w(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e};var R="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function M(e,t){if(!e){var n=new Error("Promise was rejected with a falsy value");n.reason=e,e=n}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(R&&e[R]){var t;if("function"!=typeof(t=e[R]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,R,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,n,r=new Promise(function(e,r){t=e,n=r}),o=[],i=0;i<arguments.length;i++)o.push(arguments[i]);o.push(function(e,r){e?n(e):t(r)});try{e.apply(this,o)}catch(a){n(a)}return r}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),R&&Object.defineProperty(t,R,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,r(e))},t.promisify.custom=R,t.callbackify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');function t(){for(var t=[],n=0;n<arguments.length;n++)t.push(arguments[n]);var r=t.pop();if("function"!=typeof r)throw new TypeError("The last argument must be of type Function");var o=this,i=function(){return r.apply(o,arguments)};e.apply(this,t).then(function(e){process.nextTick(i.bind(null,null,e))},function(e){process.nextTick(M.bind(null,e,i))})}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),Object.defineProperties(t,r(e)),t}},2594:(e,t,n)=>{"use strict";var r=n(9474),o=n(2322),i=n(9808),a=i("Object.prototype.toString"),c=n(5618)()&&"symbol"==typeof Symbol.toStringTag,s=o(),u=i("String.prototype.slice"),l={},f=n(3278),p=Object.getPrototypeOf;c&&f&&p&&r(s,function(e){if("function"==typeof global[e]){var t=new global[e];if(!(Symbol.toStringTag in t))throw new EvalError("this engine has support for Symbol.toStringTag, but "+e+" does not have the property! Please report this.");var n=p(t),r=f(n,Symbol.toStringTag);if(!r){var o=p(n);r=f(o,Symbol.toStringTag)}l[e]=r.get}});var d=n(4103);e.exports=function(e){return!!d(e)&&(c?function(e){var t=!1;return r(l,function(n,r){if(!t)try{var o=n.call(e);o===r&&(t=o)}catch(i){}}),t}(e):u(a(e),8,-1))}},7279:(e,t,n)=>{"use strict";n.r(t),n.d(t,{VideoCallModule:()=>de});var r=n(1116),o=n(4887),i=n(6083),a=n(3146),c=n(4762),s=n(5291),u=n(7570),l=n(7254),f=n(8318),p=n(6599),d=n(2628),h=n(4689),v=n(4045),y=n(8619),m=n(1198),g=n(529),b=n(6994),_=n(5165),w=n(2693);let k=(()=>{class e{constructor(e,t){this.http=e,this.fetchApiService=t,this.roomBroadcast=new b.t,this.$roomsUpdated=this.roomBroadcast.asObservable()}getAuthToken(){return(0,c.mG)(this,void 0,void 0,function*(){return(yield this.http.get(g.N.urlAPI.joinOrCreateVideoRoom).toPromise()).token})}getAllRooms(){return this.http.get("https://localhost:44390/api/video/rooms").toPromise()}joinOrCreateRoom(e,t){return(0,c.mG)(this,void 0,void 0,function*(){let n=null;try{const r=yield this.getAuthToken();n=yield(0,v.connect)(r,{name:e,tracks:t,dominantSpeaker:!0})}catch(r){console.error(`Unable to connect to Room: ${r.message}`)}finally{n&&this.roomBroadcast.next(!0)}return n})}nudge(){this.roomBroadcast.next(!0)}acceptOrRejectCall(e,t){return this.fetchApiService.Post(null,g.N.urlAPI.acceptOrRejectCall+"?roomId="+e+"&status="+t)}exitCall(e){return this.fetchApiService.Post(null,g.N.urlAPI.exitCall+"?roomId="+e)}}return e.\u0275fac=function(t){return new(t||e)(y.LFG(w.eN),y.LFG(_.Z))},e.\u0275prov=y.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),O=(()=>{class e{get(e){return localStorage.getItem(this.formatAppStorageKey(e))}set(e,t){t&&"null"!==t&&localStorage.setItem(this.formatAppStorageKey(e),t)}remove(e){localStorage.removeItem(this.formatAppStorageKey(e))}formatAppStorageKey(e){return`iEvangelist.videoChat.${e}`}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=y.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var S=n(957),P=n(8370);const T=["list"];let C=(()=>{class e{constructor(e){this.renderer=e,this.participantsChanged=new y.vpe,this.leaveRoom=new y.vpe,this.hasVideo=new y.vpe}get participantCount(){return this.participants?this.participants.size:0}get isAlone(){return 0===this.participantCount}ngOnInit(){}clear(){this.participants&&this.participants.clear()}initialize(e){this.participants=e,this.participants&&this.participants.forEach(e=>this.registerParticipantEvents(e))}add(e){this.participants&&e&&(this.participants.set(e.sid,e),this.registerParticipantEvents(e))}remove(e){this.participants&&this.participants.has(e.sid)&&this.participants.delete(e.sid)}loudest(e){this.dominantSpeaker=e}onLeaveRoom(){this.leaveRoom.emit(!0)}registerParticipantEvents(e){e&&(e.tracks.forEach(e=>this.subscribe(e)),e.on("trackPublished",e=>this.subscribe(e)),e.on("trackUnpublished",e=>{e&&e.track&&this.detachRemoteTrack(e.track)}))}subscribe(e){e&&e.on&&(e.on("subscribed",e=>this.attachRemoteTrack(e)),e.on("unsubscribed",e=>this.detachRemoteTrack(e)))}attachRemoteTrack(e){if(this.isAttachable(e)){const t=e.attach();this.renderer.data.id=e.sid,this.renderer.setStyle(t,"width","290px"),this.renderer.setStyle(t,"margin-left","2.5%"),this.renderer.appendChild(this.listRef.nativeElement,t),this.participantsChanged.emit(!0),"video"===e.kind&&this.hasVideo.emit(!0)}}detachRemoteTrack(e){this.isDetachable(e)&&(e.detach().forEach(e=>e.remove()),this.participantsChanged.emit(!0))}isAttachable(e){return!!e&&(void 0!==e.attach||void 0!==e.attach)}isDetachable(e){return!!e&&(void 0!==e.detach||void 0!==e.detach)}}return e.\u0275fac=function(t){return new(t||e)(y.Y36(y.Qsj))},e.\u0275cmp=y.Xpm({type:e,selectors:[["ymg-video-call-participants"]],viewQuery:function(e,t){if(1&e&&y.Gf(T,5),2&e){let e;y.iGM(e=y.CRH())&&(t.listRef=e.first)}},inputs:{activeRoomName:"activeRoomName"},outputs:{participantsChanged:"participantsChanged",leaveRoom:"leaveRoom",hasVideo:"hasVideo"},decls:2,vars:0,consts:[["list",""]],template:function(e,t){1&e&&y._UZ(0,"div",null,0)},styles:[""]}),e})();var E=n(7301);const j=["preview"];function R(e,t){1&e&&(y.TgZ(0,"div",3),y._uU(1,"Loading preview... Please wait."),y.qZA())}let M=(()=>{class e{constructor(e,t){this.storageService=e,this.renderer=t,this.videoTrack=null,this.isInitializing=!0}ngAfterViewInit(){return(0,c.mG)(this,void 0,void 0,function*(){if(this.previewElement&&this.previewElement.nativeElement){const e=this.storageService.get("videoInputId");yield this.initializeDevice(null!=e?e:"")}})}ngOnInit(){}initializePreview(e){return(0,c.mG)(this,void 0,void 0,function*(){yield this.initializeDevice(e)})}finalizePreview(){try{this.videoTrack&&this.videoTrack.detach().forEach(e=>e.remove()),this.videoTrack=null}catch(e){console.error(e)}}initializeDevice(e){return(0,c.mG)(this,void 0,void 0,function*(){try{this.isInitializing=!0,this.finalizePreview(),this.videoTrack=e?yield(0,v.createLocalVideoTrack)({deviceId:e}):yield(0,v.createLocalVideoTrack)();const t=this.videoTrack.attach();this.renderer.setStyle(t,"height","100%"),this.renderer.setStyle(t,"width","100%"),this.renderer.appendChild(this.previewElement.nativeElement,t)}finally{this.isInitializing=!1}})}}return e.\u0275fac=function(t){return new(t||e)(y.Y36(O),y.Y36(y.Qsj))},e.\u0275cmp=y.Xpm({type:e,selectors:[["ymg-video-call-camera-preview"]],viewQuery:function(e,t){if(1&e&&y.Gf(j,5),2&e){let e;y.iGM(e=y.CRH())&&(t.previewElement=e.first)}},decls:3,vars:1,consts:[[1,"camera-preview"],["preview",""],["class","camera-preview-initialing",4,"ngIf"],[1,"camera-preview-initialing"]],template:function(e,t){1&e&&(y.TgZ(0,"div",0,1),y.YNc(2,R,2,0,"div",2),y.qZA()),2&e&&(y.xp6(2),y.Q6J("ngIf",t.isInitializing))},directives:[r.O5],styles:[".camera-preview[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:10px;overflow:hidden}.camera-preview[_ngcontent-%COMP%]   .camera-preview-initialing[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:100%}"]}),e})();var x=n(810);const A=["participants"],L=["camera"];function I(e,t){1&e&&(y.ynx(0),y._uU(1),y.ALo(2,"translate"),y.BQk()),2&e&&(y.xp6(1),y.Oqu(y.lcZ(2,1,"startCall")))}function D(e,t){1&e&&(y._uU(0),y.ALo(1,"translate")),2&e&&y.Oqu(y.lcZ(1,1,"endCall"))}function N(e,t){1&e&&(y.ynx(0),y._uU(1),y.ALo(2,"translate"),y.BQk()),2&e&&(y.xp6(1),y.Oqu(y.lcZ(2,1,"startCall")))}function F(e,t){1&e&&(y._uU(0),y.ALo(1,"translate")),2&e&&y.Oqu(y.lcZ(1,1,"callBack"))}function V(e,t){if(1&e){const e=y.EpF();y.TgZ(0,"div",15),y.NdJ("click",function(){return y.CHM(e),y.oxw(3).exitVideoCall(!1)}),y._uU(1),y.ALo(2,"translate"),y.qZA()}2&e&&(y.xp6(1),y.Oqu(y.lcZ(2,1,"end")))}function U(e,t){if(1&e){const e=y.EpF();y.TgZ(0,"div",4),y.TgZ(1,"div",5),y._UZ(2,"img",6),y.qZA(),y.TgZ(3,"p",7),y._uU(4),y.qZA(),y.TgZ(5,"p",8),y.YNc(6,I,3,3,"ng-container",9),y.YNc(7,D,2,3,"ng-template",null,10,y.W1O),y.qZA(),y.TgZ(9,"div",11),y.TgZ(10,"div",12),y.NdJ("click",function(){return y.CHM(e),y.oxw(2).onStartCall()}),y.YNc(11,N,3,3,"ng-container",9),y.YNc(12,F,2,3,"ng-template",null,13,y.W1O),y.qZA(),y.YNc(14,V,3,3,"div",14),y.qZA(),y.qZA()}if(2&e){const e=y.MAs(8),t=y.MAs(13),n=y.oxw(2);y.xp6(2),y.s9C("src",n.room.avatar,y.LSH),y.xp6(2),y.Oqu(n.room.name),y.xp6(2),y.Q6J("ngIf",1===n.step)("ngIfElse",e),y.xp6(5),y.Q6J("ngIf",1===n.step)("ngIfElse",t),y.xp6(3),y.Q6J("ngIf",n.newWindow&&3===n.step)}}function B(e,t){if(1&e&&(y.ynx(0),y.TgZ(1,"div",31),y._UZ(2,"img",32),y.qZA(),y.TgZ(3,"p",33),y._uU(4),y.qZA(),y.TgZ(5,"p",34),y._uU(6),y.ALo(7,"translate"),y.qZA(),y.BQk()),2&e){const e=y.oxw(3);y.xp6(2),y.s9C("src",e.room.avatar,y.LSH),y.xp6(2),y.Oqu(e.room.name),y.xp6(2),y.Oqu(y.lcZ(7,3,"calling"))}}function q(e,t){if(1&e&&(y.ynx(0),y.TgZ(1,"div",31),y._UZ(2,"img",32),y.qZA(),y.TgZ(3,"p",33),y._uU(4),y.qZA(),y.TgZ(5,"p",34),y._uU(6),y.ALo(7,"translate"),y.qZA(),y.BQk()),2&e){const e=y.oxw(4);y.xp6(2),y.s9C("src",e.room.avatar,y.LSH),y.xp6(2),y.Oqu(e.room.name),y.xp6(2),y.Oqu(y.lcZ(7,3,"cameraIsOff"))}}function W(e,t){if(1&e&&y.YNc(0,q,8,5,"ng-container",30),2&e){const e=y.oxw(3);y.Q6J("ngIf",!e.hasVideo)}}function H(e,t){1&e&&y._UZ(0,"ymg-video-call-camera-preview",null,35)}function Q(e,t){if(1&e){const e=y.EpF();y.TgZ(0,"div",16),y.TgZ(1,"div",17),y.YNc(2,B,8,5,"ng-container",9),y.YNc(3,W,1,1,"ng-template",null,18,y.W1O),y.TgZ(5,"ymg-video-call-participants",19,20),y.NdJ("hasVideo",function(){return y.CHM(e),y.oxw(2).onParticipantsHasVideo()}),y.qZA(),y.qZA(),y.TgZ(7,"div",21),y.TgZ(8,"div",22),y.TgZ(9,"div",23),y.TgZ(10,"div",24),y._UZ(11,"fa-icon",25),y.qZA(),y.qZA(),y.TgZ(12,"div",26),y.TgZ(13,"div",27),y.NdJ("click",function(){return y.CHM(e),y.oxw(2).exitVideoCall(!0)}),y._UZ(14,"fa-icon",25),y.qZA(),y.TgZ(15,"div",24),y._UZ(16,"fa-icon",25),y.qZA(),y.TgZ(17,"div",28),y.NdJ("click",function(){y.CHM(e);const t=y.oxw(2);return t.isVideo=!t.isVideo}),y._UZ(18,"fa-icon",25),y.qZA(),y.qZA(),y.TgZ(19,"div",29),y.YNc(20,H,2,0,"ymg-video-call-camera-preview",30),y.qZA(),y.qZA(),y.qZA(),y.qZA()}if(2&e){const e=y.MAs(4),t=y.oxw(2);y.xp6(2),y.Q6J("ngIf",!t.haveUserJoined)("ngIfElse",e),y.xp6(3),y.Udp("display",t.activeRoom&&t.hasVideo?"block":"none"),y.xp6(6),y.Q6J("icon",t.commentIcon),y.xp6(3),y.Q6J("icon",t.phoneIcon),y.xp6(2),y.Q6J("icon",t.microIcon),y.xp6(1),y.ekj("calling-room-footer-item--slash",!t.isVideo),y.xp6(1),y.Q6J("icon",t.isVideo?t.videoIcon:t.videoSlashIcon),y.xp6(2),y.Q6J("ngIf",t.isVideo)}}function Z(e,t){if(1&e&&(y.TgZ(0,"div",1),y.YNc(1,U,15,7,"div",2),y.YNc(2,Q,21,11,"div",3),y.qZA()),2&e){const e=y.oxw();y.xp6(1),y.Q6J("ngIf",1===e.step||3===e.step),y.xp6(1),y.Q6J("ngIf",2===e.step)}}let G=(()=>{class e{constructor(e,t,n,r,o,i){this.route=e,this.chatRoomService=t,this.videoChatService=n,this.storageService=r,this.chatHubService=o,this.convertService=i,this.commentIcon=s.Mzg,this.videoIcon=s.IyC,this.videoSlashIcon=s.dRd,this.microIcon=s.UOM,this.phoneIcon=s.j1w,this.step=1,this.roomId="",this.isVideo=!0,this.newWindow=!0,this.room=null,this.haveUserJoined=!1,this.hasVideo=!1,this.userAcceptOrRejectCallSubscription=new u.w,this.userExitCallSubscription=new u.w,this.startCallSubscription=new u.w,this.beforeUnloadEventSubscription=new u.w,this.onParticipantsHasVideo=()=>this.hasVideo=!0}ngOnDestroy(){this.activeRoom&&(this.activeRoom.disconnect(),this.activeRoom=null),this.userAcceptOrRejectCallSubscription.unsubscribe(),this.userExitCallSubscription.unsubscribe(),this.beforeUnloadEventSubscription.unsubscribe()}ngOnInit(){var e,t;return(0,c.mG)(this,void 0,void 0,function*(){this.route.parent&&(this.roomId=null!==(e=this.route.parent.snapshot.paramMap.get("id"))&&void 0!==e?e:"");let n=this.route.snapshot.queryParamMap;this.isVideo="true"===n.get("is_video"),this.newWindow="true"===n.get("new_window");let r=+(null!==(t=n.get("step"))&&void 0!==t?t:"");r&&(this.step=r),this.chatRoomService.getRoomDetails(this.roomId).subscribe(e=>this.room=e),2==this.step&&this.onStartCall(),this.beforeUnloadEventSubscription=(0,l.R)(window,"beforeunload").subscribe(()=>{this.exitVideoCall(!0)}),this.userAcceptOrRejectCallSubscription=this.chatHubService.userAcceptOrRejectCall.subscribe(e=>{e.roomId===this.roomId&&(this.haveUserJoined=e.status,this.audio.pause(),this.haveUserJoined?this.activeVideoChatRoom(this.roomId):this.step=3)}),this.userExitCallSubscription=this.chatHubService.userExitCall.subscribe(e=>{this.roomId===e.roomId&&(this.audio.pause(),this.step=3)})})}onStartCall(){return(0,c.mG)(this,void 0,void 0,function*(){this.step=2,this.chatRoomService.callVideo(this.roomId,this.isVideo).pipe((0,p.b)(()=>this.audio=this.convertService.playMessageCallSound("back")),(0,d.g)(3e4),(0,h.w)(()=>this.haveUserJoined?new f.y(e=>e.next()):this.videoChatService.exitCall(this.roomId))).subscribe(e=>{this.audio.pause(),e.status&&(this.step=3)})})}onLeaveRoom(){return(0,c.mG)(this,void 0,void 0,function*(){this.activeRoom&&(this.activeRoom.disconnect(),this.activeRoom=null),this.participants&&this.participants.clear()})}exitVideoCall(e){this.onLeaveRoom(),this.startCallSubscription.unsubscribe(),e?this.videoChatService.exitCall(this.roomId).subscribe(()=>{this.step=3}):this.newWindow?window.close():this.step=3}activeVideoChatRoom(e){var t,n;return(0,c.mG)(this,void 0,void 0,function*(){let r;r=this.camera?yield Promise.all([(0,v.createLocalAudioTrack)(),this.showPreviewCamera()]):yield Promise.all([(0,v.createLocalAudioTrack)()]),this.activeRoom=yield this.videoChatService.joinOrCreateRoom(e,r),this.participants.initialize(null!==(n=null===(t=this.activeRoom)||void 0===t?void 0:t.participants)&&void 0!==n?n:{}),this.registerRoomEvents()})}showPreviewCamera(){return(0,c.mG)(this,void 0,void 0,function*(){if(!this.camera.videoTrack){const e=this.storageService.get("videoInputId");yield this.camera.initializePreview(null!=e?e:"")}return this.camera.videoTrack})}registerRoomEvents(){this.activeRoom&&this.activeRoom.on("disconnected",e=>e.localParticipant.tracks.forEach(e=>this.detachLocalTrack(e.track))).on("participantConnected",e=>this.participants.add(e)).on("participantDisconnected",e=>this.participants.remove(e)).on("dominantSpeakerChanged",e=>this.participants.loudest(e))}detachLocalTrack(e){this.isDetachable(e)&&e.detach().forEach(e=>e.remove())}isDetachable(e){return!!e&&(void 0!==e.detach||void 0!==e.detach)}}return e.\u0275fac=function(t){return new(t||e)(y.Y36(a.gz),y.Y36(m.X),y.Y36(k),y.Y36(O),y.Y36(S.h),y.Y36(P.w))},e.\u0275cmp=y.Xpm({type:e,selectors:[["ymg-video-call-in"]],viewQuery:function(e,t){if(1&e&&(y.Gf(A,5),y.Gf(L,5)),2&e){let e;y.iGM(e=y.CRH())&&(t.participants=e.first),y.iGM(e=y.CRH())&&(t.camera=e.first)}},decls:1,vars:1,consts:[["class","container",4,"ngIf"],[1,"container"],["class","ready",4,"ngIf"],["class","calling",4,"ngIf"],[1,"ready"],[1,"ready-call-avatar"],["alt","invalid profile",3,"src"],[1,"ready-call-name"],[1,"ready-call-question"],[4,"ngIf","ngIfElse"],["finish",""],[1,"ready-call-footer"],[1,"ready-call-button",3,"click"],["finish2",""],["class","ready-call-button ready-call-button--close",3,"click",4,"ngIf"],[1,"ready-call-button","ready-call-button--close",3,"click"],[1,"calling"],[1,"calling-room-info"],["userJoined",""],[3,"hasVideo"],["participants",""],[1,"calling-room-footer"],[1,"calling-room-footer-container"],[1,"calling-room-footer-left"],[1,"calling-room-footer-item"],[3,"icon"],[1,"calling-room-footer-middle"],[1,"calling-room-footer-item","calling-room-footer-item--exit",3,"click"],[1,"calling-room-footer-item",3,"click"],[1,"calling-room-footer-right"],[4,"ngIf"],[1,"calling-room-info-avatar"],[3,"src"],[1,"calling-room-info-name"],[1,"calling-room-info-title"],["camera",""]],template:function(e,t){1&e&&y.YNc(0,Z,3,2,"div",0),2&e&&y.Q6J("ngIf",t.room)},directives:[r.O5,C,E.BN,M],pipes:[x.X$],styles:[".container[_ngcontent-%COMP%]{justify-content:center;height:100%}.container[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   .ready[_ngcontent-%COMP%]{display:flex;align-items:center}.container[_ngcontent-%COMP%]   .ready[_ngcontent-%COMP%]{flex-direction:column}.container[_ngcontent-%COMP%]   .ready[_ngcontent-%COMP%]   .ready-call-avatar[_ngcontent-%COMP%]{height:78px;width:78px;overflow:hidden;border-radius:50%}.container[_ngcontent-%COMP%]   .ready[_ngcontent-%COMP%]   .ready-call-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%;width:100%;object-fit:cover}.container[_ngcontent-%COMP%]   .ready[_ngcontent-%COMP%]   .ready-call-name[_ngcontent-%COMP%]{margin-top:20px;font-size:1.2rem;font-style:inherit}.container[_ngcontent-%COMP%]   .ready[_ngcontent-%COMP%]   .ready-call-question[_ngcontent-%COMP%]{margin-top:5px;font-style:inherit}.container[_ngcontent-%COMP%]   .ready[_ngcontent-%COMP%]   .ready-call-footer[_ngcontent-%COMP%]{margin-top:20px;display:flex;align-items:center}.container[_ngcontent-%COMP%]   .ready[_ngcontent-%COMP%]   .ready-call-footer[_ngcontent-%COMP%]   .ready-call-button[_ngcontent-%COMP%]{background-color:#21a300;border-radius:18px;padding:10px;font-size:.8rem;margin-left:10px}.container[_ngcontent-%COMP%]   .ready[_ngcontent-%COMP%]   .ready-call-footer[_ngcontent-%COMP%]   .ready-call-button.ready-call-button--close[_ngcontent-%COMP%]{background-color:#3e3e3e}.container[_ngcontent-%COMP%]   .ready[_ngcontent-%COMP%]   .ready-call-footer[_ngcontent-%COMP%]   .ready-call-button.ready-call-button--close[_ngcontent-%COMP%]:hover{background-color:#343434}.container[_ngcontent-%COMP%]   .ready[_ngcontent-%COMP%]   .ready-call-footer[_ngcontent-%COMP%]   .ready-call-button[_ngcontent-%COMP%]:first-child{margin-left:0}.container[_ngcontent-%COMP%]   .ready[_ngcontent-%COMP%]   .ready-call-footer[_ngcontent-%COMP%]   .ready-call-button[_ngcontent-%COMP%]:hover{cursor:pointer;background-color:#23b100}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%;height:100%;padding:10px}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;flex-grow:1}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-info[_ngcontent-%COMP%]   .calling-room-info-avatar[_ngcontent-%COMP%]{height:78px;width:78px;overflow:hidden;border-radius:50%}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-info[_ngcontent-%COMP%]   .calling-room-info-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%;width:100%;object-fit:cover}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-info[_ngcontent-%COMP%]   .calling-room-info-name[_ngcontent-%COMP%]{margin-top:20px;font-size:1.2rem;font-style:inherit}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-info[_ngcontent-%COMP%]   .calling-room-info-title[_ngcontent-%COMP%]{margin-top:5px;font-style:inherit}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-footer[_ngcontent-%COMP%]{flex-basis:1}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-footer[_ngcontent-%COMP%]   .calling-room-footer-container[_ngcontent-%COMP%]{display:flex;align-items:flex-end}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-footer[_ngcontent-%COMP%]   .calling-room-footer-container[_ngcontent-%COMP%]   .calling-room-footer-left[_ngcontent-%COMP%]{padding-left:20px}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-footer[_ngcontent-%COMP%]   .calling-room-footer-container[_ngcontent-%COMP%]   .calling-room-footer-left[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-footer[_ngcontent-%COMP%]   .calling-room-footer-container[_ngcontent-%COMP%]   .calling-room-footer-middle[_ngcontent-%COMP%]{display:flex;align-items:center;padding-bottom:20px}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-footer[_ngcontent-%COMP%]   .calling-room-footer-container[_ngcontent-%COMP%]   .calling-room-footer-left[_ngcontent-%COMP%]   .calling-room-footer-item[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-footer[_ngcontent-%COMP%]   .calling-room-footer-container[_ngcontent-%COMP%]   .calling-room-footer-middle[_ngcontent-%COMP%]   .calling-room-footer-item[_ngcontent-%COMP%]{font-size:1.5rem;height:48px;width:48px;display:flex;align-items:center;justify-content:center;border-radius:50%;background-color:#303030;margin-left:25px}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-footer[_ngcontent-%COMP%]   .calling-room-footer-container[_ngcontent-%COMP%]   .calling-room-footer-left[_ngcontent-%COMP%]   .calling-room-footer-item.calling-room-footer-item--slash[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-footer[_ngcontent-%COMP%]   .calling-room-footer-container[_ngcontent-%COMP%]   .calling-room-footer-middle[_ngcontent-%COMP%]   .calling-room-footer-item.calling-room-footer-item--slash[_ngcontent-%COMP%]{color:#494949}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-footer[_ngcontent-%COMP%]   .calling-room-footer-container[_ngcontent-%COMP%]   .calling-room-footer-left[_ngcontent-%COMP%]   .calling-room-footer-item.calling-room-footer-item--exit[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-footer[_ngcontent-%COMP%]   .calling-room-footer-container[_ngcontent-%COMP%]   .calling-room-footer-middle[_ngcontent-%COMP%]   .calling-room-footer-item.calling-room-footer-item--exit[_ngcontent-%COMP%]{background-color:#e33434;transform:rotate(-135deg)}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-footer[_ngcontent-%COMP%]   .calling-room-footer-container[_ngcontent-%COMP%]   .calling-room-footer-left[_ngcontent-%COMP%]   .calling-room-footer-item.calling-room-footer-item--exit[_ngcontent-%COMP%]:hover, .container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-footer[_ngcontent-%COMP%]   .calling-room-footer-container[_ngcontent-%COMP%]   .calling-room-footer-middle[_ngcontent-%COMP%]   .calling-room-footer-item.calling-room-footer-item--exit[_ngcontent-%COMP%]:hover{background-color:#d51717}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-footer[_ngcontent-%COMP%]   .calling-room-footer-container[_ngcontent-%COMP%]   .calling-room-footer-left[_ngcontent-%COMP%]   .calling-room-footer-item[_ngcontent-%COMP%]:last-child, .container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-footer[_ngcontent-%COMP%]   .calling-room-footer-container[_ngcontent-%COMP%]   .calling-room-footer-middle[_ngcontent-%COMP%]   .calling-room-footer-item[_ngcontent-%COMP%]:last-child{margin-left:0}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-footer[_ngcontent-%COMP%]   .calling-room-footer-container[_ngcontent-%COMP%]   .calling-room-footer-left[_ngcontent-%COMP%]   .calling-room-footer-item[_ngcontent-%COMP%]:hover, .container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-footer[_ngcontent-%COMP%]   .calling-room-footer-container[_ngcontent-%COMP%]   .calling-room-footer-middle[_ngcontent-%COMP%]   .calling-room-footer-item[_ngcontent-%COMP%]:hover{cursor:pointer;background-color:#272727}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-footer[_ngcontent-%COMP%]   .calling-room-footer-container[_ngcontent-%COMP%]   .calling-room-footer-middle[_ngcontent-%COMP%]{flex-grow:1;flex-direction:row-reverse}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-footer[_ngcontent-%COMP%]   .calling-room-footer-container[_ngcontent-%COMP%]   .calling-room-footer-right[_ngcontent-%COMP%]{margin-left:120px;width:225px;height:170px}@media only screen and (max-width:990px){.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-footer[_ngcontent-%COMP%]   .calling-room-footer-container[_ngcontent-%COMP%]   .calling-room-footer-right[_ngcontent-%COMP%]{height:150px}}"]}),e})();var z=n(8569),J=n(2293);function Y(e){const{subscriber:t,counter:n,period:r}=e;t.next(n),this.schedule({subscriber:t,counter:n+1,period:r},r)}var K=n(1110);const $=["participants"],X=["camera"];function ee(e,t){1&e&&(y.ynx(0),y._uU(1),y.ALo(2,"translate"),y.BQk()),2&e&&(y.xp6(1),y.Oqu(y.lcZ(2,1,"callingTo")))}function te(e,t){1&e&&(y._uU(0),y.ALo(1,"translate")),2&e&&y.Oqu(y.lcZ(1,1,"endCall"))}function ne(e,t){if(1&e){const e=y.EpF();y.TgZ(0,"div",14),y.TgZ(1,"div",15),y.NdJ("click",function(){return y.CHM(e),y.oxw(3).joinVideoChatRoom()}),y._UZ(2,"fa-icon",16),y.qZA(),y.TgZ(3,"div",17),y.NdJ("click",function(){return y.CHM(e),y.oxw(3).rejectVideoCall()}),y._UZ(4,"fa-icon",16),y.qZA(),y.qZA()}if(2&e){const e=y.oxw(3);y.xp6(2),y.Q6J("icon",e.phoneIcon),y.xp6(2),y.Q6J("icon",e.phoneIcon)}}function re(e,t){if(1&e){const e=y.EpF();y.TgZ(0,"div",21),y.NdJ("click",function(){return y.CHM(e),y.oxw(4).exitVideoCall()}),y._uU(1),y.ALo(2,"translate"),y.qZA()}2&e&&(y.xp6(1),y.Oqu(y.lcZ(2,1,"end")))}function oe(e,t){if(1&e){const e=y.EpF();y.TgZ(0,"div",18),y.TgZ(1,"div",19),y.NdJ("click",function(){return y.CHM(e),y.oxw(3).callingStatus=2}),y._uU(2),y.ALo(3,"translate"),y.qZA(),y.YNc(4,re,3,3,"div",20),y.qZA()}if(2&e){const e=y.oxw(3);y.xp6(2),y.Oqu(y.lcZ(3,2,"callBack")),y.xp6(2),y.Q6J("ngIf",e.newWindow)}}function ie(e,t){if(1&e&&(y.TgZ(0,"div",4),y.TgZ(1,"div",5),y.TgZ(2,"div",6),y._UZ(3,"img",7),y.qZA(),y.TgZ(4,"p",8),y._uU(5),y.qZA(),y.TgZ(6,"p",9),y.YNc(7,ee,3,3,"ng-container",10),y.YNc(8,te,2,3,"ng-template",null,11,y.W1O),y.qZA(),y.qZA(),y.YNc(10,ne,5,2,"div",12),y.YNc(11,oe,5,4,"div",13),y.qZA()),2&e){const e=y.MAs(9),t=y.oxw(2);y.xp6(3),y.s9C("src",t.room.avatar,y.LSH),y.xp6(2),y.Oqu(t.room.name),y.xp6(2),y.Q6J("ngIf",1===t.callingStatus)("ngIfElse",e),y.xp6(3),y.Q6J("ngIf",1==t.callingStatus),y.xp6(1),y.Q6J("ngIf",3==t.callingStatus)}}function ae(e,t){if(1&e&&(y.ynx(0),y.TgZ(1,"div",35),y._UZ(2,"img",7),y.qZA(),y.TgZ(3,"p",36),y._uU(4),y.qZA(),y.TgZ(5,"p",37),y._uU(6),y.ALo(7,"translate"),y.qZA(),y.BQk()),2&e){const e=y.oxw(3);y.xp6(2),y.s9C("src",e.room.avatar,y.LSH),y.xp6(2),y.Oqu(e.room.name),y.xp6(2),y.Oqu(y.lcZ(7,3,"cameraIsOff"))}}function ce(e,t){1&e&&y._UZ(0,"ymg-video-call-camera-preview",null,38)}function se(e,t){if(1&e){const e=y.EpF();y.TgZ(0,"div",22),y.TgZ(1,"div",23),y.YNc(2,ae,8,5,"ng-container",24),y.TgZ(3,"ymg-video-call-participants",25,26),y.NdJ("hasVideo",function(){return y.CHM(e),y.oxw(2).onParticipantsHasVideo()}),y.qZA(),y.qZA(),y.TgZ(5,"div",27),y.TgZ(6,"div",28),y.TgZ(7,"div",29),y.TgZ(8,"div",30),y._UZ(9,"fa-icon",16),y.qZA(),y.qZA(),y.TgZ(10,"div",31),y.TgZ(11,"div",32),y.NdJ("click",function(){return y.CHM(e),y.oxw(2).exitVideoCall()}),y._UZ(12,"fa-icon",16),y.qZA(),y.TgZ(13,"div",30),y._UZ(14,"fa-icon",16),y.qZA(),y.TgZ(15,"div",33),y.NdJ("click",function(){y.CHM(e);const t=y.oxw(2);return t.isVideo=!t.isVideo}),y._UZ(16,"fa-icon",16),y.qZA(),y.qZA(),y.TgZ(17,"div",34),y.YNc(18,ce,2,0,"ymg-video-call-camera-preview",24),y.qZA(),y.qZA(),y.qZA(),y.qZA()}if(2&e){const e=y.oxw(2);y.xp6(2),y.Q6J("ngIf",!e.hasVideo),y.xp6(1),y.Udp("display",e.activeRoom?"block":"none"),y.xp6(6),y.Q6J("icon",e.commentIcon),y.xp6(3),y.Q6J("icon",e.phoneIcon),y.xp6(2),y.Q6J("icon",e.microIcon),y.xp6(1),y.ekj("calling-room-footer-item--slash",!e.isVideo),y.xp6(1),y.Q6J("icon",e.isVideo?e.videoIcon:e.videoSlashIcon),y.xp6(2),y.Q6J("ngIf",e.isVideo)}}function ue(e,t){if(1&e&&(y.TgZ(0,"div",1),y.YNc(1,ie,12,6,"div",2),y.YNc(2,se,19,10,"ng-template",null,3,y.W1O),y.qZA()),2&e){const e=y.MAs(3),t=y.oxw();y.xp6(1),y.Q6J("ngIf",1==t.callingStatus||3==t.callingStatus)("ngIfElse",e)}}let le=(()=>{class e{constructor(e,t,n,r,o,i){this.route=e,this.chatRoomService=t,this.videoChatService=n,this.storageService=r,this.chatHubService=o,this.convertService=i,this.commentIcon=s.Mzg,this.videoIcon=s.IyC,this.microIcon=s.UOM,this.phoneIcon=s.j1w,this.videoSlashIcon=s.dRd,this.roomId="",this.isVideo=!0,this.newWindow=!0,this.callingStatus=1,this.hasVideo=!1,this.userExitCallSubscription=new u.w,this.intervalSubscription=new u.w,this.beforeUnloadEventSubscription=new u.w,this.accepted=!1,this.onParticipantsHasVideo=()=>this.hasVideo=!0}ngOnDestroy(){this.userExitCallSubscription.unsubscribe(),this.intervalSubscription.unsubscribe(),this.beforeUnloadEventSubscription.unsubscribe()}ngOnInit(){var e;this.route.parent&&(this.roomId=null!==(e=this.route.parent.snapshot.paramMap.get("id"))&&void 0!==e?e:"");let t=this.route.snapshot.queryParamMap;this.isVideo="true"===t.get("is_video"),this.newWindow="true"===t.get("new_window"),this.chatRoomService.getRoomDetails(this.roomId).subscribe(e=>{this.room=e,this.audio=this.convertService.playMessageCallSound("come")}),this.intervalSubscription=function(e=0,t=z.P){return(!(0,J.k)(e)||e<0)&&(e=0),t&&"function"==typeof t.schedule||(t=z.P),new f.y(n=>(n.add(t.schedule(Y,e,{subscriber:n,counter:0,period:e})),n))}(7100).subscribe(()=>this.audio=this.convertService.playMessageCallSound("come")),(0,K.H)(3e4).subscribe(()=>{this.accepted||(this.audio.pause(),this.intervalSubscription.unsubscribe(),this.rejectVideoCall())}),this.userExitCallSubscription=this.chatHubService.userExitCall.subscribe(e=>{this.roomId===e.roomId&&(this.audio.pause(),this.intervalSubscription.unsubscribe(),this.callingStatus=3)}),this.beforeUnloadEventSubscription=(0,l.R)(window,"beforeunload").subscribe(()=>{this.accepted?this.exitVideoCall():this.rejectVideoCall()})}onLeaveRoom(){return(0,c.mG)(this,void 0,void 0,function*(){this.activeRoom&&(this.activeRoom.disconnect(),this.activeRoom=null),this.participants&&this.participants.clear()})}exitVideoCall(){this.onLeaveRoom(),this.videoChatService.exitCall(this.roomId).subscribe(()=>{this.newWindow?window.close():this.callingStatus=3})}rejectVideoCall(){this.audio.pause(),this.videoChatService.acceptOrRejectCall(this.roomId,!1).subscribe(()=>{this.audio.pause(),this.intervalSubscription.unsubscribe(),this.newWindow?window.close():this.callingStatus=3})}joinVideoChatRoom(){return(0,c.mG)(this,void 0,void 0,function*(){this.audio.pause(),this.intervalSubscription.unsubscribe(),this.callingStatus=2,this.accepted=!0,yield this.videoChatService.acceptOrRejectCall(this.roomId,!0).toPromise(),yield(0,K.H)(500).toPromise(),yield this.activeVideoChatRoom(this.roomId)})}activeVideoChatRoom(e){var t,n;return(0,c.mG)(this,void 0,void 0,function*(){let r;r=this.camera&&this.isVideo?yield Promise.all([(0,v.createLocalAudioTrack)(),this.showPreviewCamera()]):yield Promise.all([(0,v.createLocalAudioTrack)()]),this.activeRoom=yield this.videoChatService.joinOrCreateRoom(e,r),this.participants.initialize(null!==(n=null===(t=this.activeRoom)||void 0===t?void 0:t.participants)&&void 0!==n?n:{}),this.registerRoomEvents()})}onParticipantsChanged(e){this.videoChatService.nudge()}showPreviewCamera(){return(0,c.mG)(this,void 0,void 0,function*(){if(!this.camera.videoTrack){const e=this.storageService.get("videoInputId");yield this.camera.initializePreview(null!=e?e:"")}return this.camera.videoTrack})}registerRoomEvents(){this.activeRoom&&this.activeRoom.on("disconnected",e=>e.localParticipant.tracks.forEach(e=>this.detachLocalTrack(e.track))).on("participantConnected",e=>this.participants.add(e)).on("participantDisconnected",e=>this.participants.remove(e)).on("dominantSpeakerChanged",e=>this.participants.loudest(e))}detachLocalTrack(e){this.isDetachable(e)&&e.detach().forEach(e=>e.remove())}isDetachable(e){return!!e&&(void 0!==e.detach||void 0!==e.detach)}}return e.\u0275fac=function(t){return new(t||e)(y.Y36(a.gz),y.Y36(m.X),y.Y36(k),y.Y36(O),y.Y36(S.h),y.Y36(P.w))},e.\u0275cmp=y.Xpm({type:e,selectors:[["app-video-call-out"]],viewQuery:function(e,t){if(1&e&&(y.Gf($,5),y.Gf(X,5)),2&e){let e;y.iGM(e=y.CRH())&&(t.participants=e.first),y.iGM(e=y.CRH())&&(t.camera=e.first)}},decls:1,vars:1,consts:[["class","container",4,"ngIf"],[1,"container"],["class","calling",4,"ngIf","ngIfElse"],["accept_template",""],[1,"calling"],[1,"calling-room-info"],[1,"calling-room-info-avatar"],[3,"src"],[1,"calling-room-info-name"],[1,"calling-room-info-title"],[4,"ngIf","ngIfElse"],["finish",""],["class","calling-room-footer",4,"ngIf"],["class","ready-call-footer",4,"ngIf"],[1,"calling-room-footer"],[1,"calling-room-footer-item","calling-room-footer-item--accept",3,"click"],[3,"icon"],[1,"calling-room-footer-item","calling-room-footer-item--reject",3,"click"],[1,"ready-call-footer"],[1,"ready-call-button",3,"click"],["class","ready-call-button ready-call-button--close",3,"click",4,"ngIf"],[1,"ready-call-button","ready-call-button--close",3,"click"],[1,"call-accept"],[1,"call-accept-info"],[4,"ngIf"],[3,"hasVideo"],["participants",""],[1,"call-accept-footer"],[1,"call-accept-footer-container"],[1,"call-accept-footer-left"],[1,"call-accept-footer-item"],[1,"call-accept-footer-middle"],[1,"call-accept-footer-item","call-accept-footer-item--exit",3,"click"],[1,"call-accept-footer-item",3,"click"],[1,"call-accept-footer-right"],[1,"call-accept-info-avatar"],[1,"call-accept-info-name"],[1,"call-accept-info-title"],["camera",""]],template:function(e,t){1&e&&y.YNc(0,ue,4,2,"div",0),2&e&&y.Q6J("ngIf",t.room)},directives:[r.O5,E.BN,C,M],pipes:[x.X$],styles:[".container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:100%}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:10px}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;flex-grow:1}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-info[_ngcontent-%COMP%]   .calling-room-info-avatar[_ngcontent-%COMP%]{height:78px;width:78px;overflow:hidden;border-radius:50%}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-info[_ngcontent-%COMP%]   .calling-room-info-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%;width:100%;object-fit:cover}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-info[_ngcontent-%COMP%]   .calling-room-info-name[_ngcontent-%COMP%]{margin-top:20px;font-size:1.2rem;font-style:inherit}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-info[_ngcontent-%COMP%]   .calling-room-info-name.calling-room-info-name--group[_ngcontent-%COMP%]{margin-top:5px;font-style:italic}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-info[_ngcontent-%COMP%]   .calling-room-info-title[_ngcontent-%COMP%]{margin-top:5px;font-style:inherit}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-footer[_ngcontent-%COMP%]{display:flex;align-items:flex-end;margin-top:50px}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-footer[_ngcontent-%COMP%]   .calling-room-footer-item[_ngcontent-%COMP%]{font-size:1.5rem;height:48px;width:48px;display:flex;align-items:center;justify-content:center;border-radius:50%;margin-left:50px}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-footer[_ngcontent-%COMP%]   .calling-room-footer-item.calling-room-footer-item--reject[_ngcontent-%COMP%]{background-color:#e33434;transform:rotate(-135deg)}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-footer[_ngcontent-%COMP%]   .calling-room-footer-item.calling-room-footer-item--reject[_ngcontent-%COMP%]:hover{background-color:#d51717}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-footer[_ngcontent-%COMP%]   .calling-room-footer-item[_ngcontent-%COMP%]:first-child{margin-left:0}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-footer[_ngcontent-%COMP%]   .calling-room-footer-item.calling-room-footer-item--accept[_ngcontent-%COMP%]{background-color:#088400;transform:rotate(90deg)}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .calling-room-footer[_ngcontent-%COMP%]   .calling-room-footer-item[_ngcontent-%COMP%]:hover{cursor:pointer;background-color:#098a01}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .ready-call-footer[_ngcontent-%COMP%]{margin-top:20px;display:flex;align-items:center}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .ready-call-footer[_ngcontent-%COMP%]   .ready-call-button[_ngcontent-%COMP%]{background-color:#21a300;border-radius:18px;padding:10px;font-size:.8rem;margin-left:10px}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .ready-call-footer[_ngcontent-%COMP%]   .ready-call-button.ready-call-button--close[_ngcontent-%COMP%]{background-color:#3e3e3e}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .ready-call-footer[_ngcontent-%COMP%]   .ready-call-button.ready-call-button--close[_ngcontent-%COMP%]:hover{background-color:#343434}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .ready-call-footer[_ngcontent-%COMP%]   .ready-call-button[_ngcontent-%COMP%]:first-child{margin-left:0}.container[_ngcontent-%COMP%]   .calling[_ngcontent-%COMP%]   .ready-call-footer[_ngcontent-%COMP%]   .ready-call-button[_ngcontent-%COMP%]:hover{cursor:pointer;background-color:#23b100}.container[_ngcontent-%COMP%]   .call-accept[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%;height:100%;padding:10px}.container[_ngcontent-%COMP%]   .call-accept[_ngcontent-%COMP%]   .call-accept-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;flex-grow:1}.container[_ngcontent-%COMP%]   .call-accept[_ngcontent-%COMP%]   .call-accept-info[_ngcontent-%COMP%]   .call-accept-info-avatar[_ngcontent-%COMP%]{height:78px;width:78px;overflow:hidden;border-radius:50%}.container[_ngcontent-%COMP%]   .call-accept[_ngcontent-%COMP%]   .call-accept-info[_ngcontent-%COMP%]   .call-accept-info-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%;width:100%;object-fit:cover}.container[_ngcontent-%COMP%]   .call-accept[_ngcontent-%COMP%]   .call-accept-info[_ngcontent-%COMP%]   .call-accept-info-name[_ngcontent-%COMP%]{margin-top:20px;font-size:1.2rem;font-style:inherit}.container[_ngcontent-%COMP%]   .call-accept[_ngcontent-%COMP%]   .call-accept-info[_ngcontent-%COMP%]   .call-accept-info-title[_ngcontent-%COMP%]{margin-top:5px;font-style:inherit}.container[_ngcontent-%COMP%]   .call-accept[_ngcontent-%COMP%]   .call-accept-footer[_ngcontent-%COMP%]{flex-basis:1}.container[_ngcontent-%COMP%]   .call-accept[_ngcontent-%COMP%]   .call-accept-footer[_ngcontent-%COMP%]   .call-accept-footer-container[_ngcontent-%COMP%]{display:flex;align-items:flex-end}.container[_ngcontent-%COMP%]   .call-accept[_ngcontent-%COMP%]   .call-accept-footer[_ngcontent-%COMP%]   .call-accept-footer-container[_ngcontent-%COMP%]   .call-accept-footer-left[_ngcontent-%COMP%]{padding-left:20px}.container[_ngcontent-%COMP%]   .call-accept[_ngcontent-%COMP%]   .call-accept-footer[_ngcontent-%COMP%]   .call-accept-footer-container[_ngcontent-%COMP%]   .call-accept-footer-left[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   .call-accept[_ngcontent-%COMP%]   .call-accept-footer[_ngcontent-%COMP%]   .call-accept-footer-container[_ngcontent-%COMP%]   .call-accept-footer-middle[_ngcontent-%COMP%]{display:flex;align-items:center;padding-bottom:20px}.container[_ngcontent-%COMP%]   .call-accept[_ngcontent-%COMP%]   .call-accept-footer[_ngcontent-%COMP%]   .call-accept-footer-container[_ngcontent-%COMP%]   .call-accept-footer-left[_ngcontent-%COMP%]   .call-accept-footer-item[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   .call-accept[_ngcontent-%COMP%]   .call-accept-footer[_ngcontent-%COMP%]   .call-accept-footer-container[_ngcontent-%COMP%]   .call-accept-footer-middle[_ngcontent-%COMP%]   .call-accept-footer-item[_ngcontent-%COMP%]{font-size:1.5rem;height:48px;width:48px;display:flex;align-items:center;justify-content:center;border-radius:50%;background-color:#303030;margin-left:25px}.container[_ngcontent-%COMP%]   .call-accept[_ngcontent-%COMP%]   .call-accept-footer[_ngcontent-%COMP%]   .call-accept-footer-container[_ngcontent-%COMP%]   .call-accept-footer-left[_ngcontent-%COMP%]   .call-accept-footer-item.calling-room-footer-item--slash[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   .call-accept[_ngcontent-%COMP%]   .call-accept-footer[_ngcontent-%COMP%]   .call-accept-footer-container[_ngcontent-%COMP%]   .call-accept-footer-middle[_ngcontent-%COMP%]   .call-accept-footer-item.calling-room-footer-item--slash[_ngcontent-%COMP%]{color:#494949}.container[_ngcontent-%COMP%]   .call-accept[_ngcontent-%COMP%]   .call-accept-footer[_ngcontent-%COMP%]   .call-accept-footer-container[_ngcontent-%COMP%]   .call-accept-footer-left[_ngcontent-%COMP%]   .call-accept-footer-item.call-accept-footer-item--exit[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]   .call-accept[_ngcontent-%COMP%]   .call-accept-footer[_ngcontent-%COMP%]   .call-accept-footer-container[_ngcontent-%COMP%]   .call-accept-footer-middle[_ngcontent-%COMP%]   .call-accept-footer-item.call-accept-footer-item--exit[_ngcontent-%COMP%]{background-color:#e33434;transform:rotate(-135deg)}.container[_ngcontent-%COMP%]   .call-accept[_ngcontent-%COMP%]   .call-accept-footer[_ngcontent-%COMP%]   .call-accept-footer-container[_ngcontent-%COMP%]   .call-accept-footer-left[_ngcontent-%COMP%]   .call-accept-footer-item.call-accept-footer-item--exit[_ngcontent-%COMP%]:hover, .container[_ngcontent-%COMP%]   .call-accept[_ngcontent-%COMP%]   .call-accept-footer[_ngcontent-%COMP%]   .call-accept-footer-container[_ngcontent-%COMP%]   .call-accept-footer-middle[_ngcontent-%COMP%]   .call-accept-footer-item.call-accept-footer-item--exit[_ngcontent-%COMP%]:hover{background-color:#d51717}.container[_ngcontent-%COMP%]   .call-accept[_ngcontent-%COMP%]   .call-accept-footer[_ngcontent-%COMP%]   .call-accept-footer-container[_ngcontent-%COMP%]   .call-accept-footer-left[_ngcontent-%COMP%]   .call-accept-footer-item[_ngcontent-%COMP%]:last-child, .container[_ngcontent-%COMP%]   .call-accept[_ngcontent-%COMP%]   .call-accept-footer[_ngcontent-%COMP%]   .call-accept-footer-container[_ngcontent-%COMP%]   .call-accept-footer-middle[_ngcontent-%COMP%]   .call-accept-footer-item[_ngcontent-%COMP%]:last-child{margin-left:0}.container[_ngcontent-%COMP%]   .call-accept[_ngcontent-%COMP%]   .call-accept-footer[_ngcontent-%COMP%]   .call-accept-footer-container[_ngcontent-%COMP%]   .call-accept-footer-left[_ngcontent-%COMP%]   .call-accept-footer-item[_ngcontent-%COMP%]:hover, .container[_ngcontent-%COMP%]   .call-accept[_ngcontent-%COMP%]   .call-accept-footer[_ngcontent-%COMP%]   .call-accept-footer-container[_ngcontent-%COMP%]   .call-accept-footer-middle[_ngcontent-%COMP%]   .call-accept-footer-item[_ngcontent-%COMP%]:hover{cursor:pointer;background-color:#272727}.container[_ngcontent-%COMP%]   .call-accept[_ngcontent-%COMP%]   .call-accept-footer[_ngcontent-%COMP%]   .call-accept-footer-container[_ngcontent-%COMP%]   .call-accept-footer-middle[_ngcontent-%COMP%]{flex-grow:1;flex-direction:row-reverse}.container[_ngcontent-%COMP%]   .call-accept[_ngcontent-%COMP%]   .call-accept-footer[_ngcontent-%COMP%]   .call-accept-footer-container[_ngcontent-%COMP%]   .call-accept-footer-right[_ngcontent-%COMP%]{margin-left:120px;width:225px;height:170px}@media only screen and (max-width:990px){.container[_ngcontent-%COMP%]   .call-accept[_ngcontent-%COMP%]   .call-accept-footer[_ngcontent-%COMP%]   .call-accept-footer-container[_ngcontent-%COMP%]   .call-accept-footer-right[_ngcontent-%COMP%]{height:150px}}"]}),e})();const fe=[{path:":id",component:(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=y.Xpm({type:e,selectors:[["app-video-call"]],decls:2,vars:0,consts:[[1,"container"]],template:function(e,t){1&e&&(y.TgZ(0,"div",0),y._UZ(1,"router-outlet"),y.qZA())},directives:[a.lC],styles:[".container[_ngcontent-%COMP%]{background-color:#000;height:100%;color:#fff}"]}),e})(),children:[{path:"incall",component:G},{path:"outcall",component:le}]}];let pe=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=y.oAB({type:e}),e.\u0275inj=y.cJS({imports:[[a.Bz.forChild(fe)],a.Bz]}),e})(),de=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=y.oAB({type:e}),e.\u0275inj=y.cJS({providers:[],imports:[[r.ez,pe,o.m,i.e]]}),e})()},1610:e=>{"use strict";e.exports={i8:"4.4.0"}},5406:e=>{"use strict";e.exports=JSON.parse('{"_from":"twilio-video@*","_id":"twilio-video@2.15.0","_inBundle":false,"_integrity":"sha512-wpcQzWioSHLEq991wRpIYuAM9ky4x5pdCAluFRtXceXHYr3ISo3BA+Iqsd+zj2+h1sSAe4V9U7pvO4wRqdgtMA==","_location":"/twilio-video","_phantomChildren":{},"_requested":{"type":"range","registry":true,"raw":"twilio-video@*","name":"twilio-video","escapedName":"twilio-video","rawSpec":"*","saveSpec":null,"fetchSpec":"*"},"_requiredBy":["/@types/twilio-video"],"_resolved":"https://registry.npmjs.org/twilio-video/-/twilio-video-2.15.0.tgz","_shasum":"d42d0bea75f8bae027d0ec69d52d3648bcbe5618","_spec":"twilio-video@*","_where":"d:\\\\Administrator\\\\My Project\\\\YourMessage\\\\ngx-your-message\\\\node_modules\\\\@types\\\\twilio-video","author":{"name":"Mark Andrus Roberts","email":"mroberts@twilio.com"},"browser":{"ws":"./src/ws.js","xmlhttprequest":"./src/xmlhttprequest.js"},"bugs":{"url":"https://github.com/twilio/twilio-video.js/issues"},"bundleDependencies":false,"contributors":[{"name":"Ryan Rowland","email":"rrowland@twilio.com"},{"name":"Manjesh Malavalli","email":"mmalavalli@twilio.com"},{"name":"Makarand Patwardhan","email":"mpatwardhan@twilio.com"}],"dependencies":{"@twilio/webrtc":"4.4.0","backoff":"^2.5.0","ws":"^7.4.6","xmlhttprequest":"^1.8.0"},"deprecated":false,"description":"Twilio Video JavaScript Library","devDependencies":{"@types/express":"^4.11.0","@types/node":"^8.5.1","@types/selenium-webdriver":"^3.0.8","@types/ws":"^3.2.1","@typescript-eslint/eslint-plugin":"^4.13.0","@typescript-eslint/parser":"^3.10.1","babel-cli":"^6.26.0","babel-preset-es2015":"^6.24.1","browserify":"^17.0.0","cheerio":"^0.22.0","cors":"^2.8.5","electron":"^9.1.0","envify":"^4.0.0","eslint":"^6.2.1","eslint-config-standard":"^14.0.0","eslint-plugin-import":"^2.18.2","eslint-plugin-node":"^9.1.0","eslint-plugin-promise":"^4.2.1","eslint-plugin-standard":"^4.0.1","express":"^4.16.2","ink-docstrap":"^1.3.2","inquirer":"^7.0.0","is-docker":"^2.0.0","istanbul":"^0.4.5","jsdoc":"^3.5.5","json-loader":"^0.5.7","karma":"^5.0.2","karma-browserify":"^7.0.0","karma-chrome-launcher":"^2.0.0","karma-edgium-launcher":"^4.0.0-0","karma-electron":"^6.1.0","karma-firefox-launcher":"^1.3.0","karma-htmlfile-reporter":"^0.3.8","karma-junit-reporter":"^1.2.0","karma-mocha":"^1.3.0","karma-safari-launcher":"^1.0.0","karma-spec-reporter":"0.0.32","mocha":"^3.2.0","mock-require":"^3.0.3","node-http-server":"^8.1.2","npm-run-all":"^4.0.2","requirejs":"^2.3.3","rimraf":"^2.6.1","simple-git":"^1.126.0","sinon":"^4.0.1","ts-node":"4.0.1","tslint":"5.8.0","twilio":"^3.49.0","twilio-release-tool":"^1.0.0","typescript":"^4.0.5","uglify-js":"^2.8.22","vinyl-fs":"^2.4.4","vinyl-source-stream":"^1.1.0","watchify":"^3.11.1","webrtc-adapter":"^4.1.1"},"engines":{"node":">=0.12"},"homepage":"https://twilio.com","keywords":["twilio","webrtc","library","javascript","video","rooms"],"license":"BSD-3-Clause","main":"./es5/index.js","name":"twilio-video","repository":{"type":"git","url":"git+https://github.com/twilio/twilio-video.js.git"},"scripts":{"build":"npm-run-all clean lint docs cover test:integration build:es5 build:js build:min.js test:umd","build:es5":"rimraf ./es5 && babel lib -d es5","build:js":"node ./scripts/build.js ./src/twilio-video.js ./LICENSE.md ./dist/twilio-video.js","build:min.js":"uglifyjs ./dist/twilio-video.js -o ./dist/twilio-video.min.js --comments \\"/^! twilio-video.js/\\" -b beautify=false,ascii_only=true","build:quick":"npm-run-all clean lint docs build:es5 build:js build:min.js build:ts","build:ts":"tsc -p tsconfig.json --noEmit","clean":"rimraf ./coverage ./es5 ./dist","cover":"istanbul cover node_modules/mocha/bin/_mocha -- ./test/unit/index.js","docs":"node ./scripts/docs.js ./dist/docs","lint":"npm-run-all lint:js lint:ts","lint:js":"eslint ./lib ./test/*.js ./docker/**/*.js ./test/framework/*.js ./test/lib/*.js ./test/integration/** ./test/unit/** ","lint:ts":"eslint ./tsdef/*.ts","test":"npm-run-all test:unit test:integration","test:crossbrowser":"npm-run-all test:crossbrowser:*","test:crossbrowser:build":"npm-run-all test:crossbrowser:build:*","test:crossbrowser:build:browser":"cd ./test/crossbrowser && browserify lib/crossbrowser/src/browser/index.js > src/browser/index.js","test:crossbrowser:build:clean":"rimraf ./test/crossbrowser/lib ./test/crossbrowser/src/browser/index.js","test:crossbrowser:build:lint":"cd ./test/crossbrowser && tslint --project tsconfig.json","test:crossbrowser:build:tsc":"cd ./test/crossbrowser && tsc","test:crossbrowser:test":"cd ./test/crossbrowser && mocha --compilers ts:ts-node/register test/integration/spec/**/*.ts","test:framework":"npm-run-all test:framework:install test:framework:no-framework test:framework:react","test:framework:angular":"npm-run-all test:framework:angular:*","test:framework:angular:install":"cd ./test/framework/twilio-video-angular && rimraf ./node_modules package-lock.json && npm install","test:framework:angular:run":"mocha ./test/framework/twilio-video-angular.js","test:framework:install":"npm install chromedriver && npm install selenium-webdriver && npm install geckodriver && npm install puppeteer","test:framework:no-framework":"npm-run-all test:framework:no-framework:*","test:framework:no-framework:run":"mocha ./test/framework/twilio-video-no-framework.js","test:framework:react":"npm-run-all test:framework:react:*","test:framework:react:build":"cd ./test/framework/twilio-video-react && npm run build","test:framework:react:install":"cd ./test/framework/twilio-video-react && rimraf ./node_modules package-lock.json && npm install","test:framework:react:run":"mocha ./test/framework/twilio-video-react.js","test:framework:react:test":"node ./scripts/framework.js twilio-video-react","test:integration":"node ./scripts/karma.js karma/integration.conf.js","test:integration:adapter":"node ./scripts/karma.js karma/integration.adapter.conf.js","test:sdkdriver":"npm-run-all test:sdkdriver:*","test:sdkdriver:build":"npm-run-all test:sdkdriver:build:*","test:sdkdriver:build:clean":"rimraf ./test/lib/sdkdriver/lib ./test/lib/sdkdriver/test/integration/browser/index.js","test:sdkdriver:build:lint":"cd ./test/lib/sdkdriver && tslint --project tsconfig.json","test:sdkdriver:build:tsc":"cd ./test/lib/sdkdriver && tsc --rootDir src","test:sdkdriver:test":"npm-run-all test:sdkdriver:test:*","test:sdkdriver:test:integration":"npm-run-all test:sdkdriver:test:integration:*","test:sdkdriver:test:integration:browser":"cd ./test/lib/sdkdriver/test/integration && browserify browser/browser.js > browser/index.js","test:sdkdriver:test:integration:run":"cd ./test/lib/sdkdriver && mocha --compilers ts:ts-node/register test/integration/spec/**/*.ts","test:sdkdriver:test:unit":"cd ./test/lib/sdkdriver && mocha --compilers ts:ts-node/register test/unit/spec/**/*.ts","test:umd":"mocha ./test/umd/index.js","test:umd:install":"npm install puppeteer@5.5.0","test:unit":"mocha ./test/unit/index.js"},"title":"Twilio Video","types":"./tsdef/index.d.ts","version":"2.15.0"}')}}]);